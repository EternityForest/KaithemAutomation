---
allow-origins: ['*']
allow-xss: false
auto-reload: false
auto-reload-interval: 5.0
mimetype: text/html
no-header: false
no-navheader: false
require-method: [GET]
require-permissions: [users.nvr.view]
resource-timestamp: 1647218821855624
resource-type: page
streaming-response: false
template-engine: mako

---
<%!
#Code Here runs once when page is first rendered. Good place for import statements.
import io
import base64
import PIL.Image
%>

<%
__doc__= "#Python Code here runs every page load"

if not kaithem.web.hasPermission(kaithem.devices[kwargs['device']].config.get("kaithem.read_perms", '').strip()):
    raise RuntimeError('Security')
    
x = PIL.Image.open(io.BytesIO(kaithem.devices[kwargs['device']].tagpoints['bmp_snapshot'].value))
b = io.BytesIO()

x.save(b,'jpeg')

kaithem.web.serveFile(b,"image/jpeg",kwargs['device']+".jpg")
b="data:image/jpeg;base64,"+base64.b64encode(b.getvalue()).decode()


%>

<h2>serve_jpg</h2>
<title>serve_jpg</title>

<div class="sectionbox">
<img src="${b}">
</div>
