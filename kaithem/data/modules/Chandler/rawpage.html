---
allow-origins: ['*']
allow-xss: false
auto-reload: false
auto-reload-interval: 5.0
dont-show-in-index: false
mimetype: text/html
no-header: true
no-navheader: true
require-method: [GET, POST]
require-permissions: []
resource-timestamp: 1578097276349435
resource-type: page
template-engine: mako

---
<meta name="viewport" content="width=device-width, initial-scale=1">

<html>
<head>
    <style>
        ${module.scenes[kwargs['sc']].page['css']}
    </style>

</head>
<script>
    /* Port of strftime() by T. H. Doan (https://thdoan.github.io/strftime/)
 *
 * Day of year (%j) code based on Joe Orost's answer:
 * http://stackoverflow.com/questions/8619879/javascript-calculate-the-day-of-the-year-1-366
 *
 * Week number (%V) code based on Taco van den Broek's prototype:
 * http://techblog.procurios.nl/k/news/view/33796/14863/calculate-iso-8601-week-and-year-in-javascript.html
 */
strftime=function(sFormat, date) {
    if (!(date instanceof Date)) date = new Date();
    var nDay = date.getDay(),
      nDate = date.getDate(),
      nMonth = date.getMonth(),
      nYear = date.getFullYear(),
      nHour = date.getHours(),
      aDays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
      aMonths = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
      aDayCount = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334],
      isLeapYear = function() {
        return (nYear%4===0 && nYear%100!==0) || nYear%400===0;
      },
      getThursday = function() {
        var target = new Date(date);
        target.setDate(nDate - ((nDay+6)%7) + 3);
        return target;
      },
      zeroPad = function(nNum, nPad) {
        return ((Math.pow(10, nPad) + nNum) + '').slice(1);
      };
    return sFormat.replace(/%[a-z]/gi, function(sMatch) {
      return (({
        '%a': aDays[nDay].slice(0,3),
        '%A': aDays[nDay],
        '%b': aMonths[nMonth].slice(0,3),
        '%B': aMonths[nMonth],
        '%c': date.toUTCString(),
        '%C': Math.floor(nYear/100),
        '%d': zeroPad(nDate, 2),
        '%e': nDate,
        '%F': date.toISOString().slice(0,10),
        '%G': getThursday().getFullYear(),
        '%g': (getThursday().getFullYear() + '').slice(2),
        '%H': zeroPad(nHour, 2),
        '%I': zeroPad((nHour+11)%12 + 1, 2),
        '%j': zeroPad(aDayCount[nMonth] + nDate + ((nMonth>1 && isLeapYear()) ? 1 : 0), 3),
        '%k': nHour,
        '%l': (nHour+11)%12 + 1,
        '%m': zeroPad(nMonth + 1, 2),
        '%n': nMonth + 1,
        '%M': zeroPad(date.getMinutes(), 2),
        '%p': (nHour<12) ? 'AM' : 'PM',
        '%P': (nHour<12) ? 'am' : 'pm',
        '%s': Math.round(date.getTime()/1000),
        '%S': zeroPad(date.getSeconds(), 2),
        '%u': nDay || 7,
        '%V': (function() {
                var target = getThursday(),
                  n1stThu = target.valueOf();
                target.setMonth(0, 1);
                var nJan1 = target.getDay();
                if (nJan1!==4) target.setMonth(0, 1 + ((4-nJan1)+7)%7);
                return zeroPad(1 + Math.ceil((n1stThu-target)/604800000), 2);
              })(),
        '%w': nDay,
        '%x': date.toLocaleDateString(),
        '%X': date.toLocaleTimeString(),
        '%y': (nYear + '').slice(2),
        '%Y': nYear,
        '%z': date.toTimeString().replace(/.+GMT([+-]\d+).+/, '$1'),
        '%Z': date.toTimeString().replace(/.+\((.+?)\)$/, '$1')
      }[sMatch] || '') + '') || sMatch;
    });
  }
lastErr = 0;
</script>

<body style="padding:0px;margin:0px;overflow:hidden;overscroll-behavior: none;">
    <div id="chandlerAlertBox">
    </div>
    ${module.scenes[kwargs['sc']].page.get('rawhtml','')}

    <div id="KaithemSceneVueApp" style="width:100%;height:100%;padding:0px;margin:0px">
  
        <div v-bind:style="{width:'100%', height:'100%', padding:'5px','margin':'0px', display:'flex'}">
            ${module.scenes[kwargs['sc']].page['html']}
        </div>
    </div>



    <script type="text/javascript" src="/static/js/vue2.js"></script>
    <script type="text/javascript" src="/static/widget.js"></script>
    <script type="text/javascript" src="/static/js/keyboard.min.js"></script>
    <script type="text/javascript" src="/static/js/strftime.js"></script>

    ${module.scenes[kwargs['sc']].pageLink.render("api")}

    <script>
        setInterval(function(){if(date.now()-lastErr>10000){ document.getElementById('chandlerAlertBox').innerHTML=""}},5000)

        Vue.config.errorHandler = function(err, vm, info) {
            document.getElementById('chandlerAlertBox').innerHTML ="Error: "+err.toString()+"Info: \n"+info;
            lastErr = date.now()
        }

        appData = {

            pagevars: {},
            cue: '',
            unixtime: 0,

            sendEvent: function(e,v)
            {
                if(!e.startsWith("page"))
                {
                    alert("Cannot send event "+e+". All events must start with 'page.'")
                }
                api.send(["evt",e,v])
            },
            
            setVar: function(k,v)
            {
                this.pagevars[k]=v;
                api.send(["set",k,v])
            },
            strftime: strftime

        
        }
        
        setInterval(function()
        {
            appData.unixtime = api.now() / 1000
        }, 1000 / 14)

        api.send(["getvars"])

        function pageLinkCallback(v)
        {
            if (v[0] == 'refresh')
            {
                window.location.reload(true);
            }
            if (v[0] == 'var')
            {
                Vue.set(appData.pagevars, v[1], v[2])
            }
        }
        api.upd = pageLinkCallback

        var app = new Vue(
        {
            el: '#KaithemSceneVueApp',
            data: appData
        })

    </script>

    <script>
        ${module.scenes[kwargs['sc']].page['js']}
    </script>

</body>

</html>
