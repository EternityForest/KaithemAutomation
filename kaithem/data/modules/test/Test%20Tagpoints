continual: false
enable: true
once: true
priority: interactive
rate-limit: 0.0
resource-type: event
trigger: 'False'
versions: {}

#End metadata. Format: metadata, setup, action, delimited by --- on it's own line.
---
#This code runs once when the event loads. It also runs when you save the event during the test compile
#and may run multiple times when kaithem boots due to dependancy resolution
__doc__=''

t = kaithem.tags["TestTagPoint"]

cl = t.claim(51, "foo", 51)
cl2 = t.claim(52,"foo2", 52)

if not t.value==52:
    raise RuntimeError('wrong val')
cl2.release()

if not t.value==51:
    raise RuntimeError('wrong val '+ str(t.value))

t.interval =0
v =  [90]

cl.set(lambda:v[0])

if not t.value==90:
    raise RuntimeError('wrong val')
v[0]=91

if not t.value==91:
    raise RuntimeError('wrong val')


t.interval =60
v[0]=60

if t.value==60:
    raise RuntimeError("Seems like the cache isn't working")
---
pass