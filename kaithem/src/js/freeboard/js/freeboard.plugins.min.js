var Button=function(e){jsGrid.Field.call(this,e)};function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}Button.prototype=new jsGrid.Field({align:"center",sorter:function(e,t){return 0},itemTemplate:function(e,t){return $("<input>").on("click",function(){this.fn(t)}).title(this.title)},insertTemplate:function(e,t){return""},editTemplate:function(e,t){return $("<input>").on("click",function(){this.fn(t)}).title(this.title)},insertValue:function(){return""},editValue:function(){return""}}),jsGrid.fields.button=Button,function(){var e=0;freeboard.addStyle(".datagrid","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".datagrid-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-datagrid-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-datagrid-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"jsGrid",display_name:"jsGrid Data grid View Plugin",description:"Database grid view. Data is an array of objects.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text",default_value:""},{name:"backend",display_name:"Data backend(JS Grid CSontroller)",type:"calculated",default_value:""},{name:"selection",display_name:"Selection",description:"Selection gets assigned here. If no selection, empty obj.  Set obj._arrival to save changes back to array(The data doesn't matter, it reads as the time when it was set.)",type:"target",default_value:""},{name:"data",display_name:"Direct data array",description:"",type:"target",default_value:""},{name:"columns",display_name:"Display Columns",type:"array",settings:[{name:"name",display_name:"Data Field(match key on row)",type:"text"},{name:"type",display_name:"Type",type:"option",options:[{name:"Text",value:"text"},{name:"Long Textarea",value:"textarea"},{name:"Number",value:"number"},{name:"Checkbox",value:"checkbox"},{name:"Add/Edit/Del Controls",value:"control"}]}]},{name:"selectionTarget",display_name:"Data target when selection changes. ",description:"Value pushed will be a value, timestamp pair. Value will be the entire selected record object",type:"target"}],newInstance:function(e,a){a(new t(e))}});var t=function(t){if(t.backend&&t.data)throw new Error("Cannot use both the backend and the data options at the same time");var a=this;a.currentSettings=t,a.data=[];var n="datagrid-"+e++,r=$('<div class="datagrid-widget datagrid-label" id="__'+n+'"></div>'),o=$('<h2 class="section-title datagrid-label"></h2>'),d=$("<div>",{id:n}).css("width","90%"),l="#"+n,s="#value-"+n;a.backend=0,a.makeExternalEditRow=function(e){return new Proxy(e,{set:function(e,t,n){"_arrival"==t?(e._arrival=1e3*Date.now(),a.upsert(e),$(l).jsGrid("refresh")):(e.__time=1e3*Date.now(),e[t]=n)}})};var u=function(e){e._uuid=e._uuid||uuidv4(),e._name=e._name||e._uuid,e._time=e._time||parseInt(1e3*Date.now()),e._arrival=e._arrival||e._time};a.upsert=function(e){if(e){for(i of a.data)if(i._uuid==e._uuid){if(_.isMatch(i,e))return;return Object.assign(i,e),void a.dataTargets.data(a.data)}u(e),void 0!=a.data&&""!=a.data||(a.data=[]),a.data.push(e),a.dataTargets.data(a.data)}},a.arrayController={deleteItem:function(e){for(i of(_.isMatch(i.selection,e)&&a.setSelection({}),a.data))i._uuid==e._uuid&&(a.data=_.without(a.data,i));a.dataTargets.data(a.data)},updateItem:a.upsert,insertItem:a.upsert,loadData:function(e){var t=nSQL(a.data||[]).query("select");for(i in e)!e[i]||["sortField","sortOrder","pageIndex","pageSize"].indexOf(i)>-1||(t=t.where(["LOWER("+i+")","=",String(e[i]).toLowerCase()]));e.sortOrder&&(t=t.orderBy([e.sortField+" "+e.sortOrder.toUpperCase()])),t=t.limit(e.pageSize).offset((e.pageIndex-1)*e.pageSize);return async function(){return{data:await t.exec(),itemsCount:a.data.length}}()}},a.setSelection=function(e){a.dataTargets.selection(a.makeExternalEditRow(e))},a.acceptData=function(e){for(f in 0==e&&(e=a.data),a.data=e,a.data)u(f)},a.refreshGrid=function(e){for(f in 0==e&&(e=a.data),a.data=e,a.data)u(f);$(l).jsGrid("destroy");var t=function(){a.dataTargets.data(a.data)};for(i of a.currentSettings.columns||[]){var n={};Object.assign(n,i)}$(l).jsGrid({width:"95%",height:"250px",inserting:!0,editing:!0,sorting:!0,paging:!0,pageLoading:!0,filtering:!0,onItemDeleted:t,onItemUpdated:t,onItemInserted:t,rowClick:function(e){a.setSelection(e.item)},controller:a.backend||a.arrayController,fields:{}})},$(l).jsGrid("refresh"),o.html(a.currentSettings.title),a.value=a.currentSettings.value||0;a.render=function(e){$(e).append(r),o.appendTo(r),d.appendTo(r),a.refreshGrid(0),$(s).html(a.value+a.currentSettings.unit),$(l).removeClass("ui-widget-content")},a.getHeight=function(){return 6},a.onSettingsChanged=function(e){if(e.backend&&e.data)throw new Error("Cannot use both the backend and the data options at the same time");a.currentSettings=e,o.html(_.isUndefined(e.title)?"":e.title),a.currentSettings.unit=a.currentSettings.unit||"",a.setSelection({})},a.onCalculatedValueChanged=function(e,t){"columns"==e&&a.refreshGrid(0),"backend"==e&&(a.backend=t,a.refreshGrid(0)),"data"==e&&(a.acceptData(t||[]),$(l).jsGrid("refresh"))},a.onDispose=function(){$(l).jsGrid("destroy")}}}();var htmlWidget=function(e){var t=this,a=$('<div class="html-widget" style="overflow:auto;height:100%;width:100%;"></div>'),n=e;this.updateData=function(){t.data={},n.data&&"object"==typeof n.data?a.html(Mustache.render(n.html,n.data)):a.html(n.html)},this.render=function(e){$(e).append(a),t.updateData()},this.onSettingsChanged=function(e){n=e,t.updateData()},this.onCalculatedValueChanged=function(e,a){"html"==e&&t.updateData(),"data"==e&&(n.data=a,t.updateData())},this.onDispose=function(){},this.getHeight=function(){return Number(n.height)},this.onSettingsChanged(e)};function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}freeboard.loadWidgetPlugin({type_name:"html-template",display_name:"Rich Text Content",fill_size:!0,settings:[{name:"html",display_name:"HTML",type:"html-wysywig",description:"HTML template.  You can paste images here, they are stored in the freeboard config itself as base64."},{name:"data",display_name:"Variables to use",type:"calculated",default_value:"={varName: 'value'}",description:"Variables to use in Mustache templating, as a JS object.  Access a var with {{varname}} in your document template, it gets replaced with the value."},{name:"height",display_name:"Height Blocks",type:"number",default_value:4,description:"A height block is around 60 pixels"}],newInstance:function(e,t){t(new htmlWidget(e))}}),function(){var e=0;freeboard.addStyle(".button","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".button-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-button-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-button-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"button_plugin",display_name:"Button",description:"DataTarget compatible button that can run JS code when clicked",fill_size:!0,settings:[{name:"html",display_name:"Button Contents",type:"calculated",default_value:"<i>Button</i>"},{name:"tooltip",display_name:"Tooltip hint",type:"text",default_value:""},{name:"value",display_name:"Value",description:"This value gets pushed to the target when clicked.  If empty, a simple counter is used.  It recalculated every click.",type:"calculated"},{name:"target",display_name:"Data target when clicked",description:'"value" pushed will be a value,timestamp pair. Value defaults to a click counter',type:"target"}],newInstance:function(e,a){a(new t(e))}});var t=function(t){var a=this;a.currentSettings=t;var n="button-"+e++,i=$('<div class="button-widget button-label" id="__'+n+'"></div>'),r=$("<button/>",{type:"text",pattern:t.pattern,id:n}).html(t.html).css("width","95%"),o="#"+n;a.clickCount=0,a.value="",a.render=function(e){$(e).append(i),r.appendTo(i),$(o).attr("title",a.currentSettings.tooltip),$(o).on("click",async function(e){var n=a.clickCount;$(o).attr("disabled",!0).html(t.html+"(waiting)"),await a.processCalculatedSetting("value"),_.isUndefined(a.currentSettings.value)||(n=a.value),await a.dataTargets.target(n),a.clickCount+=1,$(o).attr("disabled",!1).html(t.html)}),$(o).removeClass("ui-widget-content")},a.getHeight=function(){return"big"==a.currentSettings.size?2:1},a.onSettingsChanged=function(e){a.currentSettings=e,a.currentSettings.unit=a.currentSettings.unit||"",$(o).attr("tooltip",e.placeholder)},a.onCalculatedValueChanged=function(e,t){"html"==e&&$(o).html(t),"value"==e&&(a.value=t)},a.onDispose=function(){}}}(),function(){freeboard.loadDatasourcePlugin({type_name:"document_database_plugin",display_name:"In-browser database",description:"DB for storing JSON records.",settings:[{name:"data",display_name:"Default Data(as JSON or JS expression)",type:"text",default_value:"={}",options:function(){return{"={key: 'value'}":""}},description:"Must be a valid JS =expression that returns an object. Whatever it returns will be the default data.",required:!0}],newInstance:function(t,a,n){a(new e(t,n))}});var e=async function(e,t){var a=this;a.makeDB=async function(){a.db=await nSQL().createDatabase({id:"my-db",mode:"TEMP",tables:[{name:"records",model:{".uuid:uuid":{pk:!0}}}]})},await a.makeDB();a.database=new alasql.Database,a.database.exec("CREATE TABLE one (two INT)"),a.handler={set:function(e,t,a){throw new Error("You can't set anything here, all DB properties are async.")}},a.data={query:function(e){nSQL().useDatabase("my_db");var t=nSQL("records").query("select");for(i in e)t=t.where([i,"=",e[i]]);return t.exec()},set:function(e){var t={};t.assign(e),t[".time"]=t[".time"]|1e3*Date.now(),t[".arrival"]=t[".arrival"]|1e3*Date.now(),t[".name"]=t[".name"]|String(1e3*Date.now()),nSQL().useDatabase("my_db"),nSQL("records").query("upsert",t).exec()}},a.proxy=new Proxy(a.data,a.handler),a.onSettingsChanged=function(e){e,a.data=freeboard.eval(e.data),t(a.proxy)},a.updateNow=function(){var e;e=a.proxy,t(e)},a.onDispose=function(){}}}(),function(){freeboard.loadDatasourcePlugin({type_name:"JSON",settings:[{name:"url",display_name:"URL",type:"text"},{name:"use_thingproxy",display_name:"Try thingproxy",description:'A direct JSON connection will be tried first, if that fails, a JSONP connection will be tried. If that fails, you can use thingproxy, which can solve many connection problems to APIs. <a href="https://github.com/Freeboard/thingproxy" target="_blank">More information</a>.',type:"boolean",default_value:!0},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5},{name:"method",display_name:"Method",type:"option",options:[{name:"GET",value:"GET"},{name:"POST",value:"POST"},{name:"PUT",value:"PUT"},{name:"DELETE",value:"DELETE"}]},{name:"body",display_name:"Body",type:"text",description:"The body of the request. Normally only used if method is POST"},{name:"headers",display_name:"Headers",type:"array",settings:[{name:"name",display_name:"Name",type:"text"},{name:"value",display_name:"Value",type:"text"}]}],newInstance:function(e,t,a){t(new function(e,t){var a=this,n=null,i=e,r=0,o=!1;function d(e){n&&clearInterval(n),n=setInterval(function(){a.updateNow()},e)}d(1e3*i.refresh),this.updateNow=function(){if(!(r>1&&!i.use_thingproxy||r>2)){var e=i.url;2==r&&i.use_thingproxy&&(e=("https:"==location.protocol?"https:":"http:")+"//thingproxy.freeboard.io/fetch/"+encodeURI(i.url));var n=i.body;if(n)try{n=JSON.parse(n)}catch(e){}$.ajax({url:e,dataType:1==r?"JSONP":"JSON",type:i.method||"GET",data:n,beforeSend:function(e){try{_.each(i.headers,function(t){var a=t.name,n=t.value;_.isUndefined(a)||_.isUndefined(n)||e.setRequestHeader(a,n)})}catch(e){}},success:function(e){o=!0,t(e)},error:function(e,t,n){o||(r++,a.updateNow())}})}},this.onDispose=function(){clearInterval(n),n=null},this.onSettingsChanged=function(e){o=!1,r=0,d(1e3*(i=e).refresh),a.updateNow()}}(e,a))}});freeboard.loadDatasourcePlugin({type_name:"openweathermap",display_name:"Open Weather Map API",settings:[{name:"api_key",display_name:"API Key",type:"text",description:"Your personal API Key from Open Weather Map"},{name:"location",display_name:"Location",type:"text",description:"Example: London, UK"},{name:"units",display_name:"Units",type:"option",default:"imperial",options:[{name:"Imperial",value:"imperial"},{name:"Metric",value:"metric"}]},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5}],newInstance:function(e,t,a){t(new function(e,t){var a=this,n=null,i=e;function r(e){n&&clearInterval(n),n=setInterval(function(){a.updateNow()},e)}r(1e3*i.refresh),this.updateNow=function(){$.ajax({url:"http://api.openweathermap.org/data/2.5/weather?APPID="+i.api_key+"&q="+encodeURIComponent(i.location)+"&units="+i.units,dataType:"JSONP",success:function(e){var a,n={place_name:e.name,sunrise:new Date(1e3*e.sys.sunrise).toLocaleTimeString(),sunset:new Date(1e3*e.sys.sunset).toLocaleTimeString(),conditions:(a=e.weather[0].description,a.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})),current_temp:e.main.temp,high_temp:e.main.temp_max,low_temp:e.main.temp_min,pressure:e.main.pressure,humidity:e.main.humidity,wind_speed:e.wind.speed,wind_direction:e.wind.deg};t(n)},error:function(e,t,a){}})},this.onDispose=function(){clearInterval(n),n=null},this.onSettingsChanged=function(e){i=e,a.updateNow(),r(1e3*i.refresh)}}(e,a))}});freeboard.loadDatasourcePlugin({type_name:"dweet_io",display_name:"Dweet.io",external_scripts:["http://dweet.io/client/dweet.io.min.js"],settings:[{name:"thing_id",display_name:"Thing Name",description:"Example: salty-dog-1",type:"text"}],newInstance:function(e,t,a){t(new function(e,t){var a=e;function n(e){t(e)}this.updateNow=function(){dweetio.get_latest_dweet_for(a.thing_id,function(e,t){e||n(t[0].content)})},this.onDispose=function(){},this.onSettingsChanged=function(e){dweetio.stop_listening_for(a.thing_id),a=e,dweetio.listen_for(a.thing_id,function(e){n(e.content)})},this.onSettingsChanged(e)}(e,a))}});freeboard.loadDatasourcePlugin({type_name:"playback",display_name:"Playback",settings:[{name:"datafile",display_name:"Data File URL",type:"text",description:"A link to a JSON array of data."},{name:"is_jsonp",display_name:"Is JSONP",type:"boolean"},{name:"loop",display_name:"Loop",type:"boolean",description:"Rewind and loop when finished"},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5}],newInstance:function(e,t,a){t(new function(e,t){var a,n=this,i=e,r=[],o=0;function d(){r.length>0?(o<r.length&&(t(r[o]),o++),o>=r.length&&i.loop&&(o=0),o<r.length&&(a=setTimeout(d,1e3*i.refresh))):t({})}function l(){r=[],o=0,a&&(clearTimeout(a),a=null)}this.updateNow=function(){l(),$.ajax({url:i.datafile,dataType:i.is_jsonp?"JSONP":"JSON",success:function(e){r=_.isArray(e)?e:[],o=0,d()},error:function(e,t,a){}})},this.onDispose=function(){l()},this.onSettingsChanged=function(e){i=e,n.updateNow()}}(e,a))}});freeboard.loadDatasourcePlugin({type_name:"clock",display_name:"Clock",settings:[{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:1},{name:"strftime",display_name:"Strftime String for custom_value",type:"text",suffix:"seconds",default_value:"%I:%M:%S %p %b %d %Y"}],newInstance:function(e,t,a){t(new function(e,t){var a,n=this,i=e;function r(){a&&(clearTimeout(a),a=null)}function o(){r(),a=setInterval(n.updateNow,1e3*i.refresh)}this.updateNow=function(){var e=new Date,a="";i.strftime&&(a=strftime(i.strftime,e));var n={numeric_value:e.getTime(),custom_value:a,full_string_value:e.toLocaleString(),date_string_value:e.toLocaleDateString(),time_string_value:e.toLocaleTimeString(),date_object:e};t(n)},this.onDispose=function(){r()},this.onSettingsChanged=function(e){i=e,o()},o()}(e,a))}}),freeboard.loadDatasourcePlugin({type_name:"meshblu",display_name:"Octoblu",description:"app.octoblu.com",external_scripts:["http://meshblu.octoblu.com/js/meshblu.js"],settings:[{name:"uuid",display_name:"UUID",type:"text",default_value:"device uuid",description:"your device UUID",required:!0},{name:"token",display_name:"Token",type:"text",default_value:"device token",description:"your device TOKEN",required:!0},{name:"server",display_name:"Server",type:"text",default_value:"meshblu.octoblu.com",description:"your server",required:!0},{name:"port",display_name:"Port",type:"number",default_value:80,description:"server port",required:!0}],newInstance:function(t,a,n){a(new e(t,n))}});var e=function(e,t){var a=e;this.onSettingsChanged=function(e){a=e},this.updateNow=function(){var e;(e=skynet.createConnection({uuid:a.uuid,token:a.token,server:a.server,port:a.port})).on("ready",function(a){e.on("message",function(e){t(e)})})},this.onDispose=function(){}}}(),function(){var e=100,t=["#FF9900","#FFFFFF","#B3B4B4","#6B6B6B","#28DE28","#13F7F9","#E6EE18","#C41204","#CA3CB8","#0B1CFB"];function a(a,n,i){var r=$(a).data().values,o=$(a).data().valueMin,d=$(a).data().valueMax;r||(r=[],o=void 0,d=void 0);var l=function(t,a){r[a]||(r[a]=[]),r[a].length>=e&&r[a].shift(),r[a].push(Number(t)),(void 0===o||t<o)&&(o=t),(void 0===d||t>d)&&(d=t)};_.isArray(n)?_.each(n,l):l(n,0),$(a).data().values=r,$(a).data().valueMin=o,$(a).data().valueMax=d;var s='<span style="color: {{color}}">&#9679;</span> {{y}}',u=!1;_.each(r,function(e,n){$(a).sparkline(e,{type:"line",composite:u,height:"100%",width:"100%",fillColor:!1,lineColor:t[n%t.length],lineWidth:2,spotRadius:3,spotColor:!1,minSpotColor:"#78AB49",maxSpotColor:"#78AB49",highlightSpotColor:"#9D3926",highlightLineColor:"#9D3926",chartRangeMin:o,chartRangeMax:d,tooltipFormat:i&&i[n]?s+" ("+i[n]+")":s}),u=!0})}var n=freeboard.getStyleString("values");freeboard.addStyle(".widget-big-text",n+"font-size:75px;"),freeboard.addStyle(".tw-display","width: 100%; height:100%; display:table; table-layout:fixed;"),freeboard.addStyle(".tw-tr","display:table-row;"),freeboard.addStyle(".tw-tg","display:table-row-group;"),freeboard.addStyle(".tw-tc","display:table-caption;"),freeboard.addStyle(".tw-td","display:table-cell;"),freeboard.addStyle(".tw-value",n+"overflow: hidden;display: inline-block;text-overflow: ellipsis;"),freeboard.addStyle(".tw-unit","display: inline-block;padding-left: 10px;padding-bottom: 1.1em;vertical-align: bottom;"),freeboard.addStyle(".tw-value-wrapper","position: relative;vertical-align: middle;height:100%;"),freeboard.addStyle(".tw-sparkline","height:20px;");var i=function(e){var t=e,n=$('<div class="tw-display"></div>'),i=$('<h2 class="section-title tw-title tw-td"></h2>'),r=$('<div class="tw-value"></div>'),o=$('<div class="tw-unit"></div>'),d=$('<div class="tw-sparkline tw-td"></div>');function l(){_.isUndefined(t.units)||""==t.units?r.css("max-width","100%"):r.css("max-width",n.innerWidth()-o.outerWidth(!0)+"px")}this.render=function(e){$(e).empty(),$(n).append($('<div class="tw-tr"></div>').append(i)).append($('<div class="tw-tr"></div>').append($('<div class="tw-value-wrapper tw-td"></div>').append(r).append(o))).append($('<div class="tw-tr"></div>').append(d)),$(e).append(n),l()},this.onSettingsChanged=function(e){t=e;var a=!_.isUndefined(e.title)&&""!=e.title,n=!_.isUndefined(e.units)&&""!=e.units;e.sparkline?d.attr("style",null):(delete d.data().values,d.empty(),d.hide()),a?(i.html(_.isUndefined(e.title)?"":e.title),i.attr("style",null)):(i.empty(),i.hide()),n?(o.html(_.isUndefined(e.units)?"":e.units),o.attr("style",null)):(o.empty(),o.hide());var s=30;"big"==e.size&&(s=75,e.sparkline&&(s=60)),r.css({"font-size":s+"px"}),l()},this.onSizeChanged=function(){l()},this.onCalculatedValueChanged=function(e,n){"value"==e&&(t.animate?function(e,t,a){var n=$(t).text();if(n!=e)if($.isNumeric(e)&&$.isNumeric(n)){var i=e.toString().split("."),r=0;i.length>1&&(r=i[1].length);var o=0;(i=n.toString().split(".")).length>1&&(o=i[1].length),jQuery({transitionValue:Number(n),precisionValue:o}).animate({transitionValue:Number(e),precisionValue:r},{duration:a,step:function(){$(t).text(this.transitionValue.toFixed(this.precisionValue))},done:function(){$(t).text(e)}})}else $(t).text(e)}(n,r,500):r.text(n),t.sparkline&&a(d,n))},this.onDispose=function(){},this.getHeight=function(){return"big"==t.size||t.sparkline?2:1},this.onSettingsChanged(e)};freeboard.loadWidgetPlugin({type_name:"text_widget",display_name:"Text",settings:[{name:"title",display_name:"Title",type:"text"},{name:"size",display_name:"Size",type:"option",options:[{name:"Regular",value:"regular"},{name:"Big",value:"big"}]},{name:"value",display_name:"Value",type:"calculated"},{name:"sparkline",display_name:"Include Sparkline",type:"boolean"},{name:"animate",display_name:"Animate Value Changes",type:"boolean",default_value:!0},{name:"units",display_name:"Units",type:"text",options:function(){return{lbs:"",kgs:"",psi:"",meters:"",feet:"",mm:"",degC:"",degF:""}}}],newInstance:function(e,t){t(new i(e))}});var r=0;freeboard.addStyle(".gauge-widget-wrapper","width: 100%;text-align: center;"),freeboard.addStyle(".gauge-widget","width:200px;height:160px;display:inline-block;");freeboard.loadWidgetPlugin({type_name:"gauge",display_name:"Gauge",settings:[{name:"title",display_name:"Title",type:"text"},{name:"value",display_name:"Value",type:"calculated"},{name:"units",display_name:"Units",type:"text"},{name:"min_value",display_name:"Minimum",type:"text",default_value:0},{name:"max_value",display_name:"Maximum",type:"text",default_value:100}],newInstance:function(e,t){t(new function(e){var t,a="gauge-"+r++,n=$('<h2 class="section-title"></h2>'),i=$('<div class="gauge-widget" id="'+a+'"></div>'),o=!1,d=e;function l(){o&&(i.empty(),t=new JustGage({id:a,value:_.isUndefined(d.min_value)?0:d.min_value,min:_.isUndefined(d.min_value)?0:d.min_value,max:_.isUndefined(d.max_value)?0:d.max_value,label:d.units,showInnerShadow:!1,valueFontColor:"#d3d4d4"}))}this.render=function(e){o=!0,$(e).append(n).append($('<div class="gauge-widget-wrapper"></div>').append(i)),l()},this.onSettingsChanged=function(e){e.min_value!=d.min_value||e.max_value!=d.max_value||e.units!=d.units?(d=e,l()):d=e,n.html(e.title)},this.onCalculatedValueChanged=function(e,a){_.isUndefined(t)||t.refresh(Number(a))},this.onDispose=function(){},this.getHeight=function(){return 3},this.onSettingsChanged(e)}(e))}}),freeboard.addStyle(".sparkline","width:100%;height: 75px;");var o=function(e){var n=$('<h2 class="section-title"></h2>'),i=$('<div class="sparkline"></div>'),r=$("<div></div>"),o=e;this.render=function(e){$(e).append(n).append(i).append(r)},this.onSettingsChanged=function(e){o=e,n.html(_.isUndefined(e.title)?"":e.title),e.include_legend&&function(e,a){for(var n=$("<div class='sparkline-legend'></div>"),i=0;i<a.length;i++){var r=t[i%t.length],o=a[i];n.append("<div class='sparkline-legend-value'><span style='color:"+r+"'>&#9679;</span>"+o+"</div>")}e.empty().append(n),freeboard.addStyle(".sparkline-legend","margin:5px;"),freeboard.addStyle(".sparkline-legend-value","color:white; font:10px arial,san serif; float:left; overflow:hidden; width:50%;"),freeboard.addStyle(".sparkline-legend-value span","font-weight:bold; padding-right:5px;")}(r,e.legend.split(","))},this.onCalculatedValueChanged=function(e,t){o.legend?a(i,t,o.legend.split(",")):a(i,t)},this.onDispose=function(){},this.getHeight=function(){var e=0;if(o.include_legend&&o.legend){var t=o.legend.split(",").length;t>4?e=.5*Math.floor((t-1)/4):t&&(e=.5)}return 2+e},this.onSettingsChanged(e)};freeboard.loadWidgetPlugin({type_name:"sparkline",display_name:"Sparkline",settings:[{name:"title",display_name:"Title",type:"text"},{name:"value",display_name:"Value",type:"calculated",multi_input:"true"},{name:"include_legend",display_name:"Include Legend",type:"boolean"},{name:"legend",display_name:"Legend",type:"text",description:"Comma-separated for multiple sparklines"}],newInstance:function(e,t){t(new o(e))}}),freeboard.addStyle("div.pointer-value","position:absolute;height:95px;margin: auto;top: 0px;bottom: 0px;width: 100%;text-align:center;");freeboard.loadWidgetPlugin({type_name:"pointer",display_name:"Pointer",settings:[{name:"direction",display_name:"Direction",type:"calculated",description:"In degrees"},{name:"value_text",display_name:"Value Text",type:"calculated"},{name:"units",display_name:"Units",type:"text"}],newInstance:function(e,t){t(new function(e){var t,a,n,i,r=$('<div class="widget-big-text"></div>'),o=$("<div></div>");this.render=function(e){n=$(e).width(),i=$(e).height();var d=Math.min(n,i)/2-6,l=(t=Raphael($(e).get()[0],n,i)).circle(n/2,i/2,d);l.attr("stroke","#FF9900"),l.attr("stroke-width",3),(a=t.path(function(e){if(!e||e.length<2)return[];var t=[];t.push(["m",e[0],e[1]]);for(var a=2;a<e.length;a+=2)t.push(["l",e[a],e[a+1]]);return t.push(["z"]),t}([n/2,i/2-d+3,15,20,-30,0]))).attr("stroke-width",0),a.attr("fill","#fff"),$(e).append($('<div class="pointer-value"></div>').append(r).append(o))},this.onSettingsChanged=function(e){o.html(e.units)},this.onCalculatedValueChanged=function(e,t){"direction"==e?_.isUndefined(a)||a.animate({transform:"r"+t+","+n/2+","+i/2},250,"bounce"):"value_text"==e&&r.html(t)},this.onDispose=function(){},this.getHeight=function(){return 4},this.onSettingsChanged(e)}(e))}});freeboard.loadWidgetPlugin({type_name:"picture",display_name:"Picture",fill_size:!0,settings:[{name:"src",display_name:"Image URL",type:"calculated"},{type:"number",display_name:"Refresh every",name:"refresh",suffix:"seconds",description:"Leave blank if the image doesn't need to be refreshed"}],newInstance:function(e,t){t(new function(e){var t,a,n;function i(){a&&(clearInterval(a),a=null)}function r(){if(t&&n){var e=n;$(t).css({"background-image":"url("+e+")"})}}this.render=function(e){$(e).css({width:"100%",height:"100%","background-size":"cover","background-position":"center"}),t=e},this.onSettingsChanged=function(e){i(),e.refresh&&e.refresh>0&&(a=setInterval(r,1e3*Number(e.refresh)))},this.onCalculatedValueChanged=function(e,t){"src"==e&&(n=t),r()},this.onDispose=function(){i()},this.getHeight=function(){return 4},this.onSettingsChanged(e)}(e))}}),freeboard.addStyle(".indicator-light","border-radius:50%;width:22px;height:22px;border:2px solid #3d3d3d;margin-top:5px;float:left;background-color:#222;margin-right:10px;"),freeboard.addStyle(".indicator-light.on","background-color:#FFC773;box-shadow: 0px 0px 15px #FF9900;border-color:#FDF1DF;"),freeboard.addStyle(".indicator-text","margin-top:10px;");freeboard.loadWidgetPlugin({type_name:"indicator",display_name:"Indicator Light",settings:[{name:"title",display_name:"Title",type:"text"},{name:"value",display_name:"Value",type:"calculated"},{name:"on_text",display_name:"On Text",type:"calculated"},{name:"off_text",display_name:"Off Text",type:"calculated"}],newInstance:function(e,t){t(new function(e){var t,a,n=$('<h2 class="section-title"></h2>'),i=$('<div class="indicator-text"></div>'),r=$('<div class="indicator-light"></div>'),o=e,d=!1;function l(){r.toggleClass("on",d),d?i.text(_.isUndefined(t)?_.isUndefined(o.on_text)?"":o.on_text:t):i.text(_.isUndefined(a)?_.isUndefined(o.off_text)?"":o.off_text:a)}this.render=function(e){$(e).append(n).append(r).append(i)},this.onSettingsChanged=function(e){o=e,n.html(_.isUndefined(e.title)?"":e.title),l()},this.onCalculatedValueChanged=function(e,n){"value"==e&&(d=Boolean(n)),"on_text"==e&&(t=n),"off_text"==e&&(a=n),l()},this.onDispose=function(){},this.getHeight=function(){return 1},this.onSettingsChanged(e)}(e))}}),freeboard.addStyle(".gm-style-cc a","text-shadow:none;"),freeboard.addStyle(".html-widget","white-space:normal;width:100%;height:100%");freeboard.loadWidgetPlugin({type_name:"html",display_name:"Show computed HTML",fill_size:!0,settings:[{name:"html",display_name:"HTML",type:"calculated",description:"Can be literal HTML, or javascript that outputs HTML."},{name:"height",display_name:"Height Blocks",type:"number",default_value:4,description:"A height block is around 60 pixels"}],newInstance:function(e,t){t(new function(e){var t=$('<div class="html-widget"></div>'),a=e;this.render=function(e){$(e).append(t)},this.onSettingsChanged=function(e){a=e},this.onCalculatedValueChanged=function(e,a){"html"==e&&t.html(a)},this.onDispose=function(){},this.getHeight=function(){return Number(a.height)},this.onSettingsChanged(e)}(e))}})}(),function(){freeboard.loadDatasourcePlugin({type_name:"core_scratchpad_plugin",display_name:"Scratchpad Variables",description:"The data is just an empty space.  To set some data, use datasources['scratchpad']['SomeName'] as a data target.  It will be available to read in other widgets.  You can also set the default data using JSON.",settings:[{name:"data",display_name:"Default Data(as JSON or JS expression)",type:"calculated",default_value:"={}",options:function(){return{"={key: 'value'}":""}},description:"Must be a valid JS =expression that returns an object. Whatever it returns will be the default data.",required:!0},{name:"persist",display_name:"Persistance Mode",type:"option",default_value:"off",options:[{name:"Off",value:"off"},{name:"Board",value:"board"}],description:"off: no persistance,  board: changes are passed to the Default Data field and can be exported with the board.",required:!0},{name:"lock",display_name:"Lock data(read only)",type:"boolean",default_value:!1},{name:"",display_name:"",html:"Show current data",type:"button",onclick:function(e,t){freeboard.showDialog(JSON.stringify(t.data),"Debug data for: "+e+" (non-JSON not shown)","OK")},description:""},{name:"",display_name:"",html:"Show current data in JSON editor",type:"button",description:"",onclick:function(e,t){var a=[];freeboard.showDialog($('<div id="fb-global-json-editor">'),"Debug data for: "+e+" (non-JSON not shown)","OK","Cancel",function(){Object.assign(t.proxy,a[0].getValue()),a[0].destroy()},function(){a[0].destroy()});var n=new JSONEditor(document.getElementById("fb-global-json-editor"),{schema:{}});a.push(n),n.setValue(t.data)}}],newInstance:function(t,a,n){a(new e(t,n))}});var e=function(e,t){var a=this,n=e;a.handler={set:function(e,i,r){if(n.lock)throw new Error("Cannot change this. It is locked in the datasource settings");return e[i]=r,t(a.proxy),"board"==n.persist&&(n.data="="+JSON.stringify(e),freeboard.setDatasourceSettings(n.name,e)),!0}},a.data={},a.proxy=new Proxy(a.data,a.handler),a.onSettingsChanged=function(e){n=e,t(a.proxy)},a.onCalculatedSettingChanged=function(e,n){"data"==e&&(a.data=n,a.proxy=new Proxy(a.data,a.handler),t(a.proxy))},a.updateNow=function(){var e;e=a.proxy,t(e)},a.onDispose=function(){}}}(),function(){var e=0;freeboard.addStyle(".slider","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".slider-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-slider-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-slider-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"slider_plugin",display_name:"Slider",description:"Interactive Slider Plugin with 2-way data binding.  Value is a list of 2 items, the value and the timestamp.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text"},{name:"unit",display_name:"Unit of measure",type:"text"},{name:"min",display_name:"Min",type:"calculated",default_value:"0"},{name:"max",display_name:"Max",type:"calculated",default_value:"100"},{name:"step",display_name:"Step",type:"calculated",default_value:"1"},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When Released",value:"change"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be a value, timestamp pair.",type:"target"}],newInstance:function(e,a){a(new t(e))}});var t=function(t){var a=this;currentSettings=t,currentSettings.unit=currentSettings.unit||"";var n="slider-"+e++,i=$('<div class="slider-widget slider-label" id="__'+n+'"></div>'),r=$('<h2 class="section-title slider-label"></h2>'),o=$('<div id="value-'+n+'" style="display:inline-block; padding-left: 10px; font-weight:bold; color: #d3d4d4" ></div>'),d=$("<input/>",{type:"range",id:n}),l="#"+n,s="#value-"+n;_.isUndefined(currentSettings.value)||currentSettings.value;r.html(_.isUndefined(currentSettings.title)?"":currentSettings.title),a.min=_.isUndefined(currentSettings.min)?0:currentSettings.min,a.max=_.isUndefined(currentSettings.max)?100:currentSettings.max,a.step=_.isUndefined(currentSettings.step)?100:currentSettings.step,a.value=currentSettings.value||0;a.render=function(e){$(e).append(i),r.appendTo(i),$(r).append(o),d.appendTo(i),$(l).attr("min",a.min),$(l).attr("max",a.max),$(l).attr("step",a.step),$(l).css("width","95%"),$(l).on("input",function(e){$("#value-"+n).html(e.value)}),$(s).html(a.value+currentSettings.unit),$(l).on("change",function(e){a.dataTargets.target(parseFloat(e.target.value))}),$(l).on("input",function(e){a.value=e.target.value,$(s).html(e.target.value+currentSettings.unit),"change"!=currentSettings.mode&&a.dataTargets.target(parseFloat(e.target.value))}),$(l).removeClass("ui-widget-content")},a.getHeight=function(){return"big"==currentSettings.size?2:1},a.onSettingsChanged=function(e){currentSettings=e,r.html(_.isUndefined(e.title)?"":e.title),$(r).append(o),currentSettings.unit=currentSettings.unit||"",$(s).html(a.value+currentSettings.unit)},a.onCalculatedValueChanged=function(e,t){if("target"==e){a.value=t;var n=t;$(o).html(n+currentSettings.unit),n!=$(l).val()&&$(l).val(n)}"step"==e&&(a.step=t,$(l).attr("step",a.step)),"max"==e&&(t>a.min?(a.max=t,$(l).attr("max",t)):(currentSettings.max=a.max,freeboard.showDialog($("<div align='center'> Max value cannot be lower than Min value!</div>"),"Warning!","OK",null,function(){}))),"min"==e&&(t<a.max?(a.min=t,$(l).attr("min",t)):(currentSettings.min=a.min,freeboard.showDialog($("<div align='center'> Min value cannot be greater than Max value!</div>"),"Warning!","OK",null,function(){})))},a.onDispose=function(){}}}(),function(){var e=0;freeboard.loadWidgetPlugin({type_name:"switch_plugin",display_name:"Switch",description:"Interactive on-off switch",settings:[{name:"title",display_name:"Title",type:"text"},{name:"target",display_name:"Data Target",type:"target",description:"Bind state to this datasource"},{name:"on_text",display_name:"On Text",type:"text",default_value:"On"},{name:"off_text",display_name:"Off Text",type:"text",default_value:"Off"}],newInstance:function(e,a){a(new t(e))}}),freeboard.addStyle(".floating-box","display: inline-block; vertical-align: top; width: 78px; background-color: #222;margin-top: 10px; margin-right: 5px;"),freeboard.addStyle(".onoffswitch-title","font-size: 17px; line-height: 29px; width: 65%; height: 29px; padding-left: 10px;border: 1px solid #3d3d3d;"),freeboard.addStyle(".round","border-radius: 50%;");var t=function(t){var a=this,n="onoffswitch-"+e++,i=$('<div class="floating-box"></div>'),r=$('<div class="floating-box onoffswitch-title">'+t.title+"</div>"),o=$('<div class="onoffswitch"><label class="onoffswitch-label" for="'+n+'"><div class="onoffswitch-inner"><span class="on"></span><span class="off"></span></div><div class="onoffswitch-switch round"></div></label></div>');function d(){$("#"+n).prop("checked",a.isOn),console.log(o.find("span.on")),o.find("span.on").text(a.onText),o.find("span.off").text(a.offText)}o.prependTo(i),a.isOn=!1,this.render=function(e){$(e).append(i).append(r);$('<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="'+n+'">').prependTo(o).change(function(e){a.isOn=e.target.checked,a.dataTargets.target(a.isOn)})},this.onSettingsChanged=function(e){e,r.html(_.isUndefined(e.title)?"":e.title),console.log("isUndefined on_text: "+_.isUndefined(e.on_text)),a.onText=e.on_text,a.offText=e.off_text,d()},this.onCalculatedValueChanged=function(e,t){if(console.log(e,t),"target"==e){var n=t;a.isOn=Boolean(n)}d()},this.onDispose=function(){},this.getHeight=function(){return 1},this.onSettingsChanged(t)}}(),function(){var e=0;freeboard.addStyle(".textbox","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".textbox-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-textbox-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-textbox-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"textbox_plugin",display_name:"Text Box",description:"Interactive Textbox Plugin with 2-way data binding.  Value is a list of 2 items, the value and the timestamp.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text",default_value:""},{name:"tooltip",display_name:"Tooltip hint",type:"text",default_value:""},{name:"pattern",display_name:"Validation Regex",type:"text",default_value:".*"},{name:"placeholder",display_name:"Placeholder text",type:"calculated",default_value:""},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When element loses focus",value:"change"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be a value, timestamp pair.",type:"target"}],newInstance:function(e,a){a(new t(e))}});var t=function(t){var a=this;a.currentSettings=t;var n="textbox-"+e++,i=$('<div class="textbox-widget textbox-label" id="__'+n+'"></div>'),r=$('<h2 class="section-title textbox-label"></h2>'),o=$("<input/>",{type:"text",pattern:t.pattern,id:n,name:n}).css("width","90%"),d="#"+n,l="#value-"+n;r.html(a.currentSettings.title),a.value="";a.render=function(e){$(e).append(i),r.appendTo(i),o.appendTo(i),$(d).attr("placeholder",a.currentSettings.placeholder),$(d).attr("title",a.currentSettings.tooltip),$(d).attr("pattern",a.currentSettings.pattern),$(l).html(a.value+a.currentSettings.unit),$(d).on("change",function(e){a.dataTargets.target(e.target.value)}),$(d).on("input",function(e){a.value=e.target.value,$(l).html(e.target.value+a.currentSettings.unit),"change"!=a.currentSettings.mode&&(_.isUndefined(a.currentSettings.target)||a.dataTargets.target(e.target.value))}),$(d).removeClass("ui-widget-content")},a.getHeight=function(){return"big"==a.currentSettings.size?2:1},a.onSettingsChanged=function(e){a.currentSettings=e,r.html(_.isUndefined(e.title)?"":e.title),a.currentSettings.unit=a.currentSettings.unit||"",$(d).attr("pattern",e.pattern),$(d).attr("placeholder",e.placeholder),$(d).attr("tooltip",e.placeholder)},a.onCalculatedValueChanged=function(e,t){if("target"==e){a.value=t;var n=t;n!=$(d).val()&&$(d).val(n)}"placeholder"==e&&$(d).attr("placeholder",t)},a.onDispose=function(){}}}();