var Button=function(e){jsGrid.Field.call(this,e)};function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}Button.prototype=new jsGrid.Field({align:"center",sorter:function(e,t){return 0},itemTemplate:function(e,t){return $("<input>").on("click",function(){this.fn(t)}).title(this.title)},insertTemplate:function(e,t){return""},editTemplate:function(e,t){return $("<input>").on("click",function(){this.fn(t)}).title(this.title)},insertValue:function(){return""},editValue:function(){return""}}),jsGrid.fields.button=Button,function(){var e=0;freeboard.addStyle(".datagrid","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".datagrid-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-datagrid-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-datagrid-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"jsGrid",display_name:"jsGrid Data grid View Plugin",description:"Database grid view. Data is an array of objects.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text",default_value:""},{name:"backend",display_name:"Data backend. Can be any array, or a freeboard DB controller datasource.",type:"target",default_value:"=[]"},{name:"selection",display_name:"Selection",description:"Selection gets assigned here. If no selection, empty obj.  Set obj.arrival to save changes back to array(The data doesn't matter, it reads as the time when it was set.)",type:"target",default_value:""},{name:"columns",type:"json",display_name:"Columns",schema:{type:"array",items:{type:"object",additionalProperties:!1,properties:{title:{type:"string",required:!0},name:{type:"string",title:"Data column",required:!0},type:{type:"string",title:"Type",required:!0,enum:["control","text","number","checkbox","textarea"]},width:{type:"number",title:"Width(px)",required:!0,default:40}}}},default_value:[{type:"text",title:"Name",name:"name",width:50},{type:"control",title:"",name:"",width:40}]}],newInstance:function(e,a){a(new t(e))}});var t=function(t){if(t.backend&&t.data)throw new Error("Cannot use both the backend and the data options at the same time");var a=this;a.currentSettings=t,a.data=[];var n="datagrid-"+e++,r=$('<div class="datagrid-widget datagrid-label" id="__'+n+'"></div>'),o=$('<h2 class="section-title datagrid-label"></h2>'),d=$("<div>",{id:n}).css("width","90%").css("height","400px"),l="#"+n,s="#value-"+n;a.backend=0,a.makeExternalEditRow=function(e){return new Proxy(e,{set:function(e,t,n){"arrival"==t?(e.arrival=1e3*Date.now(),e.time=1e3*Date.now(),a.upsert(e),$(l).jsGrid("refresh")):(e.time=1e3*Date.now(),e[t]=n)}})};var u=function(e){e.id=e.id||uuidv4(),e.name=e.name||e.id,e.time=e.time||parseInt(1e3*Date.now()),e.arrival=e.arrival||e.time};a.upsert=function(e){if(e){if(a.backend)return a.backend.insertItem(e);for(i of(void 0!=a.data&&""!=a.data||(a.data=[]),u(e),a.data))if(i.id==e.id){if(_.isEqual(i,e))return;if(i.time>=e.time)return;return Object.assign(i,e),void a.dataTargets.backend(a.data)}a.data.push(e),a.dataTargets.backend(a.data)}},a.arrayController={deleteItem:function(e){for(i of(_.isEqual(i.selection,e)&&a.setSelection({}),a.data))i.id==e.id&&(a.data=_.without(a.data,i));a.dataTargets.backend(a.data)},updateItem:a.upsert,insertItem:a.upsert,loadData:function(e){var t=nSQL(a.data||[]).query("select");for(i in e)!e[i]||["sortField","sortOrder","pageIndex","pageSize"].indexOf(i)>-1||(t=t.where(["LOWER("+i+")","=",String(e[i]).toLowerCase()]));e.sortOrder&&(t=t.orderBy([e.sortField+" "+e.sortOrder.toUpperCase()])),t=t.limit(e.pageSize).offset((e.pageIndex-1)*e.pageSize);return async function(){return{data:await t.exec(),itemsCount:a.data.length}}()}},a.setSelection=function(e){a.dataTargets.selection(a.makeExternalEditRow(e))},a.acceptData=function(e){for(f in 0==e&&(e=a.data),a.data=e,a.data)u(f)},a.refreshGrid=function(e){for(f in 0==e&&(e=a.data),a.data=e,a.data)u(f);$(l).jsGrid("destroy");var t=function(){a.dataTargets.backend(a.data)},n=[];for(i of a.currentSettings.columns||[]){var r={};Object.assign(r,i),n.push(r)}var o={width:"95%",height:"250px",inserting:!0,editing:!0,sorting:!0,paging:!0,pageLoading:!0,filtering:!0,rowClick:function(e){a.setSelection(e.item)},controller:a.backend||a.arrayController,fields:n};0==a.backend&&(o.onItemDeleted=t,o.onItemUpdated=t,o.onItemInserted=t),$(l).jsGrid(o),$(l).jsGrid("loadData");try{textFit($(".jsgrid-header-cell:not(.jsgrid-control-field)"))}catch(e){console.log(e)}},$(l).jsGrid("refresh"),o.html(a.currentSettings.title),a.value=a.currentSettings.value||0;a.render=function(e){$(e).append(r),o.appendTo(r),d.appendTo(r),a.refreshGrid(0),$(s).html(a.value+a.currentSettings.unit),$(l).removeClass("ui-widget-content")},a.getHeight=function(){return 6},a.onSettingsChanged=function(e){if(e.backend&&e.data)throw new Error("Cannot use both the backend and the data options at the same time");a.currentSettings=e,o.html(_.isUndefined(e.title)?"":e.title),a.currentSettings.unit=a.currentSettings.unit||"",a.refreshGrid(0),a.setSelection({})},a.onCalculatedValueChanged=function(e,t){"columns"==e&&a.refreshGrid(0),"backend"==e&&("function"==typeof t.loadData?a.backend?(a.backend=t,$(l).jsGrid("loadData")):(a.backend=t,a.refreshGrid(0)):a.backend?(a.backend=0,a.acceptData(t||[]),a.refreshGrid(0)):(a.acceptData(t||[]),$(l).jsGrid("loadData")))},a.onDispose=function(){$(l).jsGrid("destroy")}}}();var htmlWidget=function(e){var t=this;t.id=freeboard.genUUID(),t.fs=0;var a=$('<div style="overflow:auto;height:100%;width:auto;padding:0px;display:flex;flex-direction:column;"></div>'),n=$('<div class="freeboard-hover-unhide" style="border-radius:4px; overflow:hidden;background-color:var(--widget-bg-color);width:100%;padding:3px;margin:0px;position:absolute;user-select: none;opacity:0;"></div>'),i=$("<button></button>").on("click",function(){t.fs?(t.fs=0,document.body.style.setProperty("--box-backdrop",t.backup),a.css({height:"100%",width:"100%",position:"static","z-index":"auto","background-color":"transparent"}),a.css({"background-image":d.background||""}),a.css({"background-repeat":d.backgroundRepeat||""}),a.css({"background-size":d.backgroundSize||""})):(t.fs=1,t.backup=getComputedStyle(document.body).getPropertyValue("--box-backdrop"),document.body.style.setProperty("--box-backdrop","initial"),a.css({height:"100vh",width:"100vw",position:"fixed","z-index":"100",top:"0px",left:"0px","background-color":getComputedStyle(document.body).getPropertyValue("--box-bg-color")}),a.css({"background-image":d.background||""}),a.css({"background-repeat":d.backgroundRepeat||""}),a.css({"background-size":d.backgroundSize||""}))}),r=$("<button></button>").on("click",function(){printJS(t.id,"html")});n.append(r),n.append(i);var o=$('<div class="html-widget" style="width:100%; height:auto; margin:0px;padding:0px;flex-grow:100;"></div>').attr("id",t.id),d=e;t.data={},this.updateData=function(){t.data&&"object"==typeof t.data?o.html(Mustache.render(d.html||"",t.data)):o.html(d.html||"")},this.render=function(e){$(e).append(a),a.append(n),n.append(),a.append(o),t.updateData()},this.onSettingsChanged=function(e){d=e,t.updateData(),e.toolbar?n.css({display:"block"}):n.css({display:"none"}),a.css({background:e.background||""}),a.css({"background-repeat":e.backgroundRepeat||""}),a.css({"background-size":e.backgroundSize||""})},this.onCalculatedValueChanged=function(e,a){"html"==e&&t.updateData(),"data"==e&&(t.data=a,t.updateData())},this.onDispose=function(){},this.getHeight=function(){return Number(d.height)},this.onSettingsChanged(e)};function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}freeboard.loadWidgetPlugin({type_name:"html-template",display_name:"Rich Text Content",fill_size:!0,settings:[{name:"html",display_name:"HTML",type:"html-wysywig",description:"HTML template.  You can paste images here, they are stored in the freeboard config itself as base64."},{name:"data",display_name:"Variables to use",type:"calculated",default_value:"={varName: 'value'}",description:"Variables to use in Mustache templating, as a JS object.  Access a var with {{varname}} in your document template, it gets replaced with the value."},{name:"background",display_name:"Background",type:"text",default_value:"transparent",description:"CSS Background(try 'blue' or 'url(--my-image) cover')",options:freeboard.getAvailableCSSImageVars},{name:"backgroundRepeat",display_name:"Background Repeat",type:"option",options:[{name:"no-repeat",value:"no-repeat"},{name:"Tile/Repeat",value:"repeat"}]},{name:"backgroundSize",display_name:"Background Image Size",type:"option",options:[{name:"Cover",value:"cover"},{name:"Contain",value:"contain"},{name:"auto/actual size",value:"auto"}]},{name:"background",display_name:"Background",type:"text",default_value:"transparent",description:"CSS Background(try 'blue' or 'url(--my-image) cover')",options:freeboard.getAvailableCSSImageVars},{name:"height",display_name:"Height Blocks",type:"number",default_value:4,description:"A height block is around 60 pixels"},{name:"toolbar",display_name:"Show toolbar",type:"boolean",default_value:!1,description:"Fullscreen and print options"}],newInstance:function(e,t){t(new htmlWidget(e))}}),function(){var e=0;freeboard.addStyle(".button","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".button-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-button-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-button-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"button_plugin",display_name:"Button",description:"DataTarget compatible button that can run JS code when clicked",fill_size:!0,settings:[{name:"html",display_name:"Button Contents",type:"calculated",default_value:"<i>Button</i>"},{name:"tooltip",display_name:"Tooltip hint",type:"text",default_value:""},{name:"value",display_name:"Value",description:"This value gets pushed to the target when clicked.  If empty, a simple counter is used.  It recalculated every click.",type:"calculated"},{name:"target",display_name:"Data target when clicked",description:'"value" pushed defaults to a click counter',type:"target"},{name:"sound",display_name:"Sound(URL or builtin)",type:"text",default_value:"",options:freeboard.getAvailableSounds},{name:"height",display_name:"Height(px)",type:"number",default_value:30}],newInstance:function(e,a){a(new t(e))}});var t=function(t){var a=this;a.currentSettings=t;var n="button-"+e++,i=$('<div class="button-widget button-label" id="__'+n+'"></div>'),r=$("<button/>",{class:"fullwidth-button",type:"text",pattern:t.pattern,id:n}).html(t.html).css("width","95%").css("height",a.currentSettings.height+"px"),o="#"+n;a.clickCount=0,a.value="",a.render=function(e){$(e).append(i),r.appendTo(i),$(o).attr("title",a.currentSettings.tooltip),$(o).on("click",async function(e){var n=a.clickCount;$(o).attr("disabled",!0).html(t.html+"(waiting)"),await a.processCalculatedSetting("value",!0),a.currentSettings.value&&(n=a.value);try{await a.dataTargets.target(n)}catch(e){freeboard.showDialog(e,"Error in click handler","OK"),freeboard.playSound("error")}_.isUndefined(a.currentSettings.value)||(n=a.value),a.clickCount+=1,$(o).attr("disabled",!1).html(t.html),freeboard.playSound(a.currentSettings.sound),textFit($(o),{alignHoriz:!0,alignVert:!0})}),$(o).removeClass("ui-widget-content")},a.getHeight=function(){return parseInt((a.currentSettings.height+59)/60)},a.onSettingsChanged=function(e){a.currentSettings=e,a.currentSettings.unit=a.currentSettings.unit||"",$(o).attr("tooltip",e.placeholder),$(o).css("height",a.currentSettings.height+"px")},a.onCalculatedValueChanged=function(e,t){"html"==e&&($(o).html(t),textFit($(".fullwidth-button"),{alignHoriz:!0,alignVert:!0})),"value"==e&&(a.value=t)},a.onDispose=function(){}}}(),function(){var e=0;freeboard.addStyle(".colorpicker","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".colorpicker-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-colorpicker-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-colorpicker-range","background: #F90;");freeboard.loadWidgetPlugin({type_name:"colorpicker_plugin",display_name:"Color Picker",description:"Interactive colorpicker Plugin with 2-way data binding. ",fill_size:!0,settings:[{name:"title",display_name:"Title",description:"",type:"calculated"},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When you click OK",value:"change"}]},{name:"format",display_name:"Format",type:"option",options:[{name:"Hex String",value:"hex"},{name:"RGB Object",value:"rgb"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be a value, timestamp pair.",type:"target"}],newInstance:function(e,a){a(new t(e))}});var t=function(t){var a=this;a.currentSettings=t;var n="colorpicker-"+e++,i=$('<div class="colorpicker-widget colorpicker-label" id="__'+n+'"></div>'),r=$("<label></label>",{id:n,name:n}).css({display:"block"}),o=$("<input/>",{id:n,name:n}).css("width","90%"),d="#"+n;a.value="";a.render=function(e){$(e).append(i),r.appendTo(i),o.appendTo(i),o.spectrum({type:"component",showInitial:"true"});var n=function(e){var n=[e.r,e.g,e.b,e.a];if(!_.isEqual(a.value,n)){a.value=n;var i=chroma(e.r,e.g,e.b).alpha(e.a);if("hex"==t.format&&a.dataTargets.target(i.hex()),"rgb"==t.format){var r={_type:"rgb",r:(i=i.rgba())[0],g:i[1],b:i[2],a:i[3]};a.lastDataFromTarget.assign(r),a.dataTargets.target(a.lastDataFromTarget)}}};o.on("change.spectrum",function(e,t){"change"==a.currentSettings.mode&&n(t.toRgb())}),o.on("move.spectrum",function(e,t){"input"==a.currentSettings.mode&&n(t.toRgb())}),$(d).removeClass("ui-widget-content")},a.getHeight=function(){return 1},a.onSettingsChanged=function(e){a.currentSettings=e,a.currentSettings.unit=a.currentSettings.unit||"",$(d).attr("tooltip",e.placeholder)},a.onCalculatedValueChanged=function(e,t){if("target"==e){var n=function(e){return"rgb"==e._type&&(e=chroma(e.r,e.g,e.b,e.a||1).hex()),"hsv"==e._type&&(e=chroma.hsv(e.h,e.s,e.v,e.a||1).hex()),e}(t),i=chroma(n),d=i.rgba();if(_.isEqual(a.value,d))return;a.value=d,a.lastDataFromTarget={},$(o).spectrum("set",i.css())}"title"==e&&$(r).text(t)},a.onDispose=function(){}}}(),function(){freeboard.loadDatasourcePlugin({type_name:"document_database_plugin",display_name:"In-browser DrayerDB database",description:"DB for storing JSON records.  The entire datasource may be used as a controller for the table view. Choose permanent or temp when creating. If you choose wrong, you may need to refresh the page to switch.",settings:[{name:"dbname",display_name:"Database Name",type:"text",default_value:"my_db",required:!0},{name:"perm",display_name:"Permanant",type:"boolean",default_value:!1,description:"If true, data is saved to the user's browser"},{name:"",display_name:"",html:"Download All Data",type:"button",description:"",onclick:async function(e,t){"Returns a query object for getting the";nSQL().useDatabase(t.settings.dbname);var a=nSQL("records").query("select");a=a.orderBy(["arrival ASC"]);var n=await a.exec(),i=[];for(var r of n)i.push([r]);var o=new Blob([JSON.stringify(i),""],{type:"text/plain;charset=utf-8"});window.saveAs(o,t.settings.dbname+".drayer.json")}},{name:"",display_name:"",html:"Upload Data(Merges with existing)",type:"button",description:"",onclick:function(e,t){"Returns a query object for getting the";var a=$("<div></div>"),n=$('<input id="fb-json-upload" type=file   accept=".json" name="files[]" size=30>').appendTo(a);$("<button>Upload</button/>").appendTo(a).on("click",function(){var e=n[0].files[0],a=new FileReader;a.onload=function(e){var a=JSON.parse(e.target.result);for(r of a)t.upsert(r[0],!0);a&&t.getData()},a.readAsText(e)});freeboard.showDialog(a,"Upload Data","Finish")}}],newInstance:async function(t,a,n){var i=new e(t,n);await i.makeDB(),a(i)}});var e=function(e,t){var a=this;a.settings=e;var n="TEMP";e.perm&&(n="PERM"),a.makeDB=async function(){a.db=await nSQL().createDatabase({id:a.settings.dbname,mode:n,tables:[{name:"records",model:{"id:uuid":{pk:!0},"parent:uuid":{},"time:int":{},"arrival:int":{},"type:string":{},"name:string":{},"title:string":{},"body:string":{},"description:string":{}},indexes:{"arrival:int":{},"parent:uuid":{},"time:int":{},"name:string":{search:!0},"type:string":{},"body:string":{search:!0},"title:string":{search:!0}}}],plugins:[FuzzySearch()]})};a.handler={set:function(e,t,a){throw new Error("You can't set anything here. Use getMatching({}) to get all matching records, and set() to set a record.")}},a.makeExternalEditRow=function(e){return new Proxy(e,{set:function(e,t,n){if("id"==t&&n!=e.id)throw new Error("You cannot change a record's ID");"arrival"==t?(e.arrival=1e3*Date.now(),a.upsert(e),a.data.set(e)):(e.time=1e3*Date.now(),e[t]=n)}})},a.data={loadData:async function(e){"Returns a query object for getting the";nSQL().useDatabase(a.settings.dbname);var t=nSQL("records").query("select").where(["type","!=","__null__"]);for(i in e)e[i]&&"sortField"!=i&&"sortOrder"!=i&&"pageSize"!=i&&"pageIndex"!=i&&"pageLoading"!=i&&(t="body"==i||"name"==i||"title"==i||"description"==i?t.where(["SEARCH("+i.replace("'","")+",'"+e[i].replace("'","")+"')","=",0]):t.where([i,"=",e[i]]));e.sortOrder&&(t=t.orderBy([e.sortField+" "+e.sortOrder.toUpperCase()])),t=t.limit(e.pageSize).offset((e.pageIndex-1)*e.pageSize);try{return{data:await t.exec(),itemsCount:(e.pageIndex+1)*e.pageSize}}catch(e){console.log(e)}},insertItem:async function(e){e.time=1e3*Date.now(),a.upsert(e)},deleteItem:async function(e){e.id&&(nSQL().useDatabase(a.settings.dbname),await nSQL("records").query("select").where(["id","=",e.id]).exec()&&a.upsert({type:"__null__",id:e.id}))}},a.data.updateItem=a.data.insertItem,a.proxy=new Proxy(a.data,a.handler),a.upsert=async function(e,n){try{var i={};if(Object.assign(i,e),i.time=i.time||1e3*Date.now(),i.arrival=i.arrival||i.time,i.id=i.id||freeboard.genUUID(),i.name=i.name||i.id,nSQL().useDatabase(a.settings.dbname),(r=await nSQL("records").query("delete").where(["id","=",i.id]).where(["time",">=",i.time]).exec()).length)return;await nSQL("records").query("delete").where(["id","=",i.id]).exec();var r=nSQL("records").query("upsert",[i]).exec();await r,n||t(a.proxy)}catch(e){throw console.log(e),e}},a.onSettingsChanged=function(e){e.dbname;e,a.data=freeboard.eval(e.data),t(a.proxy)},a.updateNow=function(){var e;e=a.proxy,t(e)},a.onDispose=function(){}}}(),function(){freeboard.loadDatasourcePlugin({type_name:"JSON",settings:[{name:"url",display_name:"URL",type:"text"},{name:"use_thingproxy",display_name:"Try thingproxy",description:'A direct JSON connection will be tried first, if that fails, a JSONP connection will be tried. If that fails, you can use thingproxy, which can solve many connection problems to APIs. <a href="https://github.com/Freeboard/thingproxy" target="_blank">More information</a>.',type:"boolean",default_value:!0},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5},{name:"method",display_name:"Method",type:"option",options:[{name:"GET",value:"GET"},{name:"POST",value:"POST"},{name:"PUT",value:"PUT"},{name:"DELETE",value:"DELETE"}]},{name:"body",display_name:"Body",type:"text",description:"The body of the request. Normally only used if method is POST"},{name:"headers",display_name:"Headers",type:"array",settings:[{name:"name",display_name:"Name",type:"text"},{name:"value",display_name:"Value",type:"text"}]}],newInstance:function(e,t,a){t(new function(e,t){var a=this,n=null,i=e,r=0,o=!1;function d(e){n&&clearInterval(n),n=setInterval(function(){a.updateNow()},e)}d(1e3*i.refresh),this.updateNow=function(){if(!(r>1&&!i.use_thingproxy||r>2)){var e=i.url;2==r&&i.use_thingproxy&&(e=("https:"==location.protocol?"https:":"http:")+"//thingproxy.freeboard.io/fetch/"+encodeURI(i.url));var n=i.body;if(n)try{n=JSON.parse(n)}catch(e){}$.ajax({url:e,dataType:1==r?"JSONP":"JSON",type:i.method||"GET",data:n,beforeSend:function(e){try{_.each(i.headers,function(t){var a=t.name,n=t.value;_.isUndefined(a)||_.isUndefined(n)||e.setRequestHeader(a,n)})}catch(e){}},success:function(e){o=!0,t(e)},error:function(e,t,n){o||(r++,a.updateNow())}})}},this.onDispose=function(){clearInterval(n),n=null},this.onSettingsChanged=function(e){o=!1,r=0,d(1e3*(i=e).refresh),a.updateNow()}}(e,a))}});freeboard.loadDatasourcePlugin({type_name:"openweathermap",display_name:"Open Weather Map API",settings:[{name:"api_key",display_name:"API Key",type:"text",description:"Your personal API Key from Open Weather Map"},{name:"location",display_name:"Location",type:"text",description:"Example: London, UK"},{name:"units",display_name:"Units",type:"option",default:"imperial",options:[{name:"Imperial",value:"imperial"},{name:"Metric",value:"metric"}]},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5}],newInstance:function(e,t,a){t(new function(e,t){var a=this,n=null,i=e;function r(e){n&&clearInterval(n),n=setInterval(function(){a.updateNow()},e)}r(1e3*i.refresh),this.updateNow=function(){$.ajax({url:"http://api.openweathermap.org/data/2.5/weather?APPID="+i.api_key+"&q="+encodeURIComponent(i.location)+"&units="+i.units,dataType:"JSONP",success:function(e){var a,n={place_name:e.name,sunrise:new Date(1e3*e.sys.sunrise).toLocaleTimeString(),sunset:new Date(1e3*e.sys.sunset).toLocaleTimeString(),conditions:(a=e.weather[0].description,a.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})),current_temp:e.main.temp,high_temp:e.main.temp_max,low_temp:e.main.temp_min,pressure:e.main.pressure,humidity:e.main.humidity,wind_speed:e.wind.speed,wind_direction:e.wind.deg};t(n)},error:function(e,t,a){}})},this.onDispose=function(){clearInterval(n),n=null},this.onSettingsChanged=function(e){i=e,a.updateNow(),r(1e3*i.refresh)}}(e,a))}});freeboard.loadDatasourcePlugin({type_name:"dweet_io",display_name:"Dweet.io",external_scripts:["http://dweet.io/client/dweet.io.min.js"],settings:[{name:"thing_id",display_name:"Thing Name",description:"Example: salty-dog-1",type:"text"}],newInstance:function(e,t,a){t(new function(e,t){var a=e;function n(e){t(e)}this.updateNow=function(){dweetio.get_latest_dweet_for(a.thing_id,function(e,t){e||n(t[0].content)})},this.onDispose=function(){},this.onSettingsChanged=function(e){dweetio.stop_listening_for(a.thing_id),a=e,dweetio.listen_for(a.thing_id,function(e){n(e.content)})},this.onSettingsChanged(e)}(e,a))}});freeboard.loadDatasourcePlugin({type_name:"playback",display_name:"Playback",settings:[{name:"datafile",display_name:"Data File URL",type:"text",description:"A link to a JSON array of data."},{name:"is_jsonp",display_name:"Is JSONP",type:"boolean"},{name:"loop",display_name:"Loop",type:"boolean",description:"Rewind and loop when finished"},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5}],newInstance:function(e,t,a){t(new function(e,t){var a,n=this,i=e,r=[],o=0;function d(){r.length>0?(o<r.length&&(t(r[o]),o++),o>=r.length&&i.loop&&(o=0),o<r.length&&(a=setTimeout(d,1e3*i.refresh))):t({})}function l(){r=[],o=0,a&&(clearTimeout(a),a=null)}this.updateNow=function(){l(),$.ajax({url:i.datafile,dataType:i.is_jsonp?"JSONP":"JSON",success:function(e){r=_.isArray(e)?e:[],o=0,d()},error:function(e,t,a){}})},this.onDispose=function(){l()},this.onSettingsChanged=function(e){i=e,n.updateNow()}}(e,a))}});freeboard.loadDatasourcePlugin({type_name:"clock",display_name:"Clock",settings:[{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:1},{name:"strftime",display_name:"Strftime String for custom_value",type:"text",suffix:"seconds",default_value:"%I:%M:%S %p %b %d %Y"}],newInstance:function(e,t,a){t(new function(e,t){var a,n=this,i=e;function r(){a&&(clearTimeout(a),a=null)}function o(){r(),a=setInterval(n.updateNow,1e3*i.refresh)}this.updateNow=function(){var e=new Date,a="";i.strftime&&(a=strftime(i.strftime,e));var n={numeric_value:e.getTime(),custom_value:a,full_string_value:e.toLocaleString(),date_string_value:e.toLocaleDateString(),time_string_value:e.toLocaleTimeString(),date_object:e};t(n)},this.onDispose=function(){r()},this.onSettingsChanged=function(e){i=e,o()},o()}(e,a))}}),freeboard.loadDatasourcePlugin({type_name:"meshblu",display_name:"Octoblu",description:"app.octoblu.com",external_scripts:["http://meshblu.octoblu.com/js/meshblu.js"],settings:[{name:"uuid",display_name:"UUID",type:"text",default_value:"device uuid",description:"your device UUID",required:!0},{name:"token",display_name:"Token",type:"text",default_value:"device token",description:"your device TOKEN",required:!0},{name:"server",display_name:"Server",type:"text",default_value:"meshblu.octoblu.com",description:"your server",required:!0},{name:"port",display_name:"Port",type:"number",default_value:80,description:"server port",required:!0}],newInstance:function(t,a,n){a(new e(t,n))}});var e=function(e,t){var a=e;this.onSettingsChanged=function(e){a=e},this.updateNow=function(){var e;(e=skynet.createConnection({uuid:a.uuid,token:a.token,server:a.server,port:a.port})).on("ready",function(a){e.on("message",function(e){t(e)})})},this.onDispose=function(){}}}(),function(){var e=100,t=["#FF9900","#FFFFFF","#B3B4B4","#6B6B6B","#28DE28","#13F7F9","#E6EE18","#C41204","#CA3CB8","#0B1CFB"];function a(a,n,i){var r=$(a).data().values,o=$(a).data().valueMin,d=$(a).data().valueMax;r||(r=[],o=void 0,d=void 0);var l=function(t,a){r[a]||(r[a]=[]),r[a].length>=e&&r[a].shift(),r[a].push(Number(t)),(void 0===o||t<o)&&(o=t),(void 0===d||t>d)&&(d=t)};_.isArray(n)?_.each(n,l):l(n,0),$(a).data().values=r,$(a).data().valueMin=o,$(a).data().valueMax=d;var s='<span style="color: {{color}}">&#9679;</span> {{y}}',u=!1;_.each(r,function(e,n){$(a).sparkline(e,{type:"line",composite:u,height:"100%",width:"100%",fillColor:!1,lineColor:t[n%t.length],lineWidth:2,spotRadius:3,spotColor:!1,minSpotColor:"#78AB49",maxSpotColor:"#78AB49",highlightSpotColor:"#9D3926",highlightLineColor:"#9D3926",chartRangeMin:o,chartRangeMax:d,tooltipFormat:i&&i[n]?s+" ("+i[n]+")":s}),u=!0})}var n=freeboard.getStyleString("values");freeboard.addStyle(".widget-big-text",n+"font-size:75px;"),freeboard.addStyle(".tw-display","width: 100%; height:100%; display:table; table-layout:fixed;"),freeboard.addStyle(".tw-tr","display:table-row;"),freeboard.addStyle(".tw-tg","display:table-row-group;"),freeboard.addStyle(".tw-tc","display:table-caption;"),freeboard.addStyle(".tw-td","display:table-cell;"),freeboard.addStyle(".tw-value",n+"overflow: hidden;display: inline-block;text-overflow: ellipsis;"),freeboard.addStyle(".tw-unit","display: inline-block;padding-left: 10px;padding-bottom: 1.1em;vertical-align: bottom;"),freeboard.addStyle(".tw-value-wrapper","position: relative;vertical-align: middle;height:100%;"),freeboard.addStyle(".tw-sparkline","height:20px;");var i=function(e){var t=e,n=$('<div class="tw-display"></div>'),i=$('<h2 class="section-title tw-title tw-td"></h2>'),r=$('<div class="tw-value"></div>'),o=$('<div class="tw-unit"></div>'),d=$('<div class="tw-sparkline tw-td"></div>');function l(){_.isUndefined(t.units)||""==t.units?r.css("max-width","100%"):r.css("max-width",n.innerWidth()-o.outerWidth(!0)+"px")}this.render=function(e){$(e).empty(),$(n).append($('<div class="tw-tr"></div>').append(i)).append($('<div class="tw-tr"></div>').append($('<div class="tw-value-wrapper tw-td"></div>').append(r).append(o))).append($('<div class="tw-tr"></div>').append(d)),$(e).append(n),l()},this.onSettingsChanged=function(e){t=e;var a=!_.isUndefined(e.title)&&""!=e.title,n=!_.isUndefined(e.units)&&""!=e.units;e.sparkline?d.attr("style",null):(delete d.data().values,d.empty(),d.hide()),a?(i.html(_.isUndefined(e.title)?"":e.title),i.attr("style",null)):(i.empty(),i.hide()),n?(o.html(_.isUndefined(e.units)?"":e.units),o.attr("style",null)):(o.empty(),o.hide()),"big"==e.size?valueFontSize="60px":"regular"==e.size?valueFontSize="30px":valueFontSize=e.size,r.css({"font-size":valueFontSize}),l()},this.onSizeChanged=function(){l()},this.onCalculatedValueChanged=function(e,n){"value"==e&&(t.animate?function(e,t,a){var n=$(t).text();if(n!=e)if($.isNumeric(e)&&$.isNumeric(n)){var i=e.toString().split("."),r=0;i.length>1&&(r=i[1].length);var o=0;(i=n.toString().split(".")).length>1&&(o=i[1].length),jQuery({transitionValue:Number(n),precisionValue:o}).animate({transitionValue:Number(e),precisionValue:r},{duration:a,step:function(){$(t).text(this.transitionValue.toFixed(this.precisionValue))},done:function(){$(t).text(e)}})}else $(t).text(e)}(n,r,500):r.text(n),t.sparkline&&a(d,n))},this.onDispose=function(){},this.getHeight=function(){return"big"==t.size||t.sparkline?2:1},this.onSettingsChanged(e)};freeboard.loadWidgetPlugin({type_name:"text_widget",display_name:"Text",settings:[{name:"title",display_name:"Title",type:"text"},{name:"size",display_name:"Size",type:"option",options:[{name:"Regular",value:"regular"},{name:"Big",value:"big"},{name:"Small",value:"small"},{name:"Medium",value:"Medium"},{name:"Large",value:"large"},{name:"Extra Large",value:"x-large"},{name:"32px",value:"32px"},{name:"48px",value:"48px"},{name:"64px",value:"64px"}]},{name:"value",display_name:"Value",type:"calculated"},{name:"sparkline",display_name:"Include Sparkline",type:"boolean"},{name:"animate",display_name:"Animate Value Changes",type:"boolean",default_value:!0},{name:"units",display_name:"Units",type:"text",options:function(){return{lbs:"",kgs:"",psi:"",meters:"",feet:"",mm:"",degC:"",degF:""}}},{name:"font",display_name:"Font",type:"text",options:function(){return{FBMono:"",FBSans:"",DSEG7:"",DSEG14:"",Pandora:"",FBCursive:"",FBSerif:"",DIN:"",FBComic:"",QTBlackForest:"",PenguinAttack:"",Chancery:"",Pixel:"",Handwriting:"",Chalkboard:"",RoughScript:""}}}],newInstance:function(e,t){t(new i(e))}});var r=0;freeboard.addStyle(".gauge-widget-wrapper","width: 100%;text-align: center;");freeboard.loadWidgetPlugin({type_name:"gauge",display_name:"Gauge",settings:[{name:"title",display_name:"Title",type:"text"},{name:"heading",display_name:"Heading",type:"text"},{name:"style",type:"json",display_name:"Theming",schema:{type:"object",title:"Theme",properties:{pointerColor:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerTipColor:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerCircleInner:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerCircleInnerEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerCircleOuter:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerCircleOuterEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerShadowBottom:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerShadowTop:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},fgColor:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderInner:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderInnerEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderMiddle:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderMiddleEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderOuter:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderOuterEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderInnerWidth:{type:"number",min:0,max:12},borderMiddleWidth:{type:"number",min:0,max:12},borderOuterWidth:{type:"number",min:0,max:12},size:{type:"number",min:1,max:8},borderShadow:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},plateColor:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}},default_value:"rgb(0,0,0)"},plateColorEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}},default_value:"rgb(0,0,0)"},fontTitleSize:{type:"number",min:8,max:64},fontValueSize:{type:"number",min:8,max:64}}},default_value:{pointerCircleInner:"rgb(57,43,21)",pointerCircleInnerEnd:"rgb(57,43,21)",pointerCircleOuter:"rgb(87,63,41)",pointerCircleOuterEnd:"rgb(57,43,21)",pointerShadowTop:"#000000",pointerShadowBottom:"#000000",pointerColor:"#000000",pointerTipColor:"#002000",fgColor:"rgb(57,43,21)",borderInner:"rgb(77,68,56)",borderInnerEnd:"rgb(59,44,36)",borderMiddle:"rgb(202,192,155)",borderMiddleEnd:"rgb(163,145,96)",borderOuter:"rgb(102,90,67)",borderOuterEnd:"rgb(57,41,34)",borderInnerWidth:2,borderMiddleWidth:3,borderOuterWidth:2,borderShadow:"#000000",plateColor:"rgb(204,198,190)",plateColorEnd:"rgb(195,190,180)",fontTitleSize:32,fontValueSize:40,size:4}},{name:"value",display_name:"Value",type:"calculated"},{name:"units",display_name:"Units",type:"text"},{name:"min_value",display_name:"Minimum",type:"text",default_value:0},{name:"max_value",display_name:"Maximum",type:"text",default_value:100},{name:"tick_interval",display_name:"Tick Spacing",type:"text",default_value:10},{name:"minor_ticks",display_name:"Tick divisions",type:"text",default_value:5},{name:"digits",display_name:"Show digits",type:"number",default_value:4}],newInstance:function(e,t){t(new function(e){var t,a=this,n="gauge-"+r++,i=$('<h2 class="section-title"></h2>'),o=$('<canvas width=180 height=180 id="'+n+'"></canvas>'),d=!1;function l(){if(d){o.empty(),t&&t.destroy();var i=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--title-line-height"))+10;o.attr("width",60*parseInt(e.style.size)-i).attr("height",60*parseInt(e.style.size)-i);for(var r=document.getElementById(n),l=String(a.currentSettings.max_value||100).split(".")[0].length,s={renderTo:r,width:60*Number(e.style.size)-i,height:60*Number(e.style.size)-i,units:a.currentSettings.units,title:a.currentSettings.title,value:a.value,minValue:a.currentSettings.min_value,maxValue:a.currentSettings.max_value,majorTicks:[],minorTicks:a.currentSettings.minorTicks,strokeTicks:!1,highlights:[],colorBorderOuter:a.currentSettings.style.borderOuter,colorBorderOuterEnd:a.currentSettings.style.borderOuterEnd,colorBorderMiddle:a.currentSettings.style.borderMiddle,colorBorderMiddleEnd:a.currentSettings.style.borderMiddleEnd,colorBorderInner:a.currentSettings.style.borderInner,colorBorderInnerEnd:a.currentSettings.style.borderInnerEnd,borderInnerWidth:a.currentSettings.style.borderInnerWidth,borderMiddleWidth:a.currentSettings.style.borderMiddleWidth,borderOuterWidth:a.currentSettings.style.borderOuterWidth,colorBorderShadow:a.currentSettings.style.borderShadow,colorPlate:a.currentSettings.style.plateColor,colorPlateEnd:a.currentSettings.style.plateColorEnd,colorMajorTicks:a.currentSettings.style.fgColor,colorMinorTicks:a.currentSettings.style.fgColor,colorTitle:a.currentSettings.style.fgColor,colorUnits:a.currentSettings.style.fgColor,colorNumbers:a.currentSettings.style.fgColor,colorNeedle:a.currentSettings.style.pointerColor,colorNeedleShadowUp:a.currentSettings.style.pointerShadowTop,colorNeedleShadowBottom:a.currentSettings.style.pointerShadowBottom,colorNeedleEnd:a.currentSettings.style.pointerTipColor,colorNeedleCircleOuter:a.currentSettings.style.pointerCircleOuter,colorNeedleCircleOuterEnd:a.currentSettings.style.pointerCircleOuterEnd,colorNeedleCircleInner:a.currentSettings.style.pointerCircleInner,colorNeedleCircleInnerEnd:a.currentSettings.style.pointerCircleInnerEnd,fontTitleSize:a.currentSettings.style.fontTitleSize,fontUnitsSize:a.currentSettings.style.fontTitleSize,fontValueSize:a.currentSettings.style.fontValueSize,valueBox:a.currentSettings.digits>0,valueInt:l,valueDec:Math.max(a.currentSettings.digits-l,0),animationRule:"bounce",animationDuration:500,animation:!1},u=parseInt(a.currentSettings.min_value);u<=parseInt(a.currentSettings.max_value);)s.majorTicks.push(String(u)),u+=parseInt(a.currentSettings.tick_interval);var c=new RadialGauge(s);c.draw(),t=c}}a.value=0,a.currentSettings=e,e.style=e.style||{},this.render=function(e){d=!0,$(e).append(i).append($('<div class="gauge-widget-wrapper"></div>').append(o)),l()},this.onSettingsChanged=function(e){a.currentSettings=e,l(),i.html(e.heading||"")},this.onCalculatedValueChanged=function(e,n){a.value=n,_.isUndefined(t)||(t.value=Number(n),o.attr("title",String(n)+(a.currentSettings.units||"")))},this.onDispose=function(){t&&t.destroy()},this.getHeight=function(){try{return a.currentSettings.style.size}catch(e){return console.log(e),3}},this.onSettingsChanged(e)}(e))}}),freeboard.addStyle(".sparkline","width:100%;height: 75px;");var o=function(e){var n=$('<h2 class="section-title"></h2>'),i=$('<div class="sparkline"></div>'),r=$("<div></div>"),o=e;this.render=function(e){$(e).append(n).append(i).append(r)},this.onSettingsChanged=function(e){o=e,n.html(_.isUndefined(e.title)?"":e.title),e.include_legend&&function(e,a){for(var n=$("<div class='sparkline-legend'></div>"),i=0;i<a.length;i++){var r=t[i%t.length],o=a[i];n.append("<div class='sparkline-legend-value'><span style='color:"+r+"'>&#9679;</span>"+o+"</div>")}e.empty().append(n),freeboard.addStyle(".sparkline-legend","margin:5px;"),freeboard.addStyle(".sparkline-legend-value","color:white; font:10px arial,san serif; float:left; overflow:hidden; width:50%;"),freeboard.addStyle(".sparkline-legend-value span","font-weight:bold; padding-right:5px;")}(r,e.legend.split(","))},this.onCalculatedValueChanged=function(e,t){o.legend?a(i,t,o.legend.split(",")):a(i,t)},this.onDispose=function(){},this.getHeight=function(){var e=0;if(o.include_legend&&o.legend){var t=o.legend.split(",").length;t>4?e=.5*Math.floor((t-1)/4):t&&(e=.5)}return 2+e},this.onSettingsChanged(e)};freeboard.loadWidgetPlugin({type_name:"sparkline",display_name:"Sparkline",settings:[{name:"title",display_name:"Title",type:"text"},{name:"value",display_name:"Value",type:"calculated",multi_input:"true"},{name:"include_legend",display_name:"Include Legend",type:"boolean"},{name:"legend",display_name:"Legend",type:"text",description:"Comma-separated for multiple sparklines"}],newInstance:function(e,t){t(new o(e))}}),freeboard.addStyle("div.pointer-value","position:absolute;height:95px;margin: auto;top: 0px;bottom: 0px;width: 100%;text-align:center;");freeboard.loadWidgetPlugin({type_name:"pointer",display_name:"Pointer",settings:[{name:"direction",display_name:"Direction",type:"calculated",description:"In degrees"},{name:"value_text",display_name:"Value Text",type:"calculated"},{name:"units",display_name:"Units",type:"text"}],newInstance:function(e,t){t(new function(e){var t,a,n,i,r=$('<div class="widget-big-text"></div>'),o=$("<div></div>");this.render=function(e){n=$(e).width(),i=$(e).height();var d=Math.min(n,i)/2-6,l=(t=Raphael($(e).get()[0],n,i)).circle(n/2,i/2,d);l.attr("stroke","#FF9900"),l.attr("stroke-width",3),(a=t.path(function(e){if(!e||e.length<2)return[];var t=[];t.push(["m",e[0],e[1]]);for(var a=2;a<e.length;a+=2)t.push(["l",e[a],e[a+1]]);return t.push(["z"]),t}([n/2,i/2-d+3,15,20,-30,0]))).attr("stroke-width",0),a.attr("fill","#fff"),$(e).append($('<div class="pointer-value"></div>').append(r).append(o))},this.onSettingsChanged=function(e){o.html(e.units)},this.onCalculatedValueChanged=function(e,t){"direction"==e?_.isUndefined(a)||a.animate({transform:"r"+t+","+n/2+","+i/2},250,"bounce"):"value_text"==e&&r.html(t)},this.onDispose=function(){},this.getHeight=function(){return 4},this.onSettingsChanged(e)}(e))}});freeboard.loadWidgetPlugin({type_name:"picture",display_name:"Picture",fill_size:!0,settings:[{name:"src",display_name:"Image URL",type:"calculated"},{type:"number",display_name:"Refresh every",name:"refresh",suffix:"seconds",description:"Leave blank if the image doesn't need to be refreshed"}],newInstance:function(e,t){t(new function(e){var t,a,n;function i(){a&&(clearInterval(a),a=null)}function r(){if(t&&n){var e=n;$(t).css({"background-image":"url("+e+")"})}}this.render=function(e){$(e).css({width:"100%",height:"100%","background-size":"cover","background-position":"center"}),t=e},this.onSettingsChanged=function(e){i(),e.refresh&&e.refresh>0&&(a=setInterval(r,1e3*Number(e.refresh)))},this.onCalculatedValueChanged=function(e,t){"src"==e&&(n=t),r()},this.onDispose=function(){i()},this.getHeight=function(){return 4},this.onSettingsChanged(e)}(e))}}),freeboard.addStyle(".indicator-light","border-radius:50%;width:22px;height:22px;border:2px solid #3d3d3d;margin-top:5px;float:left;background-color:#222;margin-right:10px;"),freeboard.addStyle(".indicator-light.on","background-color:#FFC773;box-shadow: 0px 0px 15px #FF9900;border-color:#FDF1DF;"),freeboard.addStyle(".indicator-text","margin-top:10px;");freeboard.loadWidgetPlugin({type_name:"indicator",display_name:"Indicator Light",settings:[{name:"title",display_name:"Title",type:"text"},{name:"value",display_name:"Value",type:"calculated"},{name:"on_text",display_name:"On Text",type:"calculated"},{name:"off_text",display_name:"Off Text",type:"calculated"}],newInstance:function(e,t){t(new function(e){var t,a,n=$('<h2 class="section-title"></h2>'),i=$('<div class="indicator-text"></div>'),r=$('<div class="indicator-light"></div>'),o=e,d=!1;function l(){r.toggleClass("on",d),d?i.text(_.isUndefined(t)?_.isUndefined(o.on_text)?"":o.on_text:t):i.text(_.isUndefined(a)?_.isUndefined(o.off_text)?"":o.off_text:a)}this.render=function(e){$(e).append(n).append(r).append(i)},this.onSettingsChanged=function(e){o=e,n.html(_.isUndefined(e.title)?"":e.title),l()},this.onCalculatedValueChanged=function(e,n){"value"==e&&(d=Boolean(n)),"on_text"==e&&(t=n),"off_text"==e&&(a=n),l()},this.onDispose=function(){},this.getHeight=function(){return 1},this.onSettingsChanged(e)}(e))}}),freeboard.addStyle(".gm-style-cc a","text-shadow:none;"),freeboard.addStyle(".html-widget","white-space:normal;width:100%;height:100%");freeboard.loadWidgetPlugin({type_name:"html",display_name:"Show computed HTML",fill_size:!0,settings:[{name:"html",display_name:"HTML",type:"calculated",description:"Can be literal HTML, or javascript that outputs HTML."},{name:"height",display_name:"Height Blocks",type:"number",default_value:4,description:"A height block is around 60 pixels"}],newInstance:function(e,t){t(new function(e){var t=$('<div class="html-widget"></div>'),a=e;this.render=function(e){$(e).append(t)},this.onSettingsChanged=function(e){a=e},this.onCalculatedValueChanged=function(e,a){"html"==e&&t.html(a)},this.onDispose=function(){},this.getHeight=function(){return Number(a.height)},this.onSettingsChanged(e)}(e))}})}(),function(){var e=0;freeboard.addStyle(".textbox","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".textbox-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-textbox-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-textbox-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"richtextbox_plugin",display_name:"Rich Text Box",description:"Interactive Textbox Plugin with 2-way data binding.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text",default_value:""},{name:"size",display_name:"Size(height blocks)",type:"number",default_value:8},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When element loses focus",value:"change"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be the text",type:"target"}],newInstance:function(e,a){a(new t(e))}});var t=function(t){var a=this;a.currentSettings=t;var n="textbox-"+e++,i=$('<div id="__'+n+'"></div>').css("position","static").css("overflow","scroll").height("100%"),r=$('<h2 class="section-title textbox-label"></h2>'),o="#"+n+"-trumbo";r.html(a.currentSettings.title),a.value="";$.trumbowyg.svgPath=!1,$.trumbowyg.hideButtonTexts=!0;var d=$('<textarea id="'+n+'-trumbo"></textarea>').appendTo(i),l=["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646","ffff00","f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd"];$("#"+n+"-trumbo").on("tbwchange",function(e){"realtime"==a.currentSettings.mode&&a.dataTargets.target($("#"+n+"-trumbo").trumbowyg("html"))}),$("#"+n+"-trumbo").on("tbwblur",function(e){a.dataTargets.target($("#"+n+"-trumbo").trumbowyg("html"))}),a.render=function(e){$(e).append(i),r.appendTo(i),d.appendTo(i),a.toDestroy&&a.toDestroy("destroy"),$("#"+n+"-trumbo").trumbowyg({btns:[["viewHTML"],["undo","redo"],["formatting"],["strong","em","del"],["superscript","subscript"],["foreColor","backColor"],["link"],["base64"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat"],["fullscreen"],["fontsize","fontfamily","preformatted"],["emoji","table","specialChars"]],semantic:!1,plugins:{colors:{displayAsList:!0,foreColorList:l,backColorList:l},fontfamily:{fontList:[{name:"Seriff",family:"FBSerif"},{name:"Sans",family:"FBSans"},{name:"Monospace",family:"FBMono"},{name:"Cursive",family:"FBCursive"},{name:"Pandora",family:"Pandora"},{name:"Chalkboard",family:"Chalkboard"},{name:"Handwriting",family:"Handwriting"},{name:"Rough Script",family:"RoughScript"},{name:"Chancery",family:"Chancery"},{name:"Comic",family:"FBComic"},{name:"Blackletter",family:"Blackletter"},{name:"Stencil",family:"Stencil"},{name:"Pixel",family:"Pixel"},{name:"B612",family:"B612"},{name:"DIN",family:"DIN"},{name:"Penguin Attack",family:"PenguinAttack"},{name:"DSEG7",family:"DSEG7"},{name:"DSEG14",family:"DSEG14"}]}}}),a.toDestroy=$("#"+n+"-trumbo").trumbowyg,$("#"+n+"-trumbo").closest(".trumbowyg-box").css("min-height",Math.max(60*parseInt(a.currentSettings.size)-80,30)),$("#"+n+"-trumbo").prev(".trumbowyg-editor").css("min-height",Math.max(60*parseInt(a.currentSettings.size)-80,30)),$("#"+n+"-trumbo").closest(".trumbowyg-box").css("height",Math.max(60*parseInt(a.currentSettings.size)-80,30)),$("#"+n+"-trumbo").prev(".trumbowyg-editor").css("height",Math.max(60*parseInt(a.currentSettings.size)-80,30)),$("#"+n+"-trumbo").on("change",function(e){a.dataTargets.target(e.target.value)}),$("#"+n+"-trumbo").on("input",function(e){a.value=e.target.value,"change"!=a.currentSettings.mode&&(_.isUndefined(a.currentSettings.target)||a.dataTargets.target(e.target.value))}),$(o).removeClass("ui-widget-content")},a.getHeight=function(){return parseInt(a.currentSettings.size)},a.onSettingsChanged=function(e){a.currentSettings=e,r.html(_.isUndefined(e.title)?"":e.title),a.currentSettings.unit=a.currentSettings.unit||"",$(o).attr("pattern",e.pattern),$(o).attr("placeholder",e.placeholder),$(o).attr("tooltip",e.placeholder),$("#"+n+"-trumbo").closest(".trumbowyg-box").css("min-height",Math.max(60*parseInt(a.currentSettings.size)-80,30)),$("#"+n+"-trumbo").prev(".trumbowyg-editor").css("min-height",Math.max(60*parseInt(a.currentSettings.size)-80,30)),$("#"+n+"-trumbo").closest(".trumbowyg-box").css("height",Math.max(60*parseInt(a.currentSettings.size)-80,30)),$("#"+n+"-trumbo").prev(".trumbowyg-editor").css("height",Math.max(60*parseInt(a.currentSettings.size)-80,30))},a.onCalculatedValueChanged=function(e,t){if("target"==e){a.value=t;var n=t;n!=$(o).val()&&$(o).val(n)}"placeholder"==e&&$(o).attr("placeholder",t)},a.onDispose=function(){a.toDestroy("destroy")}}}(),function(){freeboard.loadDatasourcePlugin({type_name:"core_scratchpad_plugin",display_name:"Scratchpad Variables",description:"The data is just an empty space.  To set some data, use datasources['scratchpad']['SomeName'] as a data target.  It will be available to read in other widgets.  You can also set the default data using JSON.",settings:[{name:"data",display_name:"Default Data(as JSON or JS expression)",type:"calculated",default_value:"={}",options:function(){return{"={key: 'value'}":""}},description:"Must be a valid JS =expression that returns an object. Whatever it returns will be the default data.",required:!0},{name:"persist",display_name:"Persistance Mode",type:"option",default_value:"off",options:[{name:"Off",value:"off"},{name:"Board",value:"board"}],description:"off: no persistance,  board: changes are passed to the Default Data field and can be exported with the board.",required:!0},{name:"lock",display_name:"Lock data(read only)",type:"boolean",default_value:!1},{name:"",display_name:"",html:"Show current data",type:"button",onclick:function(e,t){freeboard.showDialog(JSON.stringify(t.data),"Debug data for: "+e+" (non-JSON not shown)","OK")},description:""},{name:"",display_name:"",html:"Show current data in JSON editor",type:"button",description:"",onclick:function(e,t){var a=[];freeboard.showDialog($('<div id="fb-global-json-editor">'),"Debug data for: "+e+" (non-JSON not shown)","OK","Cancel",function(){Object.assign(t.proxy,a[0].getValue()),a[0].destroy()},function(){a[0].destroy()});var n=new JSONEditor(document.getElementById("fb-global-json-editor"),{schema:{}});a.push(n),n.setValue(t.data)}}],newInstance:function(t,a,n){a(new e(t,n))}});var e=function(e,t){var a=this,n=e;a.handler={set:function(e,i,r){if(n.lock)throw new Error("Cannot change this. It is locked in the datasource settings");return e[i]=r,t(a.proxy),"board"==n.persist&&(n.data="="+JSON.stringify(e),freeboard.setDatasourceSettings(n.name,e)),!0}},a.data={},a.proxy=new Proxy(a.data,a.handler),a.onSettingsChanged=function(e){n=e,t(a.proxy)},a.onCalculatedSettingChanged=function(e,n){"data"==e&&(a.data=n,a.proxy=new Proxy(a.data,a.handler),t(a.proxy))},a.updateNow=function(){var e;e=a.proxy,t(e)},a.onDispose=function(){}}}(),function(){var e=0;freeboard.addStyle(".slider","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".slider-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-slider-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-slider-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"slider_plugin",display_name:"Slider",description:"Interactive Slider Plugin with 2-way data binding.  Value is a list of 2 items, the value and the timestamp.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text"},{name:"unit",display_name:"Unit of measure",type:"text"},{name:"min",display_name:"Min",type:"calculated",default_value:"0"},{name:"max",display_name:"Max",type:"calculated",default_value:"100"},{name:"step",display_name:"Step",type:"calculated",default_value:"1"},{name:"default",display_name:"Default Value",type:"calculated",default_value:"0"},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When Released",value:"change"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be a value, timestamp pair.",type:"target"}],newInstance:function(e,a){a(new t(e))}});var t=function(t){var a=this;currentSettings=t,currentSettings.unit=currentSettings.unit||"";var n="slider-"+e++,i=$('<div class="slider-widget slider-label" id="__'+n+'"></div>'),r=$('<h2 class="section-title slider-label"></h2>'),o=$('<div id="value-'+n+'" style="display:inline-block; padding-left: 10px; font-weight:bold; color: #d3d4d4" ></div>'),d=$("<input/>",{type:"range",id:n}),l="#"+n,s="#value-"+n;_.isUndefined(currentSettings.value)||currentSettings.value;r.html(_.isUndefined(currentSettings.title)?"":currentSettings.title),a.min=_.isUndefined(currentSettings.min)?0:currentSettings.min,a.max=_.isUndefined(currentSettings.max)?100:currentSettings.max,a.step=_.isUndefined(currentSettings.step)?100:currentSettings.step,a.value=void 0;a.render=function(e){$(e).append(i),r.appendTo(i),$(r).append(o),d.appendTo(i),$(l).attr("min",a.min),$(l).attr("max",a.max),$(l).attr("step",a.step),$(l).css("width","95%"),$(l).on("input",function(e){$("#value-"+n).html(e.value)}),$(s).html((a.value||0)+currentSettings.unit),$(l).on("change",function(e){a.dataTargets.target(parseFloat(e.target.value))}),$(l).on("input",function(e){a.value=e.target.value,$(s).html(e.target.value+currentSettings.unit),"change"!=currentSettings.mode&&a.dataTargets.target(parseFloat(e.target.value))}),$(l).removeClass("ui-widget-content")},a.getHeight=function(){return"big"==currentSettings.size?2:1},a.onSettingsChanged=function(e){currentSettings=e,r.html(_.isUndefined(e.title)?"":e.title),$(r).append(o),currentSettings.unit=currentSettings.unit||"",$(s).html((a.value||0)+currentSettings.unit)},a.onCalculatedValueChanged=function(e,t){if("target"==e){a.value=t;var n=t;$(o).html(n+currentSettings.unit),n!=$(l).val()&&$(l).val(n)}if("default"==e&&_.isUndefined(a.value)){t=parseFloat(t),a.dataTargets.target(t),a.value=t;n=t;$(o).html(n+currentSettings.unit),n!=$(l).val()&&$(l).val(n)}"step"==e&&(a.step=t,$(l).attr("step",a.step)),"max"==e&&(t>a.min?(a.max=t,$(l).attr("max",t)):(currentSettings.max=a.max,freeboard.showDialog($("<div align='center'> Max value cannot be lower than Min value!</div>"),"Warning!","OK",null,function(){}))),"min"==e&&(t<a.max?(a.min=t,$(l).attr("min",t)):(currentSettings.min=a.min,freeboard.showDialog($("<div align='center'> Min value cannot be greater than Max value!</div>"),"Warning!","OK",null,function(){})))},a.onDispose=function(){}}}(),function(){var e=0;freeboard.loadWidgetPlugin({type_name:"switch_plugin",display_name:"Switch",description:"Interactive on-off switch",settings:[{name:"title",display_name:"Title",type:"text"},{name:"target",display_name:"Data Target",type:"target",description:"Bind state to this datasource"},{name:"default",display_name:"Default",type:"calculated"},{name:"on_text",display_name:"On Text",type:"text",default_value:"On"},{name:"off_text",display_name:"Off Text",type:"text",default_value:"Off"},{name:"sound",display_name:"Sound(URL or builtin)",type:"text",default_value:"",options:freeboard.getAvailableSounds}],newInstance:function(e,a){a(new t(e))}}),freeboard.addStyle(".floating-box","display: inline-block; vertical-align: top; width: 78px; background-color: #222;margin-top: 10px; margin-right: 5px;"),freeboard.addStyle(".round","border-radius: 50%;");var t=function(t){var a=this,n="onoffswitch-"+e++,i=t,r=$('<div class="floating-box"></div>'),o=$('<div class="floating-box onoffswitch-title">'+t.title+"</div>"),d=$('<div class="onoffswitch"><label class="onoffswitch-label" for="'+n+'"><div class="onoffswitch-inner"><span class="on"></span><span class="off"></span></div><div class="onoffswitch-switch round"></div></label></div>');function l(){$("#"+n).prop("checked",a.isOn),d.find("span.on").text(a.onText),d.find("span.off").text(a.offText)}d.prependTo(r),a.isOn=!1,a.rawTargetValue=void 0,this.render=function(e){$(e).append(r).append(o);$('<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="'+n+'">').prependTo(d).change(function(e){a.isOn=e.target.checked,freeboard.playSound(i.sound),a.dataTargets.target(a.isOn),a.rawTargetValue=a.isOn})},this.onSettingsChanged=function(e){i=e,o.html(_.isUndefined(e.title)?"":e.title),a.onText=e.on_text,a.offText=e.off_text,l()},this.onCalculatedValueChanged=function(e,t){if("target"==e){a.rawTargetValue=t;var n=t;(r=Boolean(n))!=a.isOn&&(a.isOn=r,freeboard.playSound(i.sound))}if("default"==e&&_.isUndefined(a.rawTargetValue)){a.rawTargetValue=t;var r;n=t;(r=Boolean(n))!=a.isOn&&(a.isOn=r),a.dataTargets.target(r)}l()},this.onDispose=function(){},this.getHeight=function(){return 1},this.onSettingsChanged(t)}}(),function(){var e=0;freeboard.addStyle(".textbox","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".textbox-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-textbox-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-textbox-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"textbox_plugin",display_name:"Text Box",description:"Interactive Textbox Plugin with 2-way data binding.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text",default_value:""},{name:"tooltip",display_name:"Tooltip hint",type:"text",default_value:""},{name:"pattern",display_name:"Validation Regex",type:"text",default_value:".*"},{name:"placeholder",display_name:"Placeholder text",type:"calculated",default_value:""},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When element loses focus",value:"change"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be the text",type:"target"},{name:"default",display_name:"Default Value",type:"calculated"}],newInstance:function(e,a){a(new t(e))}});var t=function(t){var a=this;a.currentSettings=t;var n="textbox-"+e++,i=$('<div class="textbox-widget textbox-label" id="__'+n+'"></div>'),r=$('<h2 class="section-title textbox-label"></h2>'),o=$("<input/>",{type:"text",pattern:t.pattern,id:n,name:n}).css("width","90%"),d="#"+n,l="#value-"+n;r.html(a.currentSettings.title),a.value=void 0;a.render=function(e){$(e).append(i),r.appendTo(i),o.appendTo(i),$(d).attr("placeholder",a.currentSettings.placeholder),$(d).attr("title",a.currentSettings.tooltip),$(d).attr("pattern",a.currentSettings.pattern),$(l).html((a.value||"")+a.currentSettings.unit),$(d).on("change",async function(e){_.isUndefined(a.currentSettings.target);try{await a.dataTargets.target(e.target.value)}catch(e){freeboard.showDialog(e,"Bad data target","OK"),freeboard.playSound("error")}}),$(d).on("input",function(e){a.value=e.target.value,$(l).html(e.target.value+a.currentSettings.unit),"change"!=a.currentSettings.mode&&(_.isUndefined(a.currentSettings.target)||a.dataTargets.target(e.target.value))}),$(d).removeClass("ui-widget-content")},a.getHeight=function(){return"big"==a.currentSettings.size?2:1},a.onSettingsChanged=function(e){a.currentSettings=e,r.html(_.isUndefined(e.title)?"":e.title),a.currentSettings.unit=a.currentSettings.unit||"",$(d).attr("pattern",e.pattern),$(d).attr("placeholder",e.placeholder),$(d).attr("tooltip",e.placeholder)},a.onCalculatedValueChanged=function(e,t){var n;"target"==e&&(a.value=t,(n=t)!=$(d).val()&&$(d).val(n));"default"==e&&(_.isUndefined(a.value)&&(a.value=t,(n=t)!=$(d).val()&&$(d).val(n),a.dataTargets.target(t)));"placeholder"==e&&$(d).attr("placeholder",t)},a.onDispose=function(){}}}();