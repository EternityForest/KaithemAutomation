function DialogBox(e,t,n,a,i,r){var o=$('<div id="modal_overlay" style="display:none;"></div>'),s=$('<div class="modal"></div>');function l(){o.fadeOut(200,function(){$(this).remove()})}var d=$('<h2 class="title">'+t+"</h2>"),c=$("<header></header>");c.append(d),s.append(c),$("<section></section>").appendTo(s).append(e);var u=$("<footer></footer>").appendTo(s);n&&$('<span id="dialog-ok" class="text-button">'+n+"</span>").appendTo(u).click(function(){var e=!1;_.isFunction(i)&&(e=i()),e||l()}),a&&$('<span id="dialog-cancel" class="text-button">'+a+"</span>").appendTo(u).click(function(){_.isFunction(r)&&r(),l()}),o.append(s),$("body").append(o),setTimeout(function(){textFit(d)},10),o.fadeIn(200)}function FreeboardModel(e,t,n){var a=this;this.version=0,this.isEditing=ko.observable(!1),this.allow_edit=ko.observable(!1),this.allow_edit.subscribe(function(e){e?$("#main-header").show():$("#main-header").hide()}),this.header_image=ko.observable(),this.plugins=ko.observableArray(),this.datasources=ko.observableArray(),this.panes=ko.observableArray(),this.datasourceData={};var r={set:function(e,t,n){throw new Error("You cannot directly overwrite a datasource here. Try assigning to one of the properties of the source instead")}};a.protectedDataSourceData=new Proxy(a.datasourceData,r),this.processDatasourceUpdate=function(e,t){var n=e.name();a.datasourceData[n]=t,_.each(a.panes(),function(e){_.each(e.widgets(),function(e){e.processDatasourceUpdate(n)})})},this._datasourceTypes=ko.observable(),this.datasourceTypes=ko.computed({read:function(){a._datasourceTypes();var t=[];return _.each(e,function(e){var n=e.type_name,a=n;_.isUndefined(e.display_name)||(a=e.display_name),t.push({name:n,display_name:a})}),t}}),this._widgetTypes=ko.observable(),this.widgetTypes=ko.computed({read:function(){a._widgetTypes();var e=[];return _.each(t,function(t){var n=t.type_name,a=n;_.isUndefined(t.display_name)||(a=t.display_name),e.push({name:n,display_name:a})}),e}}),this.addPluginSource=function(e){e&&-1==a.plugins.indexOf(e)&&a.plugins.push(e)},this.globalSettings={},this.globalSettingsDefaults={theme:{}},Object.assign(this.globalSettings,this.globalSettingsDefaults),this.globalSettingsHandlers={},this.serialize=function(){var e=[];_.each(a.panes(),function(t){e.push(t.serialize())});var t=[];return _.each(a.datasources(),function(e){t.push(e.serialize())}),{version:1,header_image:a.header_image(),allow_edit:a.allow_edit(),plugins:a.plugins(),panes:e,datasources:t,columns:n.getUserColumns(),globalSettings:a.globalSettings}},this.setGlobalSettings=function(e){for(var t in Object.assign(a.globalSettings,e),a.globalSettingsHandlers)a.globalSettingsHandlers[t](a.globalSettings)},this.globalSettingsHandlers.css=function(e){for(i in e.theme){var t=e.theme[i];i.includes("-image")&&t&&(t="url("+t+")"),document.body.style.setProperty(i,t)}for(i in e.imageData=e.imageData||{},e.imageData){(t=e.imageData[i])&&(t="url("+t+")"),document.body.style.setProperty(i,t)}$("#board-logo").html(getComputedStyle(document.documentElement).getPropertyValue("--logo-text")),setTimeout(function(){n.processResize(!0)},30)},this.deserialize=async function(i,r){async function o(){n.setUserColumns(i.columns),_.isUndefined(i.allow_edit)?a.allow_edit(!0):a.allow_edit(i.allow_edit),a.version=i.version||0,a.header_image(i.header_image),_.each(i.datasources,async function(t){var n=new DatasourceModel(a,e);await Promise.resolve(n.deserialize(t)),a.addDatasource(n)});var o=_.sortBy(i.panes,function(e){return n.getPositionForScreenSize(e).row});for(var s in _.each(o,function(e){var n=new PaneModel(a,t);n.deserialize(e),a.panes.push(n)}),a.allow_edit()&&0==a.panes().length&&a.setEditing(!0),_.isFunction(r)&&await Promise.resolve(r()),a.globalSettings)delete a.globalSettings[s];Object.assign(a.globalSettings,a.globalSettingsDefaults),a.setGlobalSettings(i.globalSettings||{})}a.clearDashboard(),_.each(i.plugins,function(e){a.addPluginSource(e)}),_.isArray(i.plugins)&&i.plugins.length>0?head.js(i.plugins,async function(){await o()}):await o()},this.clearDashboard=function(){n.removeAllPanes(),_.each(a.datasources(),function(e){e.dispose()}),_.each(a.panes(),function(e){e.dispose()}),a.plugins.removeAll(),a.datasources.removeAll(),a.panes.removeAll()},this.loadDashboard=function(e,t){n.showLoadingIndicator(!0),a.deserialize(e,function(){n.showLoadingIndicator(!1),_.isFunction(t)&&t(),freeboard.emit("dashboard_loaded")})},this.loadDashboardFromLocalFile=function(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var e=document.createElement("input");e.type="file",$(e).on("change",function(e){var t=e.target.files;if(t&&t.length>0){var n=t[0],i=new FileReader;i.addEventListener("load",function(e){var t=e.target,n=JSON.parse(t.result);a.loadDashboard(n),a.setEditing(!1)}),i.readAsText(n)}}),$(e).trigger("click")}else alert("Unable to load a file in this browser.")},this.downloadDashboardClicked=function(){var e=$(event.currentTarget),t=e.data("siblings-shown")||!1;t?$(event.currentTarget).siblings("label").fadeOut("slow"):$(event.currentTarget).siblings("label").fadeIn("slow"),e.data("siblings-shown",!t)},this.downloadDashboard=function(e,t){var n=$(t.currentTarget).data("pretty"),i=document.createElement("a");if(n)var r=new Blob([JSON.stringify(a.serialize(),null,"\t")],{type:"application/octet-stream"});else r=new Blob([JSON.stringify(a.serialize())],{type:"application/octet-stream"});document.body.appendChild(i),i.href=window.URL.createObjectURL(r),i.download="dashboard.json",i.target="_self",i.click()},this.addDatasource=function(e){a.datasources.push(e)},this.deleteDatasource=function(e){delete a.datasourceData[e.name()],e.dispose(),a.datasources.remove(e)},this.createPane=function(){var e=new PaneModel(a,t);a.addPane(e)},this.addGridColumnLeft=function(){n.addGridColumnLeft()},this.addGridColumnRight=function(){n.addGridColumnRight()},this.subGridColumnLeft=function(){n.subGridColumnLeft()},this.subGridColumnRight=function(){n.subGridColumnRight()},this.addPane=function(e){a.panes.push(e)},this.deletePane=function(e){e.dispose(),a.panes.remove(e)},this.deleteWidget=function(e){ko.utils.arrayForEach(a.panes(),function(t){t.widgets.remove(e)}),e.dispose()},this.setEditing=function(e,t){if(a.allow_edit()||!e){a.isEditing(e),_.isUndefined(t)&&(t=!0);var i=t?250:0,r=$("#admin-bar").outerHeight();e?($("#toggle-header-icon").addClass("icon-chevron-up").removeClass("icon-wrench"),$(".gridster .gs_w").css({cursor:"pointer"}),$("#main-header").animate({top:"0px"},i),$("#board-content").animate({top:r+20+"px"},i),$("#main-header").data().shown=!0,n.attachWidgetEditIcons($(".sub-section")),n.enableGrid()):($("#toggle-header-icon").addClass("icon-wrench").removeClass("icon-chevron-up"),$(".gridster .gs_w").css({cursor:"default"}),$("#main-header").animate({top:"-"+r+"px"},i),$("#board-content").animate({top:"20"},i),$("#main-header").data().shown=!1,$(".sub-section").unbind(),n.disableGrid()),n.showPaneEditIcons(e,t)}},this.toggleEditing=function(){var e=!a.isEditing();a.setEditing(e)}}function FreeboardUI(){var e,t=10,n=300,a=3,i=t+n+t,r=a,o=$('<div class="wrapperloading"><div class="loading up" ></div><div class="loading down"></div></div>');function s(t){var n=u(),a=function(){};t&&(a=function(t){var a=ko.dataFor(this),i=b(a);$(this).attr("data-sizex",Math.min(a.col_width(),n,e.cols)).attr("data-row",i.row).attr("data-col",i.col),a.processSizeChange()}),p(Math.min(n,r)),g(a),c();try{textFit($("#board-logo")),textFit($(".gs_w header h1")),textFit($("#datasources h2")),textFit($("#globalSettingsDialog h2")),textFit($(".jsgrid-header-cell:not(.jsgrid-control-field)"))}catch(e){console.log(e)}try{textFit($(".fullwidth-button"),{alignHoriz:!0,alignVert:!0})}catch(e){console.log(e)}}function l(t){p(e.cols+1)&&g(function(){var n,a=ko.dataFor(this),i=e.cols>1?e.cols-1:1,r=a.col[i],o=a.row[i];t?(leftPreviewCol=!0,n={row:o,col:r<e.cols?r+1:e.cols}):(rightPreviewCol=!0,n={row:o,col:r});$(this).attr("data-sizex",Math.min(a.col_width(),e.cols)).attr("data-row",n.row).attr("data-col",n.col)}),c(),r=e.cols}function d(t){p(e.cols-1)&&g(function(){var n,a=ko.dataFor(this),i=e.cols+1,r=a.col[i],o=a.row[i];t?n={row:o,col:r>1?r-1:1}:n={row:o,col:r<=e.cols?r:e.cols};$(this).attr("data-sizex",Math.min(a.col_width(),e.cols)).attr("data-row",n.row).attr("data-col",n.col)}),c(),r=e.cols}function c(){var t=$(".column-tool"),n=$("#board-content").width(),r=Math.floor(n/i);e.cols<=a?t.addClass("min"):t.removeClass("min"),e.cols>=r?t.addClass("max"):t.removeClass("max")}function u(){var e=$("#board-content").width();return Math.floor(e/i)}function p(t){(void 0===t||t<a)&&(t=a);var n=u();t>n&&(t=n);var r=i*t+t;return $(".responsive-column-width").css("max-width",r),t!==e.cols}function g(a){var i=e.$el;i.find("> li").unbind().removeData(),$(".responsive-column-width").css("width",""),e.generate_grid_and_stylesheet(),i.find("> li").each(a),e.init(),$(".responsive-column-width").css("width",e.cols*n+e.cols*t*2)}function h(t,n,a){var i=e.cols;_.isUndefined(n)||(t.row[i]=n),_.isUndefined(a)||(t.col[i]=a)}function m(e,t){_.isUndefined(t)&&(t=!0);var n=t?250:0;e?($(".pane-tools").fadeIn(n),$("#column-tools").fadeIn(n)):($(".pane-tools").fadeOut(n),$("#column-tools").fadeOut(n))}function f(e,t){t?$(e).find(".sub-section-tools").fadeIn(250):$(e).find(".sub-section-tools").fadeOut(250)}function b(t){var n=e.cols;if(_.isNumber(t.row)&&_.isNumber(t.col)){var a={};a[n]=t.row,t.row=a,(a={})[n]=t.col,t.col=a}var i=1,r=1e3;for(var o in t.col){if(o==n)return{row:t.row[o],col:t.col[o]};if(t.col[o]>n)i=n;else{var s=n-o;s<r&&(i=o,r=s)}}return i in t.col&&i in t.row?{row:t.row[i],col:t.col[i]}:{row:1,col:i}}return ko.bindingHandlers.grid={init:function(a,i,r,o,l){e=$(a).gridster({widget_margins:[t,t],widget_base_dimensions:[n,10],resize:{enabled:!1,axes:"x"}}).data("gridster"),s(!1),e.disable()}},{showLoadingIndicator:function(e){!function(e){e?o.fadeOut(0).appendTo("body").fadeIn(500):o.fadeOut(500).remove()}(e)},showPaneEditIcons:function(e,t){m(e,t)},attachWidgetEditIcons:function(e){!function(e){$(e).hover(function(){f(this,!0)},function(){f(this,!1)})}(e)},getPositionForScreenSize:function(e){return b(e)},processResize:function(e){s(e)},disableGrid:function(){e.disable()},enableGrid:function(){e.enable()},addPane:function(t,n,a){!function(t,n,a){var i=b(n),r=i.col,o=i.row,s=Number(n.width()),l=Number(n.getCalculatedHeight());e.add_widget(t,s,l,r,o),a&&m(!0),h(n,o,r),$(t).attrchange({trackValues:!0,callback:function(e){"data-row"==e.attributeName?h(n,Number(e.newValue),void 0):"data-col"==e.attributeName&&h(n,void 0,Number(e.newValue))}})}(t,n,a)},updatePane:function(t,n){!function(t,n){var a=n.getCalculatedHeight(),i=Number($(t).attr("data-sizey")),r=Number($(t).attr("data-sizex"));a==i&&n.col_width()==r||e.resize_widget($(t),n.col_width(),a,function(){e.set_dom_grid_height()})}(t,n)},removePane:function(t){e.remove_widget(t)},removeAllPanes:function(){e.remove_all_widgets()},addGridColumnLeft:function(){l(!0)},addGridColumnRight:function(){l(!1)},subGridColumnLeft:function(){d(!0)},subGridColumnRight:function(){d(!1)},getUserColumns:function(){return r},setUserColumns:function(e){!function(e){r=Math.max(a,e)}(e)}}}function PaneModel(e,t){var n=this;this.title=ko.observable(),this.width=ko.observable(1),this.row={},this.col={},this.col_width=ko.observable(1),this.title.subscribe(function(e){freeboard.ui.processResize()}),this.col_width.subscribe(function(e){n.processSizeChange()}),this.widgets=ko.observableArray(),this.addWidget=function(e){this.widgets.push(e)},this.widgetCanMoveUp=function(e){return n.widgets.indexOf(e)>=1},this.widgetCanMoveDown=function(e){return n.widgets.indexOf(e)<n.widgets().length-1},this.moveWidgetUp=function(e){if(n.widgetCanMoveUp(e)){var t=n.widgets.indexOf(e),a=n.widgets();n.widgets.splice(t-1,2,a[t],a[t-1])}},this.moveWidgetDown=function(e){if(n.widgetCanMoveDown(e)){var t=n.widgets.indexOf(e),a=n.widgets();n.widgets.splice(t,2,a[t+1],a[t])}},this.processSizeChange=function(){setTimeout(function(){_.each(n.widgets(),function(e){e.processSizeChange()})},1e3)},this.getCalculatedHeight=function(){var e=_.reduce(n.widgets(),function(e,t){return e+t.height()},0);e*=6,e+=3,e*=10;var t=getComputedStyle(document.documentElement).getPropertyValue("--pane-header-line-height");t=t.substring(0,t.length-2);var a=Math.ceil((e+parseFloat(t))/30);return Math.max(4,a)},this.serialize=function(){var e=[];return _.each(n.widgets(),function(t){e.push(t.serialize())}),{title:n.title(),width:n.width(),row:n.row,col:n.col,col_width:Number(n.col_width()),widgets:e}},this.deserialize=function(a){n.title(a.title),n.width(a.width),n.row=a.row,n.col=a.col,n.col_width(a.col_width||1),_.each(a.widgets,function(a){var i=new WidgetModel(e,t);i.deserialize(a),n.widgets.push(i)})},this.dispose=function(){_.each(n.widgets(),function(e){e.dispose()})}}function WidgetModel(e,t){var n=function(t){if(!t)return new Function("datasources","value","");var n="";t.includes("=")||t.includes("(")||(n="=value");var a=new Function("datasources","value",t+n);return function(t){return a(e.protectedDataSourceData,t)}};var a=this;this.datasourceRefreshNotifications={},this.calculatedSettingScripts={},this.dataTargets={},this.title=ko.observable(),this.fillSize=ko.observable(!1),this.type="",this.setType=async function(e,n){if(a.type!=e&&(a.type=e,_.isUndefined(a.widgetInstance)||(_.isFunction(a.widgetInstance.onDispose)&&a.widgetInstance.onDispose(),a.widgetInstance=void 0),await a.updateCalculatedSettings(),e in t&&_.isFunction(t[e].newInstance))){var i=t[e];async function r(){await i.newInstance(a.calculatedSettings,function(e){a.fillSize(!0===i.fill_size),a.widgetInstance=e,a.widgetInstance.dataTargets=a.dataTargets,a.widgetInstance.processCalculatedSetting=a.processCalculatedSetting,a.shouldRender(!0),a._heightUpdate.valueHasMutated()})}i.external_scripts?head.js(i.external_scripts.slice(0),r):r()}},this.settings={},this.calculatedSettings={},this.setSettings=async function(e){if(this.settings=e,Object.assign(this.calculatedSettings,this.settings),await a.updateCalculatedSettings(),!_.isUndefined(a.widgetInstance)&&_.isFunction(a.widgetInstance.onSettingsChanged))try{await a.widgetInstance.onSettingsChanged(this.settings)}catch(e){throw freeboard.showDialog($("<pre>").text(String(e)),"Error changing settings","OK"),e}a._heightUpdate.valueHasMutated()},this.processDatasourceUpdate=function(e){var t=a.datasourceRefreshNotifications[e];_.isArray(t)&&_.each(t,function(e){a.processCalculatedSetting(e)})},this.callValueFunction=function(t){return t.call(void 0,e.datasourceData)},this.processSizeChange=function(){!_.isUndefined(a.widgetInstance)&&_.isFunction(a.widgetInstance.onSizeChanged)&&a.widgetInstance.onSizeChanged()},this.processCalculatedSetting=async function(e,t){if(_.isFunction(a.calculatedSettingScripts[e])){var n=void 0;try{n=a.callValueFunction(a.calculatedSettingScripts[e])}catch(r){var i=a.settings[e];r instanceof ReferenceError&&/^\w+$/.test(i)&&(n=i),t&&(freeboard.showDialog(r,"Error with: "+e,"OK"),freeboard.playSound("error"))}var r=await n;a.calculatedSettings[e]=r,await async function(t){if(!_.isUndefined(a.widgetInstance)&&_.isFunction(a.widgetInstance.onCalculatedValueChanged)&&!_.isUndefined(t))try{await a.widgetInstance.onCalculatedValueChanged(e,t)}catch(e){console.log(e.toString())}}(r)}},this.updateCalculatedSettings=async function(){if(a.datasourceRefreshNotifications={},a.calculatedSettingScripts={},a.type){var e=t[a.type].settings,r=new RegExp("=\\s*datasources.([\\w_-]+)|datasources\\[['\"]([^'\"]+)","g"),o=a.settings;for(var s in e){var l=e[s];if("calculated"==l.type||"target"==l.type){var d=o[l.name];if(_.isUndefined(d))a.dataTargets[l.name]=function(e){};else{var c,u=0,p=0;if(_.isArray(d)){p=1;var g=[];for(i in d)"="==i[0]?g.push(i.substring(1)):"target"==l.type?g.push(i):g.push(JSON.stringify(i));d="["+g.join(",")+"]"}if(d)if("="==d[0]||"target"==l.type||p){"="==d[0]&&(d=d.substring(1));var h,m=d;(d.match(/;/g)||[]).length<=1&&-1==d.indexOf("return")&&(m="return "+d);try{h=new Function("datasources",m)}catch(e){console.log(" arg "+m+"\nlooks like a function but won't compile, treating as text"),u=1}}else u=1;else h=new Function("datasources","return undefined;");if(u){var f=o[l.name].replace(/"/g,'\\"').replace(/[\r\n]/g," \\\n");h=new Function("datasources",'return "'+f+'";')}if(a.calculatedSettingScripts[l.name]=h,"target"==l.type)try{a.dataTargets[l.name]=n(d)}catch(e){console.log("Bad data target: "+d),console.log(e),a.dataTargets[l.name]=function(e){}}for(await a.processCalculatedSetting(l.name,"calculated"==l.type);c=r.exec(d);){var b=c[1]||c[2],y=a.datasourceRefreshNotifications[b];_.isUndefined(y)&&(y=[],a.datasourceRefreshNotifications[b]=y),-1==_.indexOf(y,l.name)&&y.push(l.name)}}}}}},this._heightUpdate=ko.observable(),this.height=ko.computed({read:function(){return a._heightUpdate(),!_.isUndefined(a.widgetInstance)&&_.isFunction(a.widgetInstance.getHeight)?a.widgetInstance.getHeight():1}}),this.shouldRender=ko.observable(!1),this.render=async function(e){a.shouldRender(!1),!_.isUndefined(a.widgetInstance)&&_.isFunction(a.widgetInstance.render)&&(a.widgetInstance.render(e),await a.updateCalculatedSettings())},this.dispose=function(){},this.serialize=function(){return{title:a.title(),type:a.type,settings:a.settings}},this.deserialize=async function(e){a.title(e.title),await a.setSettings(e.settings),await a.setType(e.type)}}freeboardTemplates={blank:{version:1,allow_edit:!0,plugins:[],panes:[],datasources:[],columns:3,globalSettings:{theme:{}}},example:{version:1,allow_edit:!0,plugins:[],panes:[{title:"HTML Template rendering",width:1,row:{3:1},col:{3:2},col_width:2,widgets:[{type:"html-template",settings:{html:'<p><span style="font-size: 1em; white-space: pre-wrap; background-color: var(--box-bg-color); color: var(--fg-color); font-family: Stencil;">The text the user entered is</span>: <span style="font-family: Chalkboard;">{{txt}}</span></p>',data:'={txt: datasources["vars"]["txt"]}',background:"transparent",backgroundRepeat:"no-repeat",backgroundSize:"cover",height:1,toolbar:!0}},{type:"textbox_plugin",settings:{title:"Enter Some Text",tooltip:"",pattern:".*",placeholder:"",mode:"input",target:'datasources["vars"].txt'}}]},{title:"Switch and LED with SFX",width:1,row:{3:1},col:{3:1},col_width:1,widgets:[{type:"switch_plugin",settings:{title:"A switch",target:'datasources["vars"].sw',on_text:"On",off_text:"Off",sound:"low-click"}},{type:"indicator",settings:{title:"An indicator light",value:'=datasources["vars"]["sw"]'}}]},{title:"Sum",width:1,row:{3:7},col:{3:1},col_width:1,widgets:[{type:"gauge",settings:{title:"A+B",heading:"Sum",style:{pointerCircleInner:"rgb(57,43,21)",pointerCircleInnerEnd:"rgb(57,43,21)",pointerCircleOuter:"rgb(87,63,41)",pointerCircleOuterEnd:"rgb(57,43,21)",pointerShadowTop:"#000000",pointerShadowBottom:"#000000",pointerColor:"#000000",pointerTipColor:"#002000",fgColor:"rgb(57,43,21)",borderInner:"rgb(77,68,56)",borderInnerEnd:"rgb(59,44,36)",borderMiddle:"rgb(202,192,155)",borderMiddleEnd:"rgb(163,145,96)",borderOuter:"rgb(102,90,67)",borderOuterEnd:"rgb(57,41,34)",borderInnerWidth:2,borderMiddleWidth:3,borderOuterWidth:2,borderShadow:"#000000",plateColor:"rgb(204,198,190)",plateColorEnd:"rgb(195,190,180)",fontTitleSize:32,fontValueSize:40,size:4},value:'=datasources["vars"]["a"]+datasources["vars"]["b"]',min_value:0,max_value:"200",tick_interval:"25",minor_ticks:5,digits:4}},{type:"slider_plugin",settings:{title:"Input B",unit:"",min:"0",max:"100",step:"1",default:"0",mode:"input",target:'datasources["vars"]["a"]'}},{type:"slider_plugin",settings:{title:"Input A",unit:"",min:"0",max:"100",step:"1",default:"0",mode:"input",target:'datasources["vars"]["b"]'}}]},{width:1,row:{3:7},col:{3:2},col_width:1,widgets:[{type:"text_widget",settings:{title:"Count",size:"regular",value:'=datasources["vars"].btn',animate:!1}},{type:"button_plugin",settings:{html:"<i>Button</i>",tooltip:"",target:'datasources["vars"]["btn"]',sound:"",height:30}}]}],datasources:[{name:"vars",type:"core_scratchpad_plugin",settings:{data:"={}",persist:"off",lock:!1}}],columns:3,globalSettings:{theme:{},imageData:{}}}},DatasourceModel=function(e,t){var n=this;function a(){_.isUndefined(n.datasourceInstance)||(_.isFunction(n.datasourceInstance.onDispose)&&n.datasourceInstance.onDispose(),n.datasourceInstance=void 0)}this.name=ko.observable(),this.latestData=ko.observable(),this.settings={},this.setSettings=async function(e){if(n.settings=e,!_.isUndefined(n.datasourceInstance)&&_.isFunction(n.datasourceInstance.onSettingsChanged))try{await n.datasourceInstance.onSettingsChanged(e)}catch(e){throw freeboard.showDialog($("<pre>").text(String(e)),"Error changing settings","OK"),e}},this.updateCallback=function(t){e.processDatasourceUpdate(n,t),n.latestData(t);var a=new Date;n.last_updated(a.toLocaleTimeString())},this.type="",this.setType=async function(e){if(n.type!=e&&(n.type=e,a(),e in t&&_.isFunction(t[e].newInstance))){var i=t[e];async function r(){await i.newInstance(n.settings,function(e){n.datasourceInstance=e,e.updateNow()},n.updateCallback)}i.external_scripts?head.js(i.external_scripts.slice(0),r):await r()}},this.last_updated=ko.observable("never"),this.last_error=ko.observable(),this.serialize=function(){return{name:n.name(),type:n.type,settings:n.settings}},this.deserialize=async function(e){await n.setSettings(e.settings),n.name(e.name),await n.setType(e.type)},this.getDataRepresentation=function(e){return new Function("data","return "+e+";").call(void 0,n.latestData())},this.updateNow=function(){!_.isUndefined(n.datasourceInstance)&&_.isFunction(n.datasourceInstance.updateNow)&&n.datasourceInstance.updateNow()},this.dispose=function(){a()}},DeveloperConsole=function(e){return{showDeveloperConsole:function(){!function(){var t=[],n=$("<div></div>"),a=$('<div class="table-operation text-button">ADD</div>'),i=$('<table class="table table-condensed sub-table"></table>');i.append($('<thead style=""><tr><th>Plugin Script URL</th></tr></thead>'));var r=$("<tbody></tbody>");function o(e){var n=$("<tr></tr>"),a=$('<ul class="board-toolbar"></ul>'),i=$('<input class="table-row-value" style="width:100%;" type="text">'),o=$('<li><i class="icon-trash icon-white"></i></li>').click(function(e){t=_.without(t,i),n.remove()});t.push(i),e&&i.val(e),a.append(o),r.append(n.append($("<td></td>").append(i)).append($('<td class="table-row-operation">').append(a)))}i.append(r),n.append($("<p>Here you can add references to other scripts to load datasource or widget plugins.</p>")).append(i).append(a).append('<p>To learn how to build plugins for freeboard, please visit <a target="_blank" href="http://freeboard.github.io/freeboard/docs/plugin_example.html">http://freeboard.github.io/freeboard/docs/plugin_example.html</a></p>'),_.each(e.plugins(),function(e){o(e)}),a.click(function(e){o()}),new DialogBox(n,"Developer Console","OK",null,function(){_.each(e.plugins(),function(e){$('script[src^="'+e+'"]').remove()}),e.plugins.removeAll(),_.each(t,function(t){var n=t.val();n&&n.length>0&&(e.addPluginSource(n),head.js(n+"?"+Date.now()))})})}()}}},JSEditor=function(){function e(e){e}return{displayJSEditor:function(e,t){!function(e,t){var n='// Example: Convert temp from C to F and truncate to 2 decimal places.\n// return (datasources["MyDatasource"].sensor.tempInF * 1.8 + 32).toFixed(2);';e||(e=n);var a=$('<div class="code-window"></div>'),i=$('<div class="code-mirror-wrapper"></div>'),r=$('<div class="code-window-footer"></div>'),o=$('<div class="code-window-header cm-s-ambiance">This javascript will be re-evaluated any time a datasource referenced here is updated, and the value you <code><span class="cm-keyword">return</span></code> will be displayed in the widget. You can assume this javascript is wrapped in a function of the form <code><span class="cm-keyword">function</span>(<span class="cm-def">datasources</span>)</code> where datasources is a collection of javascript objects (keyed by their name) corresponding to the most current data in a datasource.</div>');a.append([o,i,r]),$("body").append(a);var s=CodeMirror(i.get(0),{value:e,mode:"javascript",theme:"ambiance",indentUnit:4,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0}),l=$('<span id="dialog-cancel" class="text-button">Close</span>').click(function(){if(t){var e=s.getValue();e===n&&(e=""),t(e),a.remove()}});r.append(l)}(e,t)},setAssetRoot:function(t){e(t)}}},PluginEditor=function(e,t){function n(e,t){var n=$('<div class="validation-error"></div>').html(t);$("#setting-value-container-"+e).append(n)}function a(n,a,i,r,o,s){var l=$("<textarea></textarea>");i.multi_input?l.change(function(){var e=[];$(n).find("textarea").each(function(){var t=$(this).val();t&&(e=e.concat(t))}),a.settings[i.name]=e}):l.change(function(){a.settings[i.name]=$(this).val()}),r&&l.val(r),t.createValueEditor(l);var d=$('<ul class="board-toolbar datasource-input-suffix"></ul>'),c=$('<div class="calculated-setting-row"></div>');if(c.append(l).append(d),s)var u=$('<li><i class="icon-plus icon-white"></i><label>DATATARGET</label></li>').mousedown(function(e){e.preventDefault(),$(l).is(":focus")?$(l).insertAtCaret('datasources["').trigger("freeboard-eval"):$(l).val("").focus().insertAtCaret('datasources["').trigger("freeboard-eval")});else u=$('<li><i class="icon-plus icon-white"></i><label>DATASOURCE</label></li>').mousedown(function(e){e.preventDefault(),0==$(l).val().length&&$(l).insertAtCaret("="),$(l).insertAtCaret('datasources["').trigger("freeboard-eval")});if(d.append(u),!s){var p=$('<li><i class="icon-fullscreen icon-white"></i><label>.JS EDITOR</label></li>').mousedown(function(t){t.preventDefault(),e.displayJSEditor(l.val(),function(e){l.val(e),l.change()})});d.append(p)}if(o){var g=$('<li class="remove-setting-row"><i class="icon-minus icon-white"></i><label></label></li>').mousedown(function(e){e.preventDefault(),c.remove(),$(n).find("textarea:first").change()});d.prepend(g)}$(n).append(c)}function i(e,t,i,r,o){var s,l={type:i,settings:{}};function d(e,t,n){var a=$('<div id="setting-row-'+e+'" class="form-row"></div>').appendTo(c);return a.append('<div class="form-label"><label class="control-label">'+t+"</label></div>"),$('<div id="setting-value-container-'+e+'" class="form-value"></div>').appendTo(a)}var c=$("<div></div>"),u=$('<div id="plugin-description"></div>').hide();c.append(u);var p=[];function g(e,t,n){_.each(e,function(e){!_.isUndefined(e.default_value)&&_.isUndefined(r[e.name])&&(r[e.name]=e.default_value);var i=e.name;_.isUndefined(e.display_name)||(i=e.display_name);var o=d(e.name,i);switch(e.type){case"array":{var s=$('<div class="form-table-value-subtable"></div>').appendTo(o),c=$('<table class="table table-condensed sub-table"></table>').appendTo(s),u=$("<thead></thead>").hide().appendTo(c),g=$("<tr></tr>").appendTo(u),h=$("<tbody></tbody>").appendTo(c),m=[];function f(){l.settings[e.name].length>0?u.show():u.hide()}function b(t){var n=$("<tr></tr>").appendTo(h),a={};_.isArray(l.settings[e.name])||(l.settings[e.name]=[]),l.settings[e.name].push(a),_.each(e.settings,function(i){var s=$("<td></td>").appendTo(n),l="";if(_.isUndefined(t[i.name])||(l=t[i.name]),a[i.name]=l,"option"==i.type){var d=$("<select></select>").appendTo($('<div class="styled-select"></div>').appendTo(s)).change(function(){a[i.name]=$(this).val()});_.each(i.options,function(e){var t,n;_.isObject(e)?(t=e.name,n=e.value):t=e,_.isUndefined(n)&&(n=t),_.isUndefined(S)&&(S=n),$("<option></option>").text(t).attr("value",n).appendTo(d)}),d.val(r[l])}else if("color"==i.type){var c=$("<div>EDIT</div>").attr("id",i.name+"-picker").appendTo(o),u=document.querySelector("#"+i.name+"-picker"),p=l||"black";c.css({color:p});var g=new Picker({parent:u,color:p});a[i.name]=l||"rgb(0,0,0)",g.onChange=function(e){a[i.name]=e.rgbastring,e.css({color:e.rgbastring})}}else $('<input class="table-row-value" type="text">').appendTo(s).val(l).attr("list",e.name+i.name+"ac").change(function(){a[i.name]=$(this).val()})}),n.append($('<td class="table-row-operation"></td>').append($('<ul class="board-toolbar"></ul>').append($("<li></li>").append($('<i class="icon-trash icon-white"></i>').click(function(){var t=l.settings[e.name].indexOf(a);-1!=t&&(l.settings[e.name].splice(t,1),n.remove(),f())}))))),s.scrollTop(s[0].scrollHeight),f()}_.each(e.settings,function(t){var n=t.name;_.isUndefined(t.display_name)||(n=t.display_name),$("<th>"+n+"</th>").appendTo(g),["text","datasource","target"].indexOf(t.type)>-1&&t.options&&($("<datalist></datalist>").attr("id",e.name+t.name+"ac").appendTo(g),$.each(t.options(),function(n,a){$("#"+e.name+t.name+"ac").append($("<option>").attr("value",n).text(a))}))}),e.name in r&&(m=r[e.name]),$('<div class="table-operation text-button">ADD</div>').appendTo(o).click(function(){var t={};_.each(e.settings,function(e){t[e.name]=""}),b(t)}),_.each(m,function(e,t){b(e)});break}case"html-wysywig":$.trumbowyg.svgPath=!1,$.trumbowyg.hideButtonTexts=!0,l.settings[e.name]=r[e.name];$("<div><label>"+e.name+'</label> <br> <textarea id="'+e.name+'-trumbo"></textarea></div>').appendTo(o);var y=["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646","ffff00","f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd"];$("#"+e.name+"-trumbo").trumbowyg({btns:[["viewHTML"],["undo","redo"],["formatting"],["strong","em","del"],["superscript","subscript"],["foreColor","backColor"],["link"],["base64"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat"],["fullscreen"],["fontsize","fontfamily","preformatted"],["emoji","table","specialChars"]],plugins:{colors:{displayAsList:!0,foreColorList:y,backColorList:y},fontfamily:{fontList:[{name:"Seriff",family:"FBSerif"},{name:"Color Emoji",family:"NotoColorEmoji"},{name:"Sans",family:"FBSans"},{name:"Monospace",family:"FBMono"},{name:"Cursive",family:"FBCursive"},{name:"Pandora",family:"Pandora"},{name:"Chalkboard",family:"Chalkboard"},{name:"Handwriting",family:"Handwriting"},{name:"Rough Script",family:"RoughScript"},{name:"Chancery",family:"Chancery"},{name:"Comic",family:"FBComic"},{name:"Blackletter",family:"Blackletter"},{name:"Stencil",family:"Stencil"},{name:"Pixel",family:"Pixel"},{name:"B612",family:"B612"},{name:"DIN",family:"DIN"},{name:"Penguin Attack",family:"PenguinAttack"},{name:"DSEG7",family:"DSEG7"},{name:"DSEG14",family:"DSEG14"}]}}}),$("#"+e.name+"-trumbo").on("tbwchange",function(t){l.settings[e.name]=$("#"+e.name+"-trumbo").trumbowyg("html")}),$("#"+e.name+"-trumbo").on("tbwblur",function(t){l.settings[e.name]=$("#"+e.name+"-trumbo").trumbowyg("html")}),e.name in r&&$("#"+e.name+"-trumbo").trumbowyg("html",r[e.name]),p.push($("#editor").trumbowyg);break;case"boolean":l.settings[e.name]=r[e.name];var v=$('<div class="onoffswitch"><label class="onoffswitch-label" for="'+e.name+'-onoff"><div class="onoffswitch-inner"><span class="on">YES</span><span class="off">NO</span></div><div class="onoffswitch-switch"></div></label></div>').appendTo(o),w=$('<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="'+e.name+'-onoff">').prependTo(v).change(function(){l.settings[e.name]=this.checked});e.name in r&&w.prop("checked",r[e.name]);break;case"json":l.settings[e.name]=r[e.name];w=$("<button>EDIT</button>").appendTo(o).on("click",function(){var t=[];freeboard.showDialog($('<div id="fb-global-json-editor">'),e,name,"OK","Cancel",function(){l.settings[e.name]=t[0].getValue(),t[0].destroy()},function(){t[0].destroy()});var n=new JSONEditor(document.getElementById("fb-global-json-editor"),{schema:e.schema});t.push(n);try{n.setValue(l.settings[e.name]||{})}catch(e){console.log(e)}});break;case"button":w=$("<button></button>").appendTo($('<div class="styled-select"></div>').appendTo(o)).html(e.html).on("click",function(){e.onclick(r,freeboard.getDatasourceInstance(r.name))});break;case"option":var S=r[e.name];w=$("<select></select>").appendTo($('<div class="styled-select"></div>').appendTo(o)).change(function(){l.settings[e.name]=$(this).val()});_.each(e.options,function(e){var t,n;_.isObject(e)?(t=e.name,n=e.value):t=e,_.isUndefined(n)&&(n=t),_.isUndefined(S)&&(S=n),$("<option></option>").text(t).attr("value",n).appendTo(w)}),l.settings[e.name]=S,e.name in r&&w.val(r[e.name]);break;default:if(l.settings[e.name]=r[e.name],"calculated"==e.type||"target"==e.type){var x="target"==e.type;if(e.name in r){var k=r[e.name];if(e.multi_input&&_.isArray(k))for(var C=!1,T=0;T<k.length;T++)a(o,l,e,k[T],C,x),C=!0;else a(o,l,e,k,!1,x)}else a(o,l,e,null,!1,x);if(e.multi_input){var D=$('<ul class="board-toolbar"><li class="add-setting-row"><i class="icon-plus icon-white"></i><label>ADD</label></li></ul>').mousedown(function(t){t.preventDefault(),a(o,l,e,null,!0,x)});$(o).siblings(".form-label").append(D)}}else{if("name"==e.name)var I="[a-zA-Z][a-zA-Z0-9_]+";else I=null;var E=e.regex;_.isUndefined(e.regex)&&(E=I),e.options&&($("<datalist></datalist>").attr("id",e.name+"ac").appendTo(o),$.each(e.options(),function(t,n){$("#"+e.name+"ac").append($("<option>").attr("value",t).text(n||t))}));w=$('<input type="text">').appendTo(o).attr("pattern",E).attr("list",e.name+"ac").change(function(){"number"==e.type?l.settings[e.name]=Number($(this).val()):l.settings[e.name]=$(this).val()});if("integer"==e.type&&w.attr("type","number"),e.name in r&&w.val(r[e.name]),t&&e.typeahead_data_field&&w.addClass("typeahead_data_field-"+e.typeahead_data_field),t&&e.typeahead_field){var F=[];w.keyup(function(e){e.which>=65&&e.which<=91&&w.trigger("change")}),$(w).autocomplete({source:F,select:function(e,t){w.val(t.item.value),w.trigger("change")}}),w.change(function(a){var i=w.val(),r=_.template(t)({input:i});$.get(r,function(t){if(n&&(t=t[n]),t=_.select(t,function(t){return t[e.typeahead_field][0]==i[0]}),F=_.map(t,function(t){return t[e.typeahead_field]}),$(w).autocomplete("option","source",F),1==t.length)for(var a in t=t[0])if(t.hasOwnProperty(a)){var r=$(_.template("input.typeahead_data_field-<%= field %>")({field:a}));r&&(r.val(t[a]),r.val()!=w.val()&&r.trigger("change"))}})})}}}_.isUndefined(e.suffix)||o.append($('<div class="input-suffix">'+e.suffix+"</div>")),_.isUndefined(e.description)||o.append($('<div class="setting-description">'+e.description+"</div>"))})}for(var h of(new DialogBox(c,e,"Save","Cancel",function(){$(".validation-error").remove();for(var e=0;e<s.settings.length;e++){var t=s.settings[e];if(t.required&&(_.isUndefined(l.settings[t.name])||""==l.settings[t.name]))return n(t.name,"This is required."),!0;if("integer"==t.type&&l.settings[t.name]%1!=0)return n(t.name,"Must be a whole number."),!0;if("number"==t.type&&(a=l.settings[t.name],isNaN(parseFloat(a))||!isFinite(a)))return n(t.name,"Must be a number."),!0}var a;_.isFunction(o)&&o(l)}),p))h("destroy");var m,f=_.keys(t);if(f.length>1){var b=d("plugin-types","Type");(m=$("<select></select>").appendTo($('<div class="styled-select"></div>').appendTo(b))).append($("<option>Select a type...</option>").attr("value","undefined")),_.each(t,function(e){m.append($("<option></option>").text(e.display_name).attr("value",e.type_name))}),m.change(function(){l.type=$(this).val(),l.settings={},$("#setting-row-instance-name").length?$("#setting-row-instance-name").nextAll().remove():$("#setting-row-plugin-types").nextAll().remove(),s=t[m.val()],_.isUndefined(s)?($("#setting-row-instance-name").hide(),$("#dialog-ok").hide()):($("#setting-row-instance-name").show(),s.description&&s.description.length>0?u.html(s.description).show():u.hide(),$("#dialog-ok").show(),g(s.settings,s.typeahead_source,s.typeahead_data_segment))})}else 1==f.length&&(s=t[f[0]],l.type=s.type_name,l.settings={},g(s.settings));m&&(_.isUndefined(i)?($("#setting-row-instance-name").hide(),$("#dialog-ok").hide()):($("#dialog-ok").show(),m.val(i).trigger("change")))}return{createPluginEditor:function(e,t,n,a,r,o){i(e,t,n,a,r)}}},ValueEditor=function(e){var t=new RegExp('.*datasources\\["([^"]*)("\\])?(.*)$'),n=null,a=0,i=[],r=null,o={ANY:"any",ARRAY:"array",OBJECT:"object",STRING:"string",NUMBER:"number",BOOLEAN:"boolean"};function s(e,t){return!(!_.isArray(e)&&!_.isObject(e))||l(e,t)}function l(e,t){switch(t){case o.ANY:return!0;case o.ARRAY:return _.isArray(e);case o.OBJECT:return _.isObject(e);case o.STRING:return _.isString(e);case o.NUMBER:return _.isNumber(e);case o.BOOLEAN:return _.isBoolean(e)}}function d(e,t){$(e).parent().find(".validation-error").remove(),l(r,t)||$(e).parent().append("<div class='validation-error'>This field expects an expression that evaluates to type "+t+".</div>")}function c(o,l){var c=$(o).val().substring(0,$(o).getCaretPosition());if(function(e,n,a,o){var l=t.exec(e),d=[];if(l)if(""==l[1]){var c="";""==e&&(c="="),_.each(n,function(e){d.push({value:c+e.name(),entity:void 0,precede_char:"",follow_char:'"]'})})}else if(""!=l[1]&&_.isUndefined(l[2])){var u=l[1];_.each(n,function(e){var t=e.name();t!=u&&0==t.indexOf(u)&&d.push({value:t,entity:void 0,precede_char:"",follow_char:'"]'})})}else{var p=_.find(n,function(e){return e.name()===l[1]});if(!_.isUndefined(p)){var g="data",h="";if(!_.isUndefined(l[2])){var m=l[3].lastIndexOf("]")+1;g+=l[3].substring(0,m),h=(h=(h=l[3].substring(m,l[3].length)).replace(/^[\[\"]*/,"")).replace(/[\"\]]*$/,"")}var f=p.getDataRepresentation(g);if(r=f,_.isArray(f)){for(var b=0;b<f.length;b++)if(0==b.toString().indexOf(h)){var y=f[b];s(y,a)&&d.push({value:b,entity:y,precede_char:"[",follow_char:"]",preview:y.toString()})}}else _.isObject(f)&&_.each(f,function(e,t){0==t.indexOf(h)&&s(e,a)&&d.push({value:t,entity:e,precede_char:'["',follow_char:'"]'})})}}i=d}(c=c.replace(String.fromCharCode(160)," "),e.datasources(),l),i.length>0){n||(n=$('<ul id="value-selector" class="value-dropdown"></ul>').insertAfter(o).width($(o).outerWidth()-2).css("left",$(o).position().left).css("top",$(o).position().top+$(o).outerHeight()-1)),n.empty(),n.scrollTop(0);var u=!0;a=0,_.each(i,function(e,t){var i=function(e,t,i,o){var s=i.value;i.preview&&(s=s+"<span class='preview'>"+i.preview+"</span>");return $("<li>"+s+"</li>").appendTo(n).mouseenter(function(){$(this).trigger("freeboard-select")}).mousedown(function(e){$(this).trigger("freeboard-insertValue"),e.preventDefault()}).data("freeboard-optionIndex",o).data("freeboard-optionValue",i.value).bind("freeboard-insertValue",function(){var t=i.value;t=i.precede_char+t+i.follow_char,$(e).insertAtCaret(t),r=i.entity,$(e).triggerHandler("mouseup")}).bind("freeboard-select",function(){$(this).parent().find("li.selected").removeClass("selected"),$(this).addClass("selected"),a=$(this).data("freeboard-optionIndex")})}(o,0,e,t);u&&($(i).addClass("selected"),u=!1)})}else d(o,l),$(o).next("ul#value-selector").remove(),n=null,a=-1}function u(e,t){$(e).addClass("calculated-value-input").bind("keyup mouseup freeboard-eval",function(a){!n||"keyup"!=a.type||38!=a.keyCode&&40!=a.keyCode&&13!=a.keyCode?c(e,t):a.preventDefault()}).focus(function(){$(e).css({"z-index":3001}),function(e){var t=($(e).val().match(/\n/g)||[]).length,n=Math.min(200,20*(t+1));$(e).css({height:n+"px"})}(e)}).focusout(function(){d(e,t),$(e).css({height:"","z-index":3e3}),$(e).next("ul#value-selector").remove(),n=null,a=-1}).bind("keydown",function(e){if(n)if(38==e.keyCode||40==e.keyCode){e.preventDefault();var t=$(n).find("li");38==e.keyCode?a--:40==e.keyCode&&a++,a<0?a=t.size()-1:a>=t.size()&&(a=0);var i=$(t).eq(a);i.trigger("freeboard-select"),$(n).scrollTop($(i).position().top)}else 13==e.keyCode&&(e.preventDefault(),-1!=a&&$(n).find("li").eq(a).trigger("freeboard-insertValue"))})}return{createValueEditor:function(e,t){u(e,t||o.ANY)},EXPECTED_TYPE:o}},function(e){var t=window.MutationObserver||window.WebKitMutationObserver;e.fn.attrchange=function(n){var a={trackValues:!1,callback:e.noop};if("function"==typeof n?a.callback=n:e.extend(a,n),a.trackValues&&e(this).each(function(t,n){for(var a,i={},r=(t=0,n.attributes),o=r.length;t<o;t++)i[(a=r.item(t)).nodeName]=a.value;e(this).data("attr-old-value",i)}),t){var i={subtree:!1,attributes:!0,attributeOldValue:a.trackValues},r=new t(function(t){t.forEach(function(t){var n=t.target;a.trackValues&&(t.newValue=e(n).attr(t.attributeName)),a.callback.call(n,t)})});return this.each(function(){r.observe(this,i)})}return function(){var e=document.createElement("p"),t=!1;if(e.addEventListener)e.addEventListener("DOMAttrModified",function(){t=!0},!1);else{if(!e.attachEvent)return!1;e.attachEvent("onDOMAttrModified",function(){t=!0})}return e.setAttribute("id","target"),t}()?this.on("DOMAttrModified",function(e){e.originalEvent&&(e=e.originalEvent),e.attributeName=e.attrName,e.oldValue=e.prevValue,a.callback.call(this,e)}):"onpropertychange"in document.body?this.on("propertychange",function(t){t.attributeName=window.event.propertyName,function(t,n){if(t){var a=this.data("attr-old-value");if(n.attributeName.indexOf("style")>=0){a.style||(a.style={});var i=n.attributeName.split(".");n.attributeName=i[0],n.oldValue=a.style[i[1]],n.newValue=i[1]+":"+this.prop("style")[e.camelCase(i[1])],a.style[i[1]]=n.newValue}else n.oldValue=a[n.attributeName],n.newValue=this.attr(n.attributeName),a[n.attributeName]=n.newValue;this.data("attr-old-value",a)}}.call(e(this),a.trackValues,t),a.callback.call(this,t)}):this}}(jQuery),function(e){e.eventEmitter={_JQInit:function(){this._JQ=e(this)},emit:function(e,t){!this._JQ&&this._JQInit(),this._JQ.trigger(e,t)},once:function(e,t){!this._JQ&&this._JQInit(),this._JQ.one(e,t)},on:function(e,t){!this._JQ&&this._JQInit(),this._JQ.bind(e,t)},off:function(e,t){!this._JQ&&this._JQInit(),this._JQ.unbind(e,t)}}}(jQuery);var freeboard=function(){var e={},t={},n=new FreeboardUI,a=new FreeboardModel(e,t,n),r=new JSEditor,o=new ValueEditor(a),s=new PluginEditor(r,o),l=new DeveloperConsole(a),d={values:{"font-family":'"HelveticaNeue-UltraLight", "Helvetica Neue Ultra Light", "Helvetica Neue", sans-serif',color:"#d3d4d4","font-weight":100}};function c(){var e=$("<select></select>");for(i in freeboard.templates)e.append($("<option>"+i+"</option>"));freeboard.showDialog(e,"Load example board(deleting the current board?)","Load","Cancel",function(){freeboard.loadDashboard(freeboard.templates[e.val()])})}return ko.bindingHandlers.pluginEditor={init:function(i,r,o,l,d){var c=ko.unwrap(r()),u={},p=void 0,g="";"datasource"==c.type?(u=e,g="Datasource"):"widget"==c.type?(u=t,g="Widget"):"pane"==c.type&&(g="Pane"),$(i).click(function(r){if("delete"==c.operation){new DialogBox($("<p>Are you sure you want to delete this "+g+"?</p>"),"Confirm Delete","Yes","No",function(){"datasource"==c.type?a.deleteDatasource(l):"widget"==c.type?a.deleteWidget(l):"pane"==c.type&&a.deletePane(l)})}else{var o=void 0;"datasource"==c.type?"add"==c.operation?p={}:(o=l.type,(p=l.settings).name=l.name()):"widget"==c.type?"add"==c.operation?p={}:(o=l.type,p=l.settings):"pane"==c.type&&(p={},"edit"==c.operation&&(p.title=l.title(),p.col_width=l.col_width()),u={settings:{settings:[{name:"title",display_name:"Title",type:"text"},{name:"col_width",display_name:"Columns",type:"integer",default_value:1,required:!0}]}}),s.createPluginEditor(g,u,o,p,async function(r){if("add"==c.operation){if("datasource"==c.type){var o=new DatasourceModel(a,e);a.addDatasource(o),o.name(r.settings.name),delete r.settings.name,await o.setSettings(r.settings),await o.setType(r.type)}else if("widget"==c.type){o=new WidgetModel(a,t);await o.setSettings(r.settings),await o.setType(r.type),l.widgets.push(o),n.attachWidgetEditIcons(i)}}else"edit"==c.operation&&("pane"==c.type?(l.title(r.settings.title),l.col_width(r.settings.col_width),n.processResize(!1)):("datasource"==c.type&&(l.name(r.settings.name),delete r.settings.name),await l.setType(r.type),await l.setSettings(r.settings)))})}})}},ko.virtualElements.allowedBindings.datasourceTypeSettings=!0,ko.bindingHandlers.datasourceTypeSettings={update:function(e,t,n,a,i){processPluginSettings(e,t,n,a,i)}},ko.bindingHandlers.pane={init:function(e,t,i,r,o){a.isEditing()&&$(e).css({cursor:"pointer"}),n.addPane(e,r,o.$root.isEditing())},update:function(e,t,i,r,o){-1==a.panes.indexOf(r)&&n.removePane(e),n.updatePane(e,r)}},ko.bindingHandlers.widget={init:function(e,t,i,r,o){a.isEditing()&&n.attachWidgetEditIcons($(e).parent())},update:function(e,t,n,a,i){a.shouldRender()&&($(e).empty(),a.render(e))}},$(function(){var e;function t(){n.processResize(!0)}n.showLoadingIndicator(!0),$(window).resize(function(){clearTimeout(e),e=setTimeout(t,500)})}),{model:a,setGlobalSettings:setGlobalSettings=a.setGlobalSettings,globalSettingsHandlers:globalSettingsHandlers=a.globalSettingsHandlers,globalSettings:globalSettings=a.globalSettings,showTemplatesPage:c=c,templates:templates=freeboardTemplates,ui:ui=n,defaultSounds:defaultSounds={"low-click":"sounds/333429__brandondelehoy__ui-series-another-basic-click.opus","scifi-beep":"sounds/220176__gameaudio__confirm-click-spacey.opus",error:"sounds/423166__plasterbrain__minimalist-sci-fi-ui-error.opus","soft-chime":"sounds/419493__plasterbrain__bell-chime-alert.opus",drop:"sounds/DM-CGS-32.opus",bamboo:"sounds/DM-CGS-50.opus",snap:"333431__brandondelehoy__ui-series-miscellaneous-01.opus",click:"333427__brandondelehoy__ui-series-gravel-y-click.opus",typewriter:"380137__yottasounds__typewriter-single-key-type-2.opus","scifi-descending":"422515__nightflame__menu-fx-03-descending.opus","scifi-ascending":"422515__nightflame__menu-fx-03-ascending.opus","scifi-flat":"422515__nightflame__menu-fx-03-normal.opus"},getAvailableCSSImageVars:getAvailableCSSImageVars=function(){var e={},t=a.globalSettings;if(t.imageData)for(var n in t.imageData)e["var("+n+")"]="Uploaded Image";if(t.theme){for(n in t.theme){var i=t.theme[n];n.includes("-image")&&i&&(e["var("+n+")"]="Image from settings")}document.body.style.setProperty(n,i)}return e},getAvailableSounds:getAvailableSounds=function(){var e={},t=a.globalSettings;for(var n in freeboard.defaultSounds)e[n]="Builtin";if(t.soundData)for(var n in t.soundData)e[n]="Custom";return e},genUUID:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))},playSound:function(e,t){if(e){t=t||.8;var n=a.globalSettings;n.externalSounds?n.externalSounds[e]&&(e=n.externalSounds[e]):n.soundData?n.soundData[e]&&(e=n.soundData[e]):freeboard.defaultSounds[e]&&(e=freeboard.defaultSounds[e]),new Howl({src:[e],html5:"file:"==window.location.protocol,volume:t}).play()}},getDatasourceInstance:function(e){for(var t of freeboard.model.datasources())if(t.name()==e)return t.datasourceInstance},eval:function(e){return"string"==typeof e&&"="==e[0]?this.compile("return "+e.substring(1))():e},compile:function(e){var t=new Function("datasources","ds",e);return function(){return t(a.datasources,a.datasources)}},initialize:function(e,t){ko.applyBindings(a);var i=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null==t?"":decodeURIComponent(t[1].replace(/\+/g," "))}("load");""!=i?$.ajax({url:i,success:function(e){a.loadDashboard(e),_.isFunction(t)&&t()}}):(a.allow_edit(e),a.setEditing(e),n.showLoadingIndicator(!1),_.isFunction(t)&&t(),freeboard.emit("initialized"),n.processResize())},newDashboard:function(){a.loadDashboard({allow_edit:!0})},loadDashboard:function(e,t){a.loadDashboard(e,t)},serialize:function(){return a.serialize()},setEditing:function(e,t){a.setEditing(e,t)},isEditing:function(){return a.isEditing()},loadDatasourcePlugin:function(t){_.isUndefined(t.display_name)&&(t.display_name=t.type_name),t.settings.unshift({name:"name",display_name:"Name",type:"text",required:!0}),a.addPluginSource(t.source),e[t.type_name]=t,a._datasourceTypes.valueHasMutated()},resize:function(){n.processResize(!0)},loadWidgetPlugin:function(e){_.isUndefined(e.display_name)&&(e.display_name=e.type_name),a.addPluginSource(e.source),t[e.type_name]=e,a._widgetTypes.valueHasMutated()},setAssetRoot:function(e){r.setAssetRoot(e)},addStyle:function(e,t){var n=e+"{"+t+"}",a=$("style#fb-styles");0==a.length&&(a=$('<style id="fb-styles" type="text/css"></style>'),$("head").append(a)),a[0].styleSheet?a[0].styleSheet.cssText+=n:a.text(a.text()+n)},showLoadingIndicator:function(e){n.showLoadingIndicator(e)},showDialog:function(e,t,n,a,i,r){new DialogBox(e,t,n,a,i,r)},getDatasourceSettings:function(e){var t=a.datasources(),n=_.find(t,function(t){return t.name()===e});return n?n.settings:null},setDatasourceSettings:function(e,t){var n=a.datasources(),i=_.find(n,function(t){return t.name()===e});if(i){var r=_.defaults(t,i.settings);i.setSettings(r)}else console.log("Datasource not found")},getStyleString:function(e){var t="";return _.each(d[e],function(e,n){t=t+n+":"+e+";"}),t},getStyleObject:function(e){return d[e]},showDeveloperConsole:function(){l.showDeveloperConsole()}}}();$.extend(freeboard,jQuery.eventEmitter);var fontlist=["FBSans","FBSerif","Chalkboard","Chancery","Pandora","RoughScript","Handwriting","B612","FBMono","Blackletter","FBComic","Pixel","QTBlackForest","Pixel","FBCursive","DIN","PenguinAttack","DSEG7","DSEG14"],freeboardFontsList=fontlist;function generateFreeboardHelp(){return $('\n<div style="overflow:scroll; height:50em;">\n\n<h2>Data targets</h2>\n\n<p>Input widgets use a data target to do something with the data.\nIf the target is just the name of a field of a datasource, it will try to write it there.</p>\n\n<p>If the target contains any javascript, like assignments or function calls,\nit will be interpreted as a function to call to handle new data.\nYou can access the value itself simply by using the variable called \'value\'.</p>\n\n<p>Nonexistant targets just create that target when the user enters some data, otherwise they have an empty or default value.   This means you don\'t always need ot worry\nabout declaring values.</p>\n\n<h2>Calculated values</h2>\n\n<p>These update in real time if the value of the expression changes.\nMuch like a spreadsheet, they must begin with an equals sign,\nor else they get interpreted as just literal data.</p>\n\n\n<h2> Data Tables </h2>\n<p>FreeBoard works with table-like data using the nanoSQl2 library which is always available to the user.   The following 4 special fields are reserved and may be added\n    to rows when used with widgets: time, the microseconds modification time of the record, arrival, the microseconds time the record arrived on the local node,\n    uuid, a canonical UUID for the record, and name, a nonunique name.<p>\n\n\n<p>When using the table widget in the raw data mode, all you need to worry about is your application data, the special fields are added automatically by the table widget.</p>\n\n<p>Table widgets have a data target for their selected row.  This row acts just like a the data rows in your input array, however, you can write\nthe changes back to the original data table by setting the arrival property to anything you want(The actual value will be changed to the current time).</p>\n\n<p>Where there is no selection, the selection is just an empty object, with all of the special underscore keys, and a random UUID.  Setting arrival on this will\ncreate a new entry, as this triggers entering the row into whatever is managing the database.</p>\n\n<p>All database backends should understand this spec, so to make a database form, you use a table to find the record you want, assign the selection\nto a scratchpad data source, and use the usual controls to edit that selection.  When you\'re done, use a button widget to set the arrival property, and everything gets saved.</p>\n\n<p>The tableview widget itself will act as the backend if you use the raw data array mode.</p>\n\n\n<h2>Using Global Settings</h2>\n\n<p>There are many "hidden" settings. If you click "Object properties", you will see a list of ones to enable.  Most in the theme category are fairly obvious</p>\n\n<p>In addition, the settings panel is used to store images and sounds directly in the board config data.</p>\n\n<h3>Images</h3>\n<p>Images are stored as CSS data URLs. to upload one, to the main "properties" and enable imageData.</p>\n\n<p>Each image within the imageData section is it\'s own "Setting" you can enable, using the "add" toolbar in the propperties</p>\n\n<p>Image names must start with --, as in --my-awesome-background.  Once you have added the image, there will be a prompt to upload a file.</p>\n\n<p>The image will now be available in the Rich Text widget backgrounds list. Other uses coming soon!</p>\n\n<p>Internally, they are made available as global CSS data URIs.</p>\n\n<p>Note that images can also be uploaded directly to the Rich Text Content widget</p>\n\n<h3>Sounds</h3>\n\n<p>Sounds work the same way. Enable the soundData category, add a setting, upload.  The sound will be available in the Button and Switch widgets as a sound effect.</p>\n\n<p>This feature makes it very easy to create a basic "sound board"</p>\n\n\n\n\n\n<h2>Mustache Templates(Use in the rich text edit component,  3rdparty doc, MIT)</h2>\n<pre>\nNAME\nmustache - Logic-less templates.\n\nSYNOPSIS\nA typical Mustache template:\n\nHello {{name}}\nYou have just won {{value}} dollars!\n{{#in_ca}}\nWell, {{taxed_value}} dollars, after taxes.\n{{/in_ca}}\nGiven the following hash:\n\n{\n  "name": "Chris",\n  "value": 10000,\n  "taxed_value": 10000 - (10000 * 0.4),\n  "in_ca": true\n}\nWill produce the following:\n\nHello Chris\nYou have just won 10000 dollars!\nWell, 6000.0 dollars, after taxes.\nDESCRIPTION\nMustache can be used for HTML, config files, source code - anything. It works by expanding tags in a template using values provided in a hash or object.\n\nWe call it "logic-less" because there are no if statements, else clauses, or for loops. Instead there are only tags. Some tags are replaced with a value, some nothing, and others a series of values. This document explains the different types of Mustache tags.\n\nTAG TYPES\nTags are indicated by the double mustaches. {{person}} is a tag, as is {{#person}}. In both examples, we\'d refer to person as the key or tag key. Let\'s talk about the different types of tags.\n\nVariables\nThe most basic tag type is the variable. A {{name}} tag in a basic template will try to find the name key in the current context. If there is no name key, the parent contexts will be checked recursively. If the top context is reached and the name key is still not found, nothing will be rendered.\n\nAll variables are HTML escaped by default. If you want to return unescaped HTML, use the triple mustache: {{{name}}}.\n\nYou can also use & to unescape a variable: {{& name}}. This may be useful when changing delimiters (see "Set Delimiter" below).\n\nBy default a variable "miss" returns an empty string. This can usually be configured in your Mustache library. The Ruby version of Mustache supports raising an exception in this situation, for instance.\n\nTemplate:\n\n* {{name}}\n* {{age}}\n* {{company}}\n* {{{company}}}\nHash:\n\n{\n  "name": "Chris",\n  "company": "<b>GitHub</b>"\n}\nOutput:\n\n* Chris\n*\n* &lt;b&gt;GitHub&lt;/b&gt;\n* <b>GitHub</b>\nSections\nSections render blocks of text one or more times, depending on the value of the key in the current context.\n\nA section begins with a pound and ends with a slash. That is, {{#person}} begins a "person" section while {{/person}} ends it.\n\nThe behavior of the section is determined by the value of the key.\n\nFalse Values or Empty Lists\n\nIf the person key exists and has a value of false or an empty list, the HTML between the pound and slash will not be displayed.\n\nTemplate:\n\nShown.\n{{#person}}\n  Never shown!\n{{/person}}\nHash:\n\n{\n  "person": false\n}\nOutput:\n\nShown.\nNon-Empty Lists\n\nIf the person key exists and has a non-false value, the HTML between the pound and slash will be rendered and displayed one or more times.\n\nWhen the value is a non-empty list, the text in the block will be displayed once for each item in the list. The context of the block will be set to the current item for each iteration. In this way we can loop over collections.\n\nTemplate:\n\n{{#repo}}\n  <b>{{name}}</b>\n{{/repo}}\nHash:\n\n{\n  "repo": [\n    { "name": "resque" },\n    { "name": "hub" },\n    { "name": "rip" }\n  ]\n}\nOutput:\n\n<b>resque</b>\n<b>hub</b>\n<b>rip</b>\nLambdas\n\nWhen the value is a callable object, such as a function or lambda, the object will be invoked and passed the block of text. The text passed is the literal block, unrendered. {{tags}} will not have been expanded - the lambda should do that on its own. In this way you can implement filters or caching.\n\nTemplate:\n\n{{#wrapped}}\n  {{name}} is awesome.\n{{/wrapped}}\nHash:\n\n{\n  "name": "Willy",\n  "wrapped": function() {\n    return function(text, render) {\n      return "<b>" + render(text) + "</b>"\n    }\n  }\n}\nOutput:\n\n<b>Willy is awesome.</b>\nNon-False Values\n\nWhen the value is non-false but not a list, it will be used as the context for a single rendering of the block.\n\nTemplate:\n\n{{#person?}}\n  Hi {{name}}!\n{{/person?}}\nHash:\n\n{\n  "person?": { "name": "Jon" }\n}\nOutput:\n\nHi Jon!\nInverted Sections\nAn inverted section begins with a caret (hat) and ends with a slash. That is {{^person}} begins a "person" inverted section while {{/person}} ends it.\n\nWhile sections can be used to render text one or more times based on the value of the key, inverted sections may render text once based on the inverse value of the key. That is, they will be rendered if the key doesn\'t exist, is false, or is an empty list.\n\nTemplate:\n\n{{#repo}}\n  <b>{{name}}</b>\n{{/repo}}\n{{^repo}}\n  No repos :(\n{{/repo}}\nHash:\n\n{\n  "repo": []\n}\nOutput:\n\nNo repos :(\nComments\nComments begin with a bang and are ignored. The following template:\n\n<h1>Today{{! ignore me }}.</h1>\nWill render as follows:\n\n<h1>Today.</h1>\nComments may contain newlines.\n\nPartials\nPartials begin with a greater than sign, like {{> box}}.\n\nPartials are rendered at runtime (as opposed to compile time), so recursive partials are possible. Just avoid infinite loops.\n\nThey also inherit the calling context. Whereas in an [ERB](http://en.wikipedia.org/wiki/ERuby) file you may have this:\n\n<%= partial :next_more, :start => start, :size => size %>\nMustache requires only this:\n\n{{> next_more}}\nWhy? Because the next_more.mustache file will inherit the size and start methods from the calling context.\n\nIn this way you may want to think of partials as includes, imports, template expansion, nested templates, or subtemplates, even though those aren\'t literally the case here.\n\nFor example, this template and partial:\n\nbase.mustache:\n<h2>Names</h2>\n{{#names}}\n  {{> user}}\n{{/names}}\n\nuser.mustache:\n<strong>{{name}}</strong>\nCan be thought of as a single, expanded template:\n\n<h2>Names</h2>\n{{#names}}\n  <strong>{{name}}</strong>\n{{/names}}\nSet Delimiter\nSet Delimiter tags start with an equal sign and change the tag delimiters from {{ and }} to custom strings.\n\nConsider the following contrived example:\n\n* {{default_tags}}\n{{=<% %>=}}\n* <% erb_style_tags %>\n<%={{ }}=%>\n* {{ default_tags_again }}\nHere we have a list with three items. The first item uses the default tag style, the second uses erb style as defined by the Set Delimiter tag, and the third returns to the default style after yet another Set Delimiter declaration.\n\nAccording to ctemplates, this "is useful for languages like TeX, where double-braces may occur in the text and are awkward to use for markup."\n\nCustom delimiters may not contain whitespace or the equals sign.\n\nCOPYRIGHT\nMustache is Copyright (C) 2009 Chris Wanstrath\n\nOriginal CTemplate by Google\n\nSEE ALSO\nmustache(1), http://mustache.github.io/\n</pre>\n\n')}function generateFreeboardEmojiCheats(){return $("<h2>Smileys</h2>\n  <p></p>\n  <p></p>\n  <p></p>\n  <p></p>\n  <p><br></p>\n  <h2>People</h2>\n  <p></p>\n  <h2>Cats</h2>\n  <p></p>\n  <h2>Creatures</h2>\n  <p></p>\n  <h2>Effects</h2>\n  <p></p>\n  <h2>Body</h2>\n  <p></p>\n  <h2>Figures</h2>\n  <p></p>\n  <p></p>\n  <h2>Fashion</h2>\n  <p></p>\n  <h2>Love</h2>\n  <p></p>\n  <h2>SocialMedia</h2>\n  <p></p>\n  <h2>Animals</h2>\n  <p>\n  </p>\n  <p></p>\n  <h2>Earth and Space</h2>\n  <p></p>\n  <p><br></p>\n  <h2>Parties</h2>\n  <p></p>\n  <p><br></p>\n  <h2>Items</h2>\n  <p></p>\n  <p></p>\n  <p></p>\n  <p></p>\n  <p></p>\n  <p><br></p>\n  <h2>Arts</h2>\n  <p></p>\n  <p><br></p>\n  <h2>Games</h2>\n  <p></p>\n  <p><br></p>\n  <h2>Food and Drink</h2>\n  <p></p>\n  <p></p>\n  <p><br></p>\n  <h2>Symbols</h2>\n  <p>1234567890#</p>\n  <p></p>\n  <p></p>\n  <p></p>\n  <p></p>\n  <p></p>\n  <p></p>\n  <p></p>\n  <p><br></p>\n  <h2>Astrology</h2>\n  <p></p>\n  <p><br></p>\n  <h2>More Symbols</h2>\n  <p></p>\n  <p><br></p>\n  <p></p>\n  <p><br></p>\n  \n  \n<h2>Pictographs</h2>\n                             <br>\n                             <br>\n                            <br>\n                               <br>\n                              <br>\n                  <br>\n\n\n\n<h2>Currency Symbols</h2>\n$                                      \n\n\n<h2>Stars and Circles</h2>\n                         <br>\n                         <br>\n                           <br>\n\n<h2>Nature</h2>\n                          <br>\n                             <br>\n                             <br>\n                           <br>\n                             <br> \n                          <br>\n                       <br>\n\n  </pre>\n  ")}globalSettingsSchema={type:"object",title:"Settings",properties:{soundData:{type:"object",title:"Sounds(saved as part of board)",additionalProperties:{type:"string",media:{binaryEncoding:"base64"}}},imageData:{type:"object",title:"Images(name must start with --)",additionalProperties:{type:"string",media:{binaryEncoding:"base64"}}},theme:{type:"object",title:"Theme",properties:{"--box-bg-color":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},"--main-bg-color":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},"--main-bg-image":{type:"string",media:{binaryEncoding:"base64",type:"img/png"}},"--widget-bg-image":{type:"string",media:{binaryEncoding:"base64",type:"img/png"}},"--box-bg-image":{type:"string",media:{binaryEncoding:"base64",type:"img/png"}},"--bar-bg-image":{type:"string",media:{binaryEncoding:"base64",type:"img/png"}},"--logo-image":{type:"string",media:{binaryEncoding:"base64",type:"img/png"}},"--logo-text":{type:"string"},"--box-backdrop":{type:"string",enum:["","blur(1px)","blur(2px)","blur(4px)","blur(8px)","blur(16px)"]},"--main-font":{type:"string",enum:fontlist},"--header-font":{type:"string",enum:fontlist},"--widget-font":{type:"string",enum:fontlist},"--main-font-size":{type:"string",enum:["small","medium","large","x-large","xx-large","12px","16px","24px","32px","48px","64px","80px"]},"--header-font-size":{type:"string",enum:["small","medium","large","x-large","xx-large","12px","16px","24px","32px","48px","64px","80px"]},"--widget-font-size":{type:"string",enum:["small","medium","large","x-large","xx-large","12px","16px","24px","32px","48px","64px","80px"]},"--fg-color":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},"--widget-bg-color":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},"--widget-fg-color":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},"--bar-bg-color":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},"--pane-header-bg-color":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},"--header-fg-color":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},"--label-bg-color":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},"--label-fg-color":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},"--header-shadow":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},"--pane-shadow":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},"--widget-shadow":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},"--widget-text-shadow":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},"--border-color":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},"--widget-border-color":{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},"--border-width":{type:"string",enum:["0px","1px","2px","3px","4px","5px"]},"--header-border-radius":{type:"string",enum:["0em","0.3em","0.6em","1em","2em","3em","4em","5em"]},"--logo-border-radius":{type:"string",enum:["0em","0.3em","0.6em","1em","2em","3em","4em","5em"]},"--header-line-width":{type:"string",enum:["0px","1px","2px","3px"]},"--pane-padding":{type:"string",enum:["0.1em","0.2em"," 0.3em","0.6em","1.2em","2.4em"]},"--pane-border-radius":{type:"string",enum:["0.1em","0.2em","0.3em","0.6em","1.2em","2.4em"]},"--widget-border-radius":{type:"string",enum:["0em","0.15em","0.3em","0.6em","1.2em","2.4em","4.8em"]},"--main-bg-size":{type:"string",enum:["auto","cover","contain"]},"--pane-header-line-height":{type:"string",enum:["20px","40px","60px","80px","100px"]}}}}};var Button=function(e){jsGrid.Field.call(this,e)};function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}Button.prototype=new jsGrid.Field({align:"center",sorter:function(e,t){return 0},itemTemplate:function(e,t){return $("<input>").on("click",function(){this.fn(t)}).title(this.title)},insertTemplate:function(e,t){return""},editTemplate:function(e,t){return $("<input>").on("click",function(){this.fn(t)}).title(this.title)},insertValue:function(){return""},editValue:function(){return""}}),jsGrid.fields.button=Button,function(){var e=0;freeboard.addStyle(".datagrid","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".datagrid-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-datagrid-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-datagrid-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"jsGrid",display_name:"jsGrid Data grid View Plugin",description:"Database grid view. Data is an array of objects.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text",default_value:""},{name:"backend",display_name:"Data backend. Can be any array, or a freeboard DB controller datasource.",type:"target",default_value:"=[]"},{name:"selection",display_name:"Selection",description:"Selection gets assigned here. If no selection, empty obj.  Set obj.arrival to save changes back to array(The data doesn't matter, it reads as the time when it was set.)",type:"target",default_value:""},{name:"columns",type:"json",display_name:"Columns",schema:{type:"array",items:{type:"object",additionalProperties:!1,properties:{title:{type:"string",required:!0},name:{type:"string",title:"Data column",required:!0},type:{type:"string",title:"Type",required:!0,enum:["control","text","number","checkbox","textarea"]},width:{type:"number",title:"Width(px)",required:!0,default:40}}}},default_value:[{type:"text",title:"Name",name:"name",width:50},{type:"control",title:"",name:"",width:40}]}],newInstance:function(e,n){n(new t(e))}});var t=function(t){if(t.backend&&t.data)throw new Error("Cannot use both the backend and the data options at the same time");var n=this;n.currentSettings=t,n.data=[];var a="datagrid-"+e++,r=$('<div class="datagrid-widget datagrid-label" id="__'+a+'"></div>'),o=$('<h2 class="section-title datagrid-label"></h2>'),s=$("<div>",{id:a}).css("width","90%").css("height","400px"),l="#"+a,d="#value-"+a;n.backend=0,n.makeExternalEditRow=function(e){return new Proxy(e,{set:function(e,t,a){"arrival"==t?(e.arrival=1e3*Date.now(),e.time=1e3*Date.now(),n.upsert(e),$(l).jsGrid("refresh")):(e.time=1e3*Date.now(),e[t]=a)}})};var c=function(e){e.id=e.id||uuidv4(),e.name=e.name||e.id,e.time=e.time||parseInt(1e3*Date.now()),e.arrival=e.arrival||e.time};n.upsert=function(e){if(e){if(n.backend)return n.backend.insertItem(e);for(i of(void 0!=n.data&&""!=n.data||(n.data=[]),c(e),n.data))if(i.id==e.id){if(_.isEqual(i,e))return;if(i.time>=e.time)return;return Object.assign(i,e),void n.dataTargets.backend(n.data)}n.data.push(e),n.dataTargets.backend(n.data)}},n.arrayController={deleteItem:function(e){for(i of(_.isEqual(i.selection,e)&&n.setSelection({}),n.data))i.id==e.id&&(n.data=_.without(n.data,i));n.dataTargets.backend(n.data)},updateItem:n.upsert,insertItem:n.upsert,loadData:function(e){var t=nSQL(n.data||[]).query("select");for(i in e)!e[i]||["sortField","sortOrder","pageIndex","pageSize"].indexOf(i)>-1||(t=t.where(["LOWER("+i+")","=",String(e[i]).toLowerCase()]));e.sortOrder&&(t=t.orderBy([e.sortField+" "+e.sortOrder.toUpperCase()])),t=t.limit(e.pageSize).offset((e.pageIndex-1)*e.pageSize);return async function(){return{data:await t.exec(),itemsCount:n.data.length}}()}},n.setSelection=function(e){n.dataTargets.selection(n.makeExternalEditRow(e))},n.acceptData=function(e){for(f in 0==e&&(e=n.data),n.data=e,n.data)c(f)},n.refreshGrid=function(e){for(f in 0==e&&(e=n.data),n.data=e,n.data)c(f);$(l).jsGrid("destroy");var t=function(){n.dataTargets.backend(n.data)},a=[];for(i of n.currentSettings.columns||[]){var r={};Object.assign(r,i),a.push(r)}var o={width:"95%",height:"250px",inserting:!0,editing:!0,sorting:!0,paging:!0,pageLoading:!0,filtering:!0,rowClick:function(e){n.setSelection(e.item)},controller:n.backend||n.arrayController,fields:a};0==n.backend&&(o.onItemDeleted=t,o.onItemUpdated=t,o.onItemInserted=t),$(l).jsGrid(o),$(l).jsGrid("loadData");try{textFit($(".jsgrid-header-cell:not(.jsgrid-control-field)"))}catch(e){console.log(e)}},$(l).jsGrid("refresh"),o.html(n.currentSettings.title),n.value=n.currentSettings.value||0;n.render=function(e){$(e).append(r),o.appendTo(r),s.appendTo(r),n.refreshGrid(0),$(d).html(n.value+n.currentSettings.unit),$(l).removeClass("ui-widget-content")},n.getHeight=function(){return 6},n.onSettingsChanged=function(e){if(e.backend&&e.data)throw new Error("Cannot use both the backend and the data options at the same time");n.currentSettings=e,o.html(_.isUndefined(e.title)?"":e.title),n.currentSettings.unit=n.currentSettings.unit||"",n.refreshGrid(0),n.setSelection({})},n.onCalculatedValueChanged=function(e,t){"columns"==e&&n.refreshGrid(0),"backend"==e&&("function"==typeof t.loadData?n.backend?(n.backend=t,$(l).jsGrid("loadData")):(n.backend=t,n.refreshGrid(0)):n.backend?(n.backend=0,n.acceptData(t||[]),n.refreshGrid(0)):(n.acceptData(t||[]),$(l).jsGrid("loadData")))},n.onDispose=function(){$(l).jsGrid("destroy")}}}();var htmlWidget=function(e){var t=this;t.id=freeboard.genUUID(),t.fs=0;var n=$('<div style="overflow:auto;height:100%;width:auto;padding:0px;display:flex;flex-direction:column;"></div>'),a=$('<div class="freeboard-hover-unhide" style="border-radius:4px; overflow:hidden;background-color:var(--widget-bg-color);width:100%;padding:3px;margin:0px;position:absolute;user-select: none;opacity:0;"></div>'),i=$("<button></button>").on("click",function(){t.fs?(t.fs=0,document.body.style.setProperty("--box-backdrop",t.backup),n.css({height:"100%",width:"100%",position:"static","z-index":"auto","background-color":"transparent"}),n.css({"background-image":s.background||""}),n.css({"background-repeat":s.backgroundRepeat||""}),n.css({"background-size":s.backgroundSize||""})):(t.fs=1,t.backup=getComputedStyle(document.body).getPropertyValue("--box-backdrop"),document.body.style.setProperty("--box-backdrop","initial"),n.css({height:"100vh",width:"100vw",position:"fixed","z-index":"100",top:"0px",left:"0px","background-color":getComputedStyle(document.body).getPropertyValue("--box-bg-color")}),n.css({"background-image":s.background||""}),n.css({"background-repeat":s.backgroundRepeat||""}),n.css({"background-size":s.backgroundSize||""}))}),r=$("<button></button>").on("click",function(){printJS(t.id,"html")});a.append(r),a.append(i);var o=$('<div class="html-widget" style="width:100%; height:auto; margin:0px;padding:0px;flex-grow:100;"></div>').attr("id",t.id),s=e;t.data={},this.updateData=function(){t.data&&"object"==typeof t.data?o.html(Mustache.render(s.html||"",t.data)):o.html(s.html||"")},this.render=function(e){$(e).append(n),n.append(a),a.append(),n.append(o),t.updateData()},this.onSettingsChanged=function(e){s=e,t.updateData(),e.toolbar?a.css({display:"block"}):a.css({display:"none"}),n.css({background:e.background||""}),n.css({"background-repeat":e.backgroundRepeat||""}),n.css({"background-size":e.backgroundSize||""})},this.onCalculatedValueChanged=function(e,n){"html"==e&&t.updateData(),"data"==e&&(t.data=n,t.updateData())},this.onDispose=function(){},this.getHeight=function(){return Number(s.height)},this.onSettingsChanged(e)};function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}freeboard.loadWidgetPlugin({type_name:"html-template",display_name:"Rich Text Content",fill_size:!0,settings:[{name:"html",display_name:"HTML",type:"html-wysywig",description:"HTML template.  You can paste images here, they are stored in the freeboard config itself as base64."},{name:"data",display_name:"Variables to use",type:"calculated",default_value:"={varName: 'value'}",description:"Variables to use in Mustache templating, as a JS object.  Access a var with {{varname}} in your document template, it gets replaced with the value."},{name:"background",display_name:"Background",type:"text",default_value:"transparent",description:"CSS Background(try 'blue' or 'url(--my-image) cover')",options:freeboard.getAvailableCSSImageVars},{name:"backgroundRepeat",display_name:"Background Repeat",type:"option",options:[{name:"no-repeat",value:"no-repeat"},{name:"Tile/Repeat",value:"repeat"}]},{name:"backgroundSize",display_name:"Background Image Size",type:"option",options:[{name:"Cover",value:"cover"},{name:"Contain",value:"contain"},{name:"auto/actual size",value:"auto"}]},{name:"background",display_name:"Background",type:"text",default_value:"transparent",description:"CSS Background(try 'blue' or 'url(--my-image) cover')",options:freeboard.getAvailableCSSImageVars},{name:"height",display_name:"Height Blocks",type:"number",default_value:4,description:"A height block is around 60 pixels"},{name:"toolbar",display_name:"Show toolbar",type:"boolean",default_value:!1,description:"Fullscreen and print options"}],newInstance:function(e,t){t(new htmlWidget(e))}}),function(){var e=0;freeboard.addStyle(".button","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".button-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-button-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-button-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"button_plugin",display_name:"Button",description:"DataTarget compatible button that can run JS code when clicked",fill_size:!0,settings:[{name:"html",display_name:"Button Contents",type:"calculated",default_value:"<i>Button</i>"},{name:"tooltip",display_name:"Tooltip hint",type:"text",default_value:""},{name:"value",display_name:"Value",description:"This value gets pushed to the target when clicked.  If empty, a simple counter is used.  It recalculated every click.",type:"calculated"},{name:"target",display_name:"Data target when clicked",description:'"value" pushed defaults to a click counter',type:"target"},{name:"sound",display_name:"Sound(URL or builtin)",type:"text",default_value:"",options:freeboard.getAvailableSounds},{name:"height",display_name:"Height(px)",type:"number",default_value:30}],newInstance:function(e,n){n(new t(e))}});var t=function(t){var n=this;n.currentSettings=t;var a="button-"+e++,i=$('<div class="button-widget button-label" id="__'+a+'"></div>'),r=$("<button/>",{class:"fullwidth-button",type:"text",pattern:t.pattern,id:a}).html(t.html).css("width","95%").css("height",n.currentSettings.height+"px"),o="#"+a;n.clickCount=0,n.value="",n.render=function(e){$(e).append(i),r.appendTo(i),$(o).attr("title",n.currentSettings.tooltip),$(o).on("click",async function(e){var a=n.clickCount;$(o).attr("disabled",!0).html(t.html+"(waiting)"),await n.processCalculatedSetting("value",!0),n.currentSettings.value&&(a=n.value);try{await n.dataTargets.target(a)}catch(e){freeboard.showDialog(e,"Error in click handler","OK"),freeboard.playSound("error")}_.isUndefined(n.currentSettings.value)||(a=n.value),n.clickCount+=1,$(o).attr("disabled",!1).html(t.html),freeboard.playSound(n.currentSettings.sound),textFit($(o),{alignHoriz:!0,alignVert:!0})}),$(o).removeClass("ui-widget-content")},n.getHeight=function(){return parseInt((n.currentSettings.height+59)/60)},n.onSettingsChanged=function(e){n.currentSettings=e,n.currentSettings.unit=n.currentSettings.unit||"",$(o).attr("tooltip",e.placeholder),$(o).css("height",n.currentSettings.height+"px")},n.onCalculatedValueChanged=function(e,t){"html"==e&&($(o).html(t),textFit($(".fullwidth-button"),{alignHoriz:!0,alignVert:!0})),"value"==e&&(n.value=t)},n.onDispose=function(){}}}(),function(){var e=0;freeboard.addStyle(".colorpicker","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".colorpicker-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-colorpicker-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-colorpicker-range","background: #F90;");freeboard.loadWidgetPlugin({type_name:"colorpicker_plugin",display_name:"Color Picker",description:"Interactive colorpicker Plugin with 2-way data binding. ",fill_size:!0,settings:[{name:"title",display_name:"Title",description:"",type:"calculated"},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When you click OK",value:"change"}]},{name:"format",display_name:"Format",type:"option",options:[{name:"Hex String",value:"hex"},{name:"RGB Object",value:"rgb"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be a value, timestamp pair.",type:"target"}],newInstance:function(e,n){n(new t(e))}});var t=function(t){var n=this;n.currentSettings=t;var a="colorpicker-"+e++,i=$('<div class="colorpicker-widget colorpicker-label" id="__'+a+'"></div>'),r=$("<label></label>",{id:a,name:a}).css({display:"block"}),o=$("<input/>",{id:a,name:a}).css("width","90%"),s="#"+a;n.value="";n.render=function(e){$(e).append(i),r.appendTo(i),o.appendTo(i),o.spectrum({type:"component",showInitial:"true"});var a=function(e){var a=[e.r,e.g,e.b,e.a];if(!_.isEqual(n.value,a)){n.value=a;var i=chroma(e.r,e.g,e.b).alpha(e.a);if("hex"==t.format&&n.dataTargets.target(i.hex()),"rgb"==t.format){var r={_type:"rgb",r:(i=i.rgba())[0],g:i[1],b:i[2],a:i[3]};n.lastDataFromTarget.assign(r),n.dataTargets.target(n.lastDataFromTarget)}}};o.on("change.spectrum",function(e,t){"change"==n.currentSettings.mode&&a(t.toRgb())}),o.on("move.spectrum",function(e,t){"input"==n.currentSettings.mode&&a(t.toRgb())}),$(s).removeClass("ui-widget-content")},n.getHeight=function(){return 1},n.onSettingsChanged=function(e){n.currentSettings=e,n.currentSettings.unit=n.currentSettings.unit||"",$(s).attr("tooltip",e.placeholder)},n.onCalculatedValueChanged=function(e,t){if("target"==e){var a=function(e){return"rgb"==e._type&&(e=chroma(e.r,e.g,e.b,e.a||1).hex()),"hsv"==e._type&&(e=chroma.hsv(e.h,e.s,e.v,e.a||1).hex()),e}(t),i=chroma(a),s=i.rgba();if(_.isEqual(n.value,s))return;n.value=s,n.lastDataFromTarget={},$(o).spectrum("set",i.css())}"title"==e&&$(r).text(t)},n.onDispose=function(){}}}(),function(){freeboard.loadDatasourcePlugin({type_name:"document_database_plugin",display_name:"In-browser DrayerDB database",description:"DB for storing JSON records.  The entire datasource may be used as a controller for the table view. Choose permanent or temp when creating. If you choose wrong, you may need to refresh the page to switch.",settings:[{name:"dbname",display_name:"Database Name",type:"text",default_value:"my_db",required:!0},{name:"perm",display_name:"Permanant",type:"boolean",default_value:!1,description:"If true, data is saved to the user's browser"},{name:"",display_name:"",html:"Download All Data",type:"button",description:"",onclick:async function(e,t){"Returns a query object for getting the";nSQL().useDatabase(t.settings.dbname);var n=nSQL("records").query("select");n=n.orderBy(["arrival ASC"]);var a=await n.exec(),i=[];for(var r of a)i.push([r]);var o=new Blob([JSON.stringify(i),""],{type:"text/plain;charset=utf-8"});window.saveAs(o,t.settings.dbname+".drayer.json")}},{name:"",display_name:"",html:"Upload Data(Merges with existing)",type:"button",description:"",onclick:function(e,t){"Returns a query object for getting the";var n=$("<div></div>"),a=$('<input id="fb-json-upload" type=file   accept=".json" name="files[]" size=30>').appendTo(n);$("<button>Upload</button/>").appendTo(n).on("click",function(){var e=a[0].files[0],n=new FileReader;n.onload=function(e){var n=JSON.parse(e.target.result);for(r of n)t.upsert(r[0],!0);n&&t.getData()},n.readAsText(e)});freeboard.showDialog(n,"Upload Data","Finish")}}],newInstance:async function(t,n,a){var i=new e(t,a);await i.makeDB(),n(i)}});var e=function(e,t){var n=this;n.settings=e;var a="TEMP";e.perm&&(a="PERM"),n.makeDB=async function(){n.db=await nSQL().createDatabase({id:n.settings.dbname,mode:a,tables:[{name:"records",model:{"id:uuid":{pk:!0},"parent:uuid":{},"time:int":{},"arrival:int":{},"type:string":{},"name:string":{},"title:string":{},"body:string":{},"description:string":{}},indexes:{"arrival:int":{},"parent:uuid":{},"time:int":{},"name:string":{search:!0},"type:string":{},"body:string":{search:!0},"title:string":{search:!0}}}],plugins:[FuzzySearch()]})};n.handler={set:function(e,t,n){throw new Error("You can't set anything here. Use getMatching({}) to get all matching records, and set() to set a record.")}},n.makeExternalEditRow=function(e){return new Proxy(e,{set:function(e,t,a){if("id"==t&&a!=e.id)throw new Error("You cannot change a record's ID");"arrival"==t?(e.arrival=1e3*Date.now(),n.upsert(e),n.data.set(e)):(e.time=1e3*Date.now(),e[t]=a)}})},n.data={loadData:async function(e){"Returns a query object for getting the";nSQL().useDatabase(n.settings.dbname);var t=nSQL("records").query("select").where(["type","!=","__null__"]);for(i in e)e[i]&&"sortField"!=i&&"sortOrder"!=i&&"pageSize"!=i&&"pageIndex"!=i&&"pageLoading"!=i&&(t="body"==i||"name"==i||"title"==i||"description"==i?t.where(["SEARCH("+i.replace("'","")+",'"+e[i].replace("'","")+"')","=",0]):t.where([i,"=",e[i]]));e.sortOrder&&(t=t.orderBy([e.sortField+" "+e.sortOrder.toUpperCase()])),t=t.limit(e.pageSize).offset((e.pageIndex-1)*e.pageSize);try{return{data:await t.exec(),itemsCount:(e.pageIndex+1)*e.pageSize}}catch(e){console.log(e)}},insertItem:async function(e){e.time=1e3*Date.now(),n.upsert(e)},deleteItem:async function(e){e.id&&(nSQL().useDatabase(n.settings.dbname),await nSQL("records").query("select").where(["id","=",e.id]).exec()&&n.upsert({type:"__null__",id:e.id}))}},n.data.updateItem=n.data.insertItem,n.proxy=new Proxy(n.data,n.handler),n.upsert=async function(e,a){try{var i={};if(Object.assign(i,e),i.time=i.time||1e3*Date.now(),i.arrival=i.arrival||i.time,i.id=i.id||freeboard.genUUID(),i.name=i.name||i.id,nSQL().useDatabase(n.settings.dbname),(r=await nSQL("records").query("delete").where(["id","=",i.id]).where(["time",">=",i.time]).exec()).length)return;await nSQL("records").query("delete").where(["id","=",i.id]).exec();var r=nSQL("records").query("upsert",[i]).exec();await r,a||t(n.proxy)}catch(e){throw console.log(e),e}},n.onSettingsChanged=function(e){e.dbname;e,n.data=freeboard.eval(e.data),t(n.proxy)},n.updateNow=function(){var e;e=n.proxy,t(e)},n.onDispose=function(){}}}(),function(){freeboard.loadDatasourcePlugin({type_name:"JSON",settings:[{name:"url",display_name:"URL",type:"text"},{name:"use_thingproxy",display_name:"Try thingproxy",description:'A direct JSON connection will be tried first, if that fails, a JSONP connection will be tried. If that fails, you can use thingproxy, which can solve many connection problems to APIs. <a href="https://github.com/Freeboard/thingproxy" target="_blank">More information</a>.',type:"boolean",default_value:!0},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5},{name:"method",display_name:"Method",type:"option",options:[{name:"GET",value:"GET"},{name:"POST",value:"POST"},{name:"PUT",value:"PUT"},{name:"DELETE",value:"DELETE"}]},{name:"body",display_name:"Body",type:"text",description:"The body of the request. Normally only used if method is POST"},{name:"headers",display_name:"Headers",type:"array",settings:[{name:"name",display_name:"Name",type:"text"},{name:"value",display_name:"Value",type:"text"}]}],newInstance:function(e,t,n){t(new function(e,t){var n=this,a=null,i=e,r=0,o=!1;function s(e){a&&clearInterval(a),a=setInterval(function(){n.updateNow()},e)}s(1e3*i.refresh),this.updateNow=function(){if(!(r>1&&!i.use_thingproxy||r>2)){var e=i.url;2==r&&i.use_thingproxy&&(e=("https:"==location.protocol?"https:":"http:")+"//thingproxy.freeboard.io/fetch/"+encodeURI(i.url));var a=i.body;if(a)try{a=JSON.parse(a)}catch(e){}$.ajax({url:e,dataType:1==r?"JSONP":"JSON",type:i.method||"GET",data:a,beforeSend:function(e){try{_.each(i.headers,function(t){var n=t.name,a=t.value;_.isUndefined(n)||_.isUndefined(a)||e.setRequestHeader(n,a)})}catch(e){}},success:function(e){o=!0,t(e)},error:function(e,t,a){o||(r++,n.updateNow())}})}},this.onDispose=function(){clearInterval(a),a=null},this.onSettingsChanged=function(e){o=!1,r=0,s(1e3*(i=e).refresh),n.updateNow()}}(e,n))}});freeboard.loadDatasourcePlugin({type_name:"openweathermap",display_name:"Open Weather Map API",settings:[{name:"api_key",display_name:"API Key",type:"text",description:"Your personal API Key from Open Weather Map"},{name:"location",display_name:"Location",type:"text",description:"Example: London, UK"},{name:"units",display_name:"Units",type:"option",default:"imperial",options:[{name:"Imperial",value:"imperial"},{name:"Metric",value:"metric"}]},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5}],newInstance:function(e,t,n){t(new function(e,t){var n=this,a=null,i=e;function r(e){a&&clearInterval(a),a=setInterval(function(){n.updateNow()},e)}r(1e3*i.refresh),this.updateNow=function(){$.ajax({url:"http://api.openweathermap.org/data/2.5/weather?APPID="+i.api_key+"&q="+encodeURIComponent(i.location)+"&units="+i.units,dataType:"JSONP",success:function(e){var n,a={place_name:e.name,sunrise:new Date(1e3*e.sys.sunrise).toLocaleTimeString(),sunset:new Date(1e3*e.sys.sunset).toLocaleTimeString(),conditions:(n=e.weather[0].description,n.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})),current_temp:e.main.temp,high_temp:e.main.temp_max,low_temp:e.main.temp_min,pressure:e.main.pressure,humidity:e.main.humidity,wind_speed:e.wind.speed,wind_direction:e.wind.deg};t(a)},error:function(e,t,n){}})},this.onDispose=function(){clearInterval(a),a=null},this.onSettingsChanged=function(e){i=e,n.updateNow(),r(1e3*i.refresh)}}(e,n))}});freeboard.loadDatasourcePlugin({type_name:"dweet_io",display_name:"Dweet.io",external_scripts:["http://dweet.io/client/dweet.io.min.js"],settings:[{name:"thing_id",display_name:"Thing Name",description:"Example: salty-dog-1",type:"text"}],newInstance:function(e,t,n){t(new function(e,t){var n=e;function a(e){t(e)}this.updateNow=function(){dweetio.get_latest_dweet_for(n.thing_id,function(e,t){e||a(t[0].content)})},this.onDispose=function(){},this.onSettingsChanged=function(e){dweetio.stop_listening_for(n.thing_id),n=e,dweetio.listen_for(n.thing_id,function(e){a(e.content)})},this.onSettingsChanged(e)}(e,n))}});freeboard.loadDatasourcePlugin({type_name:"playback",display_name:"Playback",settings:[{name:"datafile",display_name:"Data File URL",type:"text",description:"A link to a JSON array of data."},{name:"is_jsonp",display_name:"Is JSONP",type:"boolean"},{name:"loop",display_name:"Loop",type:"boolean",description:"Rewind and loop when finished"},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5}],newInstance:function(e,t,n){t(new function(e,t){var n,a=this,i=e,r=[],o=0;function s(){r.length>0?(o<r.length&&(t(r[o]),o++),o>=r.length&&i.loop&&(o=0),o<r.length&&(n=setTimeout(s,1e3*i.refresh))):t({})}function l(){r=[],o=0,n&&(clearTimeout(n),n=null)}this.updateNow=function(){l(),$.ajax({url:i.datafile,dataType:i.is_jsonp?"JSONP":"JSON",success:function(e){r=_.isArray(e)?e:[],o=0,s()},error:function(e,t,n){}})},this.onDispose=function(){l()},this.onSettingsChanged=function(e){i=e,a.updateNow()}}(e,n))}});freeboard.loadDatasourcePlugin({type_name:"clock",display_name:"Clock",settings:[{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:1},{name:"strftime",display_name:"Strftime String for custom_value",type:"text",suffix:"seconds",default_value:"%I:%M:%S %p %b %d %Y"}],newInstance:function(e,t,n){t(new function(e,t){var n,a=this,i=e;function r(){n&&(clearTimeout(n),n=null)}function o(){r(),n=setInterval(a.updateNow,1e3*i.refresh)}this.updateNow=function(){var e=new Date,n="";i.strftime&&(n=strftime(i.strftime,e));var a={numeric_value:e.getTime(),custom_value:n,full_string_value:e.toLocaleString(),date_string_value:e.toLocaleDateString(),time_string_value:e.toLocaleTimeString(),date_object:e};t(a)},this.onDispose=function(){r()},this.onSettingsChanged=function(e){i=e,o()},o()}(e,n))}}),freeboard.loadDatasourcePlugin({type_name:"meshblu",display_name:"Octoblu",description:"app.octoblu.com",external_scripts:["http://meshblu.octoblu.com/js/meshblu.js"],settings:[{name:"uuid",display_name:"UUID",type:"text",default_value:"device uuid",description:"your device UUID",required:!0},{name:"token",display_name:"Token",type:"text",default_value:"device token",description:"your device TOKEN",required:!0},{name:"server",display_name:"Server",type:"text",default_value:"meshblu.octoblu.com",description:"your server",required:!0},{name:"port",display_name:"Port",type:"number",default_value:80,description:"server port",required:!0}],newInstance:function(t,n,a){n(new e(t,a))}});var e=function(e,t){var n=e;this.onSettingsChanged=function(e){n=e},this.updateNow=function(){var e;(e=skynet.createConnection({uuid:n.uuid,token:n.token,server:n.server,port:n.port})).on("ready",function(n){e.on("message",function(e){t(e)})})},this.onDispose=function(){}}}(),function(){var e=100,t=["#FF9900","#FFFFFF","#B3B4B4","#6B6B6B","#28DE28","#13F7F9","#E6EE18","#C41204","#CA3CB8","#0B1CFB"];function n(n,a,i){var r=$(n).data().values,o=$(n).data().valueMin,s=$(n).data().valueMax;r||(r=[],o=void 0,s=void 0);var l=function(t,n){r[n]||(r[n]=[]),r[n].length>=e&&r[n].shift(),r[n].push(Number(t)),(void 0===o||t<o)&&(o=t),(void 0===s||t>s)&&(s=t)};_.isArray(a)?_.each(a,l):l(a,0),$(n).data().values=r,$(n).data().valueMin=o,$(n).data().valueMax=s;var d='<span style="color: {{color}}">&#9679;</span> {{y}}',c=!1;_.each(r,function(e,a){$(n).sparkline(e,{type:"line",composite:c,height:"100%",width:"100%",fillColor:!1,lineColor:t[a%t.length],lineWidth:2,spotRadius:3,spotColor:!1,minSpotColor:"#78AB49",maxSpotColor:"#78AB49",highlightSpotColor:"#9D3926",highlightLineColor:"#9D3926",chartRangeMin:o,chartRangeMax:s,tooltipFormat:i&&i[a]?d+" ("+i[a]+")":d}),c=!0})}var a=freeboard.getStyleString("values");freeboard.addStyle(".widget-big-text",a+"font-size:75px;"),freeboard.addStyle(".tw-display","width: 100%; height:100%; display:table; table-layout:fixed;"),freeboard.addStyle(".tw-tr","display:table-row;"),freeboard.addStyle(".tw-tg","display:table-row-group;"),freeboard.addStyle(".tw-tc","display:table-caption;"),freeboard.addStyle(".tw-td","display:table-cell;"),freeboard.addStyle(".tw-value",a+"overflow: hidden;display: inline-block;text-overflow: ellipsis;"),freeboard.addStyle(".tw-unit","display: inline-block;padding-left: 10px;padding-bottom: 1.1em;vertical-align: bottom;"),freeboard.addStyle(".tw-value-wrapper","position: relative;vertical-align: middle;height:100%;"),freeboard.addStyle(".tw-sparkline","height:20px;");var i=function(e){var t=e,a=$('<div class="tw-display"></div>'),i=$('<h2 class="section-title tw-title tw-td"></h2>'),r=$('<div class="tw-value"></div>'),o=$('<div class="tw-unit"></div>'),s=$('<div class="tw-sparkline tw-td"></div>');function l(){_.isUndefined(t.units)||""==t.units?r.css("max-width","100%"):r.css("max-width",a.innerWidth()-o.outerWidth(!0)+"px")}this.render=function(e){$(e).empty(),$(a).append($('<div class="tw-tr"></div>').append(i)).append($('<div class="tw-tr"></div>').append($('<div class="tw-value-wrapper tw-td"></div>').append(r).append(o))).append($('<div class="tw-tr"></div>').append(s)),$(e).append(a),l()},this.onSettingsChanged=function(e){t=e;var n=!_.isUndefined(e.title)&&""!=e.title,a=!_.isUndefined(e.units)&&""!=e.units;e.sparkline?s.attr("style",null):(delete s.data().values,s.empty(),s.hide()),n?(i.html(_.isUndefined(e.title)?"":e.title),i.attr("style",null)):(i.empty(),i.hide()),a?(o.html(_.isUndefined(e.units)?"":e.units),o.attr("style",null)):(o.empty(),o.hide()),"big"==e.size?valueFontSize="60px":"regular"==e.size?valueFontSize="30px":valueFontSize=e.size,r.css({"font-size":valueFontSize}),l()},this.onSizeChanged=function(){l()},this.onCalculatedValueChanged=function(e,a){"value"==e&&(t.animate?function(e,t,n){var a=$(t).text();if(a!=e)if($.isNumeric(e)&&$.isNumeric(a)){var i=e.toString().split("."),r=0;i.length>1&&(r=i[1].length);var o=0;(i=a.toString().split(".")).length>1&&(o=i[1].length),jQuery({transitionValue:Number(a),precisionValue:o}).animate({transitionValue:Number(e),precisionValue:r},{duration:n,step:function(){$(t).text(this.transitionValue.toFixed(this.precisionValue))},done:function(){$(t).text(e)}})}else $(t).text(e)}(a,r,500):r.text(a),t.sparkline&&n(s,a))},this.onDispose=function(){},this.getHeight=function(){return"big"==t.size||t.sparkline?2:1},this.onSettingsChanged(e)};freeboard.loadWidgetPlugin({type_name:"text_widget",display_name:"Text",settings:[{name:"title",display_name:"Title",type:"text"},{name:"size",display_name:"Size",type:"option",options:[{name:"Regular",value:"regular"},{name:"Big",value:"big"},{name:"Small",value:"small"},{name:"Medium",value:"Medium"},{name:"Large",value:"large"},{name:"Extra Large",value:"x-large"},{name:"32px",value:"32px"},{name:"48px",value:"48px"},{name:"64px",value:"64px"}]},{name:"value",display_name:"Value",type:"calculated"},{name:"sparkline",display_name:"Include Sparkline",type:"boolean"},{name:"animate",display_name:"Animate Value Changes",type:"boolean",default_value:!0},{name:"units",display_name:"Units",type:"text",options:function(){return{lbs:"",kgs:"",psi:"",meters:"",feet:"",mm:"",degC:"",degF:""}}},{name:"font",display_name:"Font",type:"text",options:function(){return{FBMono:"",FBSans:"",DSEG7:"",DSEG14:"",Pandora:"",FBCursive:"",FBSerif:"",DIN:"",FBComic:"",QTBlackForest:"",PenguinAttack:"",Chancery:"",Pixel:"",Handwriting:"",Chalkboard:"",RoughScript:""}}}],newInstance:function(e,t){t(new i(e))}});var r=0;freeboard.addStyle(".gauge-widget-wrapper","width: 100%;text-align: center;");freeboard.loadWidgetPlugin({type_name:"gauge",display_name:"Gauge",settings:[{name:"title",display_name:"Title",type:"text"},{name:"heading",display_name:"Heading",type:"text"},{name:"style",type:"json",display_name:"Theming",schema:{type:"object",title:"Theme",properties:{pointerColor:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerTipColor:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerCircleInner:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerCircleInnerEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerCircleOuter:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerCircleOuterEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerShadowBottom:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerShadowTop:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},fgColor:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderInner:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderInnerEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderMiddle:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderMiddleEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderOuter:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderOuterEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderInnerWidth:{type:"number",min:0,max:12},borderMiddleWidth:{type:"number",min:0,max:12},borderOuterWidth:{type:"number",min:0,max:12},size:{type:"number",min:1,max:8},borderShadow:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},plateColor:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}},default_value:"rgb(0,0,0)"},plateColorEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}},default_value:"rgb(0,0,0)"},fontTitleSize:{type:"number",min:8,max:64},fontValueSize:{type:"number",min:8,max:64}}},default_value:{pointerCircleInner:"rgb(57,43,21)",pointerCircleInnerEnd:"rgb(57,43,21)",pointerCircleOuter:"rgb(87,63,41)",pointerCircleOuterEnd:"rgb(57,43,21)",pointerShadowTop:"#000000",pointerShadowBottom:"#000000",pointerColor:"#000000",pointerTipColor:"#002000",fgColor:"rgb(57,43,21)",borderInner:"rgb(77,68,56)",borderInnerEnd:"rgb(59,44,36)",borderMiddle:"rgb(202,192,155)",borderMiddleEnd:"rgb(163,145,96)",borderOuter:"rgb(102,90,67)",borderOuterEnd:"rgb(57,41,34)",borderInnerWidth:2,borderMiddleWidth:3,borderOuterWidth:2,borderShadow:"#000000",plateColor:"rgb(204,198,190)",plateColorEnd:"rgb(195,190,180)",fontTitleSize:32,fontValueSize:40,size:4}},{name:"value",display_name:"Value",type:"calculated"},{name:"units",display_name:"Units",type:"text"},{name:"min_value",display_name:"Minimum",type:"text",default_value:0},{name:"max_value",display_name:"Maximum",type:"text",default_value:100},{name:"tick_interval",display_name:"Tick Spacing",type:"text",default_value:10},{name:"minor_ticks",display_name:"Tick divisions",type:"text",default_value:5},{name:"digits",display_name:"Show digits",type:"number",default_value:4}],newInstance:function(e,t){t(new function(e){var t,n=this,a="gauge-"+r++,i=$('<h2 class="section-title"></h2>'),o=$('<canvas width=180 height=180 id="'+a+'"></canvas>'),s=!1;function l(){if(s){o.empty(),t&&t.destroy();var i=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--title-line-height"))+10;o.attr("width",60*parseInt(e.style.size)-i).attr("height",60*parseInt(e.style.size)-i);for(var r=document.getElementById(a),l=String(n.currentSettings.max_value||100).split(".")[0].length,d={renderTo:r,width:60*Number(e.style.size)-i,height:60*Number(e.style.size)-i,units:n.currentSettings.units,title:n.currentSettings.title,value:n.value,minValue:n.currentSettings.min_value,maxValue:n.currentSettings.max_value,majorTicks:[],minorTicks:n.currentSettings.minorTicks,strokeTicks:!1,highlights:[],colorBorderOuter:n.currentSettings.style.borderOuter,colorBorderOuterEnd:n.currentSettings.style.borderOuterEnd,colorBorderMiddle:n.currentSettings.style.borderMiddle,colorBorderMiddleEnd:n.currentSettings.style.borderMiddleEnd,colorBorderInner:n.currentSettings.style.borderInner,colorBorderInnerEnd:n.currentSettings.style.borderInnerEnd,borderInnerWidth:n.currentSettings.style.borderInnerWidth,borderMiddleWidth:n.currentSettings.style.borderMiddleWidth,borderOuterWidth:n.currentSettings.style.borderOuterWidth,colorBorderShadow:n.currentSettings.style.borderShadow,colorPlate:n.currentSettings.style.plateColor,colorPlateEnd:n.currentSettings.style.plateColorEnd,colorMajorTicks:n.currentSettings.style.fgColor,colorMinorTicks:n.currentSettings.style.fgColor,colorTitle:n.currentSettings.style.fgColor,colorUnits:n.currentSettings.style.fgColor,colorNumbers:n.currentSettings.style.fgColor,colorNeedle:n.currentSettings.style.pointerColor,colorNeedleShadowUp:n.currentSettings.style.pointerShadowTop,colorNeedleShadowBottom:n.currentSettings.style.pointerShadowBottom,colorNeedleEnd:n.currentSettings.style.pointerTipColor,colorNeedleCircleOuter:n.currentSettings.style.pointerCircleOuter,colorNeedleCircleOuterEnd:n.currentSettings.style.pointerCircleOuterEnd,colorNeedleCircleInner:n.currentSettings.style.pointerCircleInner,colorNeedleCircleInnerEnd:n.currentSettings.style.pointerCircleInnerEnd,fontTitleSize:n.currentSettings.style.fontTitleSize,fontUnitsSize:n.currentSettings.style.fontTitleSize,fontValueSize:n.currentSettings.style.fontValueSize,valueBox:n.currentSettings.digits>0,valueInt:l,valueDec:Math.max(n.currentSettings.digits-l,0),animationRule:"bounce",animationDuration:500,animation:!1},c=parseInt(n.currentSettings.min_value);c<=parseInt(n.currentSettings.max_value);)d.majorTicks.push(String(c)),c+=parseInt(n.currentSettings.tick_interval);var u=new RadialGauge(d);u.draw(),t=u}}n.value=0,n.currentSettings=e,e.style=e.style||{},this.render=function(e){s=!0,$(e).append(i).append($('<div class="gauge-widget-wrapper"></div>').append(o)),l()},this.onSettingsChanged=function(e){n.currentSettings=e,l(),i.html(e.heading||"")},this.onCalculatedValueChanged=function(e,a){n.value=a,_.isUndefined(t)||(t.value=Number(a),o.attr("title",String(a)+(n.currentSettings.units||"")))},this.onDispose=function(){t&&t.destroy()},this.getHeight=function(){try{return n.currentSettings.style.size}catch(e){return console.log(e),3}},this.onSettingsChanged(e)}(e))}}),freeboard.addStyle(".sparkline","width:100%;height: 75px;");var o=function(e){var a=$('<h2 class="section-title"></h2>'),i=$('<div class="sparkline"></div>'),r=$("<div></div>"),o=e;this.render=function(e){$(e).append(a).append(i).append(r)},this.onSettingsChanged=function(e){o=e,a.html(_.isUndefined(e.title)?"":e.title),e.include_legend&&function(e,n){for(var a=$("<div class='sparkline-legend'></div>"),i=0;i<n.length;i++){var r=t[i%t.length],o=n[i];a.append("<div class='sparkline-legend-value'><span style='color:"+r+"'>&#9679;</span>"+o+"</div>")}e.empty().append(a),freeboard.addStyle(".sparkline-legend","margin:5px;"),freeboard.addStyle(".sparkline-legend-value","color:white; font:10px arial,san serif; float:left; overflow:hidden; width:50%;"),freeboard.addStyle(".sparkline-legend-value span","font-weight:bold; padding-right:5px;")}(r,e.legend.split(","))},this.onCalculatedValueChanged=function(e,t){o.legend?n(i,t,o.legend.split(",")):n(i,t)},this.onDispose=function(){},this.getHeight=function(){var e=0;if(o.include_legend&&o.legend){var t=o.legend.split(",").length;t>4?e=.5*Math.floor((t-1)/4):t&&(e=.5)}return 2+e},this.onSettingsChanged(e)};freeboard.loadWidgetPlugin({type_name:"sparkline",display_name:"Sparkline",settings:[{name:"title",display_name:"Title",type:"text"},{name:"value",display_name:"Value",type:"calculated",multi_input:"true"},{name:"include_legend",display_name:"Include Legend",type:"boolean"},{name:"legend",display_name:"Legend",type:"text",description:"Comma-separated for multiple sparklines"}],newInstance:function(e,t){t(new o(e))}}),freeboard.addStyle("div.pointer-value","position:absolute;height:95px;margin: auto;top: 0px;bottom: 0px;width: 100%;text-align:center;");freeboard.loadWidgetPlugin({type_name:"pointer",display_name:"Pointer",settings:[{name:"direction",display_name:"Direction",type:"calculated",description:"In degrees"},{name:"value_text",display_name:"Value Text",type:"calculated"},{name:"units",display_name:"Units",type:"text"}],newInstance:function(e,t){t(new function(e){var t,n,a,i,r=$('<div class="widget-big-text"></div>'),o=$("<div></div>");this.render=function(e){a=$(e).width(),i=$(e).height();var s=Math.min(a,i)/2-6,l=(t=Raphael($(e).get()[0],a,i)).circle(a/2,i/2,s);l.attr("stroke","#FF9900"),l.attr("stroke-width",3),(n=t.path(function(e){if(!e||e.length<2)return[];var t=[];t.push(["m",e[0],e[1]]);for(var n=2;n<e.length;n+=2)t.push(["l",e[n],e[n+1]]);return t.push(["z"]),t}([a/2,i/2-s+3,15,20,-30,0]))).attr("stroke-width",0),n.attr("fill","#fff"),$(e).append($('<div class="pointer-value"></div>').append(r).append(o))},this.onSettingsChanged=function(e){o.html(e.units)},this.onCalculatedValueChanged=function(e,t){"direction"==e?_.isUndefined(n)||n.animate({transform:"r"+t+","+a/2+","+i/2},250,"bounce"):"value_text"==e&&r.html(t)},this.onDispose=function(){},this.getHeight=function(){return 4},this.onSettingsChanged(e)}(e))}});freeboard.loadWidgetPlugin({type_name:"picture",display_name:"Picture",fill_size:!0,settings:[{name:"src",display_name:"Image URL",type:"calculated"},{type:"number",display_name:"Refresh every",name:"refresh",suffix:"seconds",description:"Leave blank if the image doesn't need to be refreshed"}],newInstance:function(e,t){t(new function(e){var t,n,a;function i(){n&&(clearInterval(n),n=null)}function r(){if(t&&a){var e=a;$(t).css({"background-image":"url("+e+")"})}}this.render=function(e){$(e).css({width:"100%",height:"100%","background-size":"cover","background-position":"center"}),t=e},this.onSettingsChanged=function(e){i(),e.refresh&&e.refresh>0&&(n=setInterval(r,1e3*Number(e.refresh)))},this.onCalculatedValueChanged=function(e,t){"src"==e&&(a=t),r()},this.onDispose=function(){i()},this.getHeight=function(){return 4},this.onSettingsChanged(e)}(e))}}),freeboard.addStyle(".indicator-light","border-radius:50%;width:22px;height:22px;border:2px solid #3d3d3d;margin-top:5px;float:left;background-color:#222;margin-right:10px;"),freeboard.addStyle(".indicator-light.on","background-color:#FFC773;box-shadow: 0px 0px 15px #FF9900;border-color:#FDF1DF;"),freeboard.addStyle(".indicator-text","margin-top:10px;");freeboard.loadWidgetPlugin({type_name:"indicator",display_name:"Indicator Light",settings:[{name:"title",display_name:"Title",type:"text"},{name:"value",display_name:"Value",type:"calculated"},{name:"on_text",display_name:"On Text",type:"calculated"},{name:"off_text",display_name:"Off Text",type:"calculated"}],newInstance:function(e,t){t(new function(e){var t,n,a=$('<h2 class="section-title"></h2>'),i=$('<div class="indicator-text"></div>'),r=$('<div class="indicator-light"></div>'),o=e,s=!1;function l(){r.toggleClass("on",s),s?i.text(_.isUndefined(t)?_.isUndefined(o.on_text)?"":o.on_text:t):i.text(_.isUndefined(n)?_.isUndefined(o.off_text)?"":o.off_text:n)}this.render=function(e){$(e).append(a).append(r).append(i)},this.onSettingsChanged=function(e){o=e,a.html(_.isUndefined(e.title)?"":e.title),l()},this.onCalculatedValueChanged=function(e,a){"value"==e&&(s=Boolean(a)),"on_text"==e&&(t=a),"off_text"==e&&(n=a),l()},this.onDispose=function(){},this.getHeight=function(){return 1},this.onSettingsChanged(e)}(e))}}),freeboard.addStyle(".gm-style-cc a","text-shadow:none;"),freeboard.addStyle(".html-widget","white-space:normal;width:100%;height:100%");freeboard.loadWidgetPlugin({type_name:"html",display_name:"Show computed HTML",fill_size:!0,settings:[{name:"html",display_name:"HTML",type:"calculated",description:"Can be literal HTML, or javascript that outputs HTML."},{name:"height",display_name:"Height Blocks",type:"number",default_value:4,description:"A height block is around 60 pixels"}],newInstance:function(e,t){t(new function(e){var t=$('<div class="html-widget"></div>'),n=e;this.render=function(e){$(e).append(t)},this.onSettingsChanged=function(e){n=e},this.onCalculatedValueChanged=function(e,n){"html"==e&&t.html(n)},this.onDispose=function(){},this.getHeight=function(){return Number(n.height)},this.onSettingsChanged(e)}(e))}})}(),function(){var e=0;freeboard.addStyle(".textbox","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".textbox-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-textbox-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-textbox-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"richtextbox_plugin",display_name:"Rich Text Box",description:"Interactive Textbox Plugin with 2-way data binding.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text",default_value:""},{name:"size",display_name:"Size(height blocks)",type:"number",default_value:8},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When element loses focus",value:"change"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be the text",type:"target"}],newInstance:function(e,n){n(new t(e))}});var t=function(t){var n=this;n.currentSettings=t;var a="textbox-"+e++,i=$('<div id="__'+a+'"></div>').css("position","static").css("overflow","scroll").height("100%"),r=$('<h2 class="section-title textbox-label"></h2>'),o="#"+a+"-trumbo";r.html(n.currentSettings.title),n.value="";$.trumbowyg.svgPath=!1,$.trumbowyg.hideButtonTexts=!0;var s=$('<textarea id="'+a+'-trumbo"></textarea>').appendTo(i),l=["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646","ffff00","f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd"];$("#"+a+"-trumbo").on("tbwchange",function(e){"realtime"==n.currentSettings.mode&&n.dataTargets.target($("#"+a+"-trumbo").trumbowyg("html"))}),$("#"+a+"-trumbo").on("tbwblur",function(e){n.dataTargets.target($("#"+a+"-trumbo").trumbowyg("html"))}),n.render=function(e){$(e).append(i),r.appendTo(i),s.appendTo(i),n.toDestroy&&n.toDestroy("destroy"),$("#"+a+"-trumbo").trumbowyg({btns:[["viewHTML"],["undo","redo"],["formatting"],["strong","em","del"],["superscript","subscript"],["foreColor","backColor"],["link"],["base64"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat"],["fullscreen"],["fontsize","fontfamily","preformatted"],["emoji","table","specialChars"]],semantic:!1,plugins:{colors:{displayAsList:!0,foreColorList:l,backColorList:l},fontfamily:{fontList:[{name:"Seriff",family:"FBSerif"},{name:"Sans",family:"FBSans"},{name:"Monospace",family:"FBMono"},{name:"Cursive",family:"FBCursive"},{name:"Pandora",family:"Pandora"},{name:"Chalkboard",family:"Chalkboard"},{name:"Handwriting",family:"Handwriting"},{name:"Rough Script",family:"RoughScript"},{name:"Chancery",family:"Chancery"},{name:"Comic",family:"FBComic"},{name:"Blackletter",family:"Blackletter"},{name:"Stencil",family:"Stencil"},{name:"Pixel",family:"Pixel"},{name:"B612",family:"B612"},{name:"DIN",family:"DIN"},{name:"Penguin Attack",family:"PenguinAttack"},{name:"DSEG7",family:"DSEG7"},{name:"DSEG14",family:"DSEG14"}]}}}),n.toDestroy=$("#"+a+"-trumbo").trumbowyg,$("#"+a+"-trumbo").closest(".trumbowyg-box").css("min-height",Math.max(60*parseInt(n.currentSettings.size)-80,30)),$("#"+a+"-trumbo").prev(".trumbowyg-editor").css("min-height",Math.max(60*parseInt(n.currentSettings.size)-80,30)),$("#"+a+"-trumbo").closest(".trumbowyg-box").css("height",Math.max(60*parseInt(n.currentSettings.size)-80,30)),$("#"+a+"-trumbo").prev(".trumbowyg-editor").css("height",Math.max(60*parseInt(n.currentSettings.size)-80,30)),$("#"+a+"-trumbo").on("change",function(e){n.dataTargets.target(e.target.value)}),$("#"+a+"-trumbo").on("input",function(e){n.value=e.target.value,"change"!=n.currentSettings.mode&&(_.isUndefined(n.currentSettings.target)||n.dataTargets.target(e.target.value))}),$(o).removeClass("ui-widget-content")},n.getHeight=function(){return parseInt(n.currentSettings.size)},n.onSettingsChanged=function(e){n.currentSettings=e,r.html(_.isUndefined(e.title)?"":e.title),n.currentSettings.unit=n.currentSettings.unit||"",$(o).attr("pattern",e.pattern),$(o).attr("placeholder",e.placeholder),$(o).attr("tooltip",e.placeholder),$("#"+a+"-trumbo").closest(".trumbowyg-box").css("min-height",Math.max(60*parseInt(n.currentSettings.size)-80,30)),$("#"+a+"-trumbo").prev(".trumbowyg-editor").css("min-height",Math.max(60*parseInt(n.currentSettings.size)-80,30)),$("#"+a+"-trumbo").closest(".trumbowyg-box").css("height",Math.max(60*parseInt(n.currentSettings.size)-80,30)),$("#"+a+"-trumbo").prev(".trumbowyg-editor").css("height",Math.max(60*parseInt(n.currentSettings.size)-80,30))},n.onCalculatedValueChanged=function(e,t){if("target"==e){n.value=t;var a=t;a!=$(o).val()&&$(o).val(a)}"placeholder"==e&&$(o).attr("placeholder",t)},n.onDispose=function(){n.toDestroy("destroy")}}}(),function(){freeboard.loadDatasourcePlugin({type_name:"core_scratchpad_plugin",display_name:"Scratchpad Variables",description:"The data is just an empty space.  To set some data, use datasources['scratchpad']['SomeName'] as a data target.  It will be available to read in other widgets.  You can also set the default data using JSON.",settings:[{name:"data",display_name:"Default Data(as JSON or JS expression)",type:"calculated",default_value:"={}",options:function(){return{"={key: 'value'}":""}},description:"Must be a valid JS =expression that returns an object. Whatever it returns will be the default data.",required:!0},{name:"persist",display_name:"Persistance Mode",type:"option",default_value:"off",options:[{name:"Off",value:"off"},{name:"Board",value:"board"}],description:"off: no persistance,  board: changes are passed to the Default Data field and can be exported with the board.",required:!0},{name:"lock",display_name:"Lock data(read only)",type:"boolean",default_value:!1},{name:"",display_name:"",html:"Show current data",type:"button",onclick:function(e,t){freeboard.showDialog(JSON.stringify(t.data),"Debug data for: "+e+" (non-JSON not shown)","OK")},description:""},{name:"",display_name:"",html:"Show current data in JSON editor",type:"button",description:"",onclick:function(e,t){var n=[];freeboard.showDialog($('<div id="fb-global-json-editor">'),"Debug data for: "+e+" (non-JSON not shown)","OK","Cancel",function(){Object.assign(t.proxy,n[0].getValue()),n[0].destroy()},function(){n[0].destroy()});var a=new JSONEditor(document.getElementById("fb-global-json-editor"),{schema:{}});n.push(a),a.setValue(t.data)}}],newInstance:function(t,n,a){n(new e(t,a))}});var e=function(e,t){var n=this,a=e;n.handler={set:function(e,i,r){if(a.lock)throw new Error("Cannot change this. It is locked in the datasource settings");return e[i]=r,t(n.proxy),"board"==a.persist&&(a.data="="+JSON.stringify(e),freeboard.setDatasourceSettings(a.name,e)),!0}},n.data={},n.proxy=new Proxy(n.data,n.handler),n.onSettingsChanged=function(e){a=e,t(n.proxy)},n.onCalculatedSettingChanged=function(e,a){"data"==e&&(n.data=a,n.proxy=new Proxy(n.data,n.handler),t(n.proxy))},n.updateNow=function(){var e;e=n.proxy,t(e)},n.onDispose=function(){}}}(),function(){var e=0;freeboard.addStyle(".slider","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".slider-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-slider-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-slider-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"slider_plugin",display_name:"Slider",description:"Interactive Slider Plugin with 2-way data binding.  Value is a list of 2 items, the value and the timestamp.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text"},{name:"unit",display_name:"Unit of measure",type:"text"},{name:"min",display_name:"Min",type:"calculated",default_value:"0"},{name:"max",display_name:"Max",type:"calculated",default_value:"100"},{name:"step",display_name:"Step",type:"calculated",default_value:"1"},{name:"default",display_name:"Default Value",type:"calculated",default_value:"0"},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When Released",value:"change"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be a value, timestamp pair.",type:"target"}],newInstance:function(e,n){n(new t(e))}});var t=function(t){var n=this;currentSettings=t,currentSettings.unit=currentSettings.unit||"";var a="slider-"+e++,i=$('<div class="slider-widget slider-label" id="__'+a+'"></div>'),r=$('<h2 class="section-title slider-label"></h2>'),o=$('<div id="value-'+a+'" style="display:inline-block; padding-left: 10px; font-weight:bold; color: #d3d4d4" ></div>'),s=$("<input/>",{type:"range",id:a}),l="#"+a,d="#value-"+a;_.isUndefined(currentSettings.value)||currentSettings.value;r.html(_.isUndefined(currentSettings.title)?"":currentSettings.title),n.min=_.isUndefined(currentSettings.min)?0:currentSettings.min,n.max=_.isUndefined(currentSettings.max)?100:currentSettings.max,n.step=_.isUndefined(currentSettings.step)?100:currentSettings.step,n.value=void 0;n.render=function(e){$(e).append(i),r.appendTo(i),$(r).append(o),s.appendTo(i),$(l).attr("min",n.min),$(l).attr("max",n.max),$(l).attr("step",n.step),$(l).css("width","95%"),$(l).on("input",function(e){$("#value-"+a).html(e.value)}),$(d).html((n.value||0)+currentSettings.unit),$(l).on("change",function(e){n.dataTargets.target(parseFloat(e.target.value))}),$(l).on("input",function(e){n.value=e.target.value,$(d).html(e.target.value+currentSettings.unit),"change"!=currentSettings.mode&&n.dataTargets.target(parseFloat(e.target.value))}),$(l).removeClass("ui-widget-content")},n.getHeight=function(){return"big"==currentSettings.size?2:1},n.onSettingsChanged=function(e){currentSettings=e,r.html(_.isUndefined(e.title)?"":e.title),$(r).append(o),currentSettings.unit=currentSettings.unit||"",$(d).html((n.value||0)+currentSettings.unit)},n.onCalculatedValueChanged=function(e,t){if("target"==e){n.value=t;var a=t;$(o).html(a+currentSettings.unit),a!=$(l).val()&&$(l).val(a)}if("default"==e&&_.isUndefined(n.value)){t=parseFloat(t),n.dataTargets.target(t),n.value=t;a=t;$(o).html(a+currentSettings.unit),a!=$(l).val()&&$(l).val(a)}"step"==e&&(n.step=t,$(l).attr("step",n.step)),"max"==e&&(t>n.min?(n.max=t,$(l).attr("max",t)):(currentSettings.max=n.max,freeboard.showDialog($("<div align='center'> Max value cannot be lower than Min value!</div>"),"Warning!","OK",null,function(){}))),"min"==e&&(t<n.max?(n.min=t,$(l).attr("min",t)):(currentSettings.min=n.min,freeboard.showDialog($("<div align='center'> Min value cannot be greater than Max value!</div>"),"Warning!","OK",null,function(){})))},n.onDispose=function(){}}}(),function(){var e=0;freeboard.loadWidgetPlugin({type_name:"switch_plugin",display_name:"Switch",description:"Interactive on-off switch",settings:[{name:"title",display_name:"Title",type:"text"},{name:"target",display_name:"Data Target",type:"target",description:"Bind state to this datasource"},{name:"default",display_name:"Default",type:"calculated"},{name:"on_text",display_name:"On Text",type:"text",default_value:"On"},{name:"off_text",display_name:"Off Text",type:"text",default_value:"Off"},{name:"sound",display_name:"Sound(URL or builtin)",type:"text",default_value:"",options:freeboard.getAvailableSounds}],newInstance:function(e,n){n(new t(e))}}),freeboard.addStyle(".floating-box","display: inline-block; vertical-align: top; width: 78px; background-color: #222;margin-top: 10px; margin-right: 5px;"),freeboard.addStyle(".round","border-radius: 50%;");var t=function(t){var n=this,a="onoffswitch-"+e++,i=t,r=$('<div class="floating-box"></div>'),o=$('<div class="floating-box onoffswitch-title">'+t.title+"</div>"),s=$('<div class="onoffswitch"><label class="onoffswitch-label" for="'+a+'"><div class="onoffswitch-inner"><span class="on"></span><span class="off"></span></div><div class="onoffswitch-switch round"></div></label></div>');function l(){$("#"+a).prop("checked",n.isOn),s.find("span.on").text(n.onText),s.find("span.off").text(n.offText)}s.prependTo(r),n.isOn=!1,n.rawTargetValue=void 0,this.render=function(e){$(e).append(r).append(o);$('<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="'+a+'">').prependTo(s).change(function(e){n.isOn=e.target.checked,freeboard.playSound(i.sound),n.dataTargets.target(n.isOn),n.rawTargetValue=n.isOn})},this.onSettingsChanged=function(e){i=e,o.html(_.isUndefined(e.title)?"":e.title),n.onText=e.on_text,n.offText=e.off_text,l()},this.onCalculatedValueChanged=function(e,t){if("target"==e){n.rawTargetValue=t;var a=t;(r=Boolean(a))!=n.isOn&&(n.isOn=r,freeboard.playSound(i.sound))}if("default"==e&&_.isUndefined(n.rawTargetValue)){n.rawTargetValue=t;var r;a=t;(r=Boolean(a))!=n.isOn&&(n.isOn=r),n.dataTargets.target(r)}l()},this.onDispose=function(){},this.getHeight=function(){return 1},this.onSettingsChanged(t)}}(),function(){var e=0;freeboard.addStyle(".textbox","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".textbox-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-textbox-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-textbox-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"textbox_plugin",display_name:"Text Box",description:"Interactive Textbox Plugin with 2-way data binding.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text",default_value:""},{name:"tooltip",display_name:"Tooltip hint",type:"text",default_value:""},{name:"pattern",display_name:"Validation Regex",type:"text",default_value:".*"},{name:"placeholder",display_name:"Placeholder text",type:"calculated",default_value:""},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When element loses focus",value:"change"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be the text",type:"target"},{name:"default",display_name:"Default Value",type:"calculated"}],newInstance:function(e,n){n(new t(e))}});var t=function(t){var n=this;n.currentSettings=t;var a="textbox-"+e++,i=$('<div class="textbox-widget textbox-label" id="__'+a+'"></div>'),r=$('<h2 class="section-title textbox-label"></h2>'),o=$("<input/>",{type:"text",pattern:t.pattern,id:a,name:a}).css("width","90%"),s="#"+a,l="#value-"+a;r.html(n.currentSettings.title),n.value=void 0;n.render=function(e){$(e).append(i),r.appendTo(i),o.appendTo(i),$(s).attr("placeholder",n.currentSettings.placeholder),$(s).attr("title",n.currentSettings.tooltip),$(s).attr("pattern",n.currentSettings.pattern),$(l).html((n.value||"")+n.currentSettings.unit),$(s).on("change",async function(e){_.isUndefined(n.currentSettings.target);try{await n.dataTargets.target(e.target.value)}catch(e){freeboard.showDialog(e,"Bad data target","OK"),freeboard.playSound("error")}}),$(s).on("input",function(e){n.value=e.target.value,$(l).html(e.target.value+n.currentSettings.unit),"change"!=n.currentSettings.mode&&(_.isUndefined(n.currentSettings.target)||n.dataTargets.target(e.target.value))}),$(s).removeClass("ui-widget-content")},n.getHeight=function(){return"big"==n.currentSettings.size?2:1},n.onSettingsChanged=function(e){n.currentSettings=e,r.html(_.isUndefined(e.title)?"":e.title),n.currentSettings.unit=n.currentSettings.unit||"",$(s).attr("pattern",e.pattern),$(s).attr("placeholder",e.placeholder),$(s).attr("tooltip",e.placeholder)},n.onCalculatedValueChanged=function(e,t){var a;"target"==e&&(n.value=t,(a=t)!=$(s).val()&&$(s).val(a));"default"==e&&(_.isUndefined(n.value)&&(n.value=t,(a=t)!=$(s).val()&&$(s).val(a),n.dataTargets.target(t)));"placeholder"==e&&$(s).attr("placeholder",t)},n.onDispose=function(){}}}();