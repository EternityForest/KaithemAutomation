!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.exprEval=e()}(this,function(){"use strict";function t(t,e,s){for(var n=s||0;n<t.length;n++)if(t[n]===e)return n;return-1}function e(t){function e(){}return e.prototype=t,new e}function s(t,e){this.type=t,this.value=void 0!==e&&null!==e?e:0}function n(t,s){this.tokens=t,this.parser=s,this.ops1=e(s.ops1),this.ops2=e(s.ops2),this.ops3=e(s.ops3),this.functions=e(s.functions)}function r(t){return"string"==typeof t?(tt.lastIndex=0,tt.test(t)?"'"+t.replace(tt,function(t){var e=et[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+t+"'"):t}function i(t,e,n,r,o){for(var h,p,u,a,c=[],f=[],l=0,v=t.length;l<v;l++){var x=t[l],w=x.type;if(w===z)c.push(x);else if(w===Q&&o.hasOwnProperty(x.value))x=new s(z,o[x.value]),c.push(x);else if(w===H&&c.length>1)p=c.pop(),h=c.pop(),a=n[x.value],x=new s(z,a(h.value,p.value)),c.push(x);else if(w===K&&c.length>2)u=c.pop(),p=c.pop(),h=c.pop(),"?"===x.value?c.push(h.value?p.value:u.value):(a=r[x.value],x=new s(z,a(h.value,p.value,u.value)),c.push(x));else if(w===D&&c.length>0)h=c.pop(),a=e[x.value],x=new s(z,a(h.value)),c.push(x);else if(w===Z){for(;c.length>0;)f.push(c.shift());f.push(new s(Z,i(x.value,e,n,r,o)))}else if(w===$&&c.length>0)h=c.pop(),c.push(new s(z,h.value[x.value]));else{for(;c.length>0;)f.push(c.shift());f.push(x)}}for(;c.length>0;)f.push(c.shift());return f}function o(t,e,n){for(var r=[],i=0,h=t.length;i<h;i++){var p=t[i],u=p.type;if(u===Q&&p.value===e)for(var a=0;a<n.tokens.length;a++){var c,f=n.tokens[a];c=f.type===D?G(f.value):f.type===H?W(f.value):f.type===K?J(f.value):new s(f.type,f.value),r.push(c)}else u===Z?r.push(new s(Z,o(p.value,e,n))):r.push(p)}return r}function h(t,e,s){for(var n,r,i,o,p=[],u=0,a=t.length;u<a;u++){var c=t[u],f=c.type;if(f===z)p.push(c.value);else if(f===H)r=p.pop(),n=p.pop(),o=e.ops2[c.value],p.push(o(n,r));else if(f===K)i=p.pop(),r=p.pop(),n=p.pop(),"?"===c.value?p.push(h(n?r:i,e,s)):(o=e.ops3[c.value],p.push(o(n,r,i)));else if(f===Q)if(c.value in e.functions)p.push(e.functions[c.value]);else{var l=s[c.value];if(void 0===l)throw new Error("undefined variable: "+c.value);p.push(l)}else if(f===D)n=p.pop(),o=e.ops1[c.value],p.push(o(n));else if(f===Y){for(var v=c.value,x=[];v-- >0;)x.unshift(p.pop());if(o=p.pop(),!o.apply||!o.call)throw new Error(o+" is not a function");p.push(o.apply(void 0,x))}else if(f===Z)p.push(c.value);else{if(f!==$)throw new Error("invalid Expression");n=p.pop(),p.push(n[c.value])}}if(p.length>1)throw new Error("invalid Expression (parity)");return p[0]}function p(t,e){for(var s,n,i,o,h=[],u=0,a=t.length;u<a;u++){var c=t[u],f=c.type;if(f===z)h.push(r(c.value));else if(f===H)n=h.pop(),s=h.pop(),o=c.value,e?"^"===o?h.push("Math.pow("+s+", "+n+")"):"and"===o?h.push("("+s+" && "+n+")"):"or"===o?h.push("("+s+" || "+n+")"):"||"===o?h.push("(String("+s+") + String("+n+"))"):"=="===o?h.push("("+s+" === "+n+")"):"!="===o?h.push("("+s+" !== "+n+")"):h.push("("+s+" "+o+" "+n+")"):h.push("("+s+" "+o+" "+n+")");else if(f===K){if(i=h.pop(),n=h.pop(),s=h.pop(),o=c.value,"?"!==o)throw new Error("invalid Expression");h.push("("+s+" ? "+n+" : "+i+")")}else if(f===Q)h.push(c.value);else if(f===D)s=h.pop(),o=c.value,"-"===o||"+"===o?h.push("("+o+s+")"):e?"not"===o?h.push("(!"+s+")"):h.push(o+"("+s+")"):h.push("("+o+" "+s+")");else if(f===Y){for(var l=c.value,v=[];l-- >0;)v.unshift(h.pop());o=h.pop(),h.push(o+"("+v.join(", ")+")")}else if(f===$)s=h.pop(),h.push(s+"."+c.value);else{if(f!==Z)throw new Error("invalid Expression");h.push("("+p(c.value,e)+")")}}if(h.length>1)throw new Error("invalid Expression (parity)");return h[0]}function u(e,s){for(var n=0,r=e.length;n<r;n++){var i=e[n];i.type===Q&&t(s,i.value)===-1?s.push(i.value):i.type===Z&&u(i.value,s)}}function a(t,e){return Number(t)+Number(e)}function c(t,e){return t-e}function f(t,e){return t*e}function l(t,e){return t/e}function v(t,e){return t%e}function x(t,e){return""+t+e}function w(t,e){return t===e}function y(t,e){return t!==e}function m(t,e){return t>e}function M(t,e){return t<e}function g(t,e){return t>=e}function d(t,e){return t<=e}function k(t,e){return Boolean(t&&e)}function E(t,e){return Boolean(t||e)}function A(t){return Math.sinh?Math.sinh(t):(Math.exp(t)-Math.exp(-t))/2}function b(t){return Math.cosh?Math.cosh(t):(Math.exp(t)+Math.exp(-t))/2}function T(t){return Math.tanh?Math.tanh(t):t===1/0?1:t===-(1/0)?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function C(t){return Math.asinh?Math.asinh(t):t===-(1/0)?t:Math.log(t+Math.sqrt(t*t+1))}function O(t){return Math.acosh?Math.acosh(t):Math.log(t+Math.sqrt(t*t-1))}function S(t){return Math.atanh?Math.atanh(t):Math.log((1+t)/(1-t))/2}function I(t){return Math.log(t)*Math.LOG10E}function N(t){return-t}function F(t){return!t}function P(t){return Math.trunc?Math.trunc(t):t<0?Math.ceil(t):Math.floor(t)}function L(t){return Math.random()*(t||1)}function j(t){t=Math.floor(t);for(var e=Math.max(t,1);t>1;)e*=--t;return e}function R(){if(Math.hypot)return Math.hypot.apply(this,arguments);for(var t=0,e=arguments.length,s=0;s<e;s++){if(arguments[s]===1/0||arguments[s]===-(1/0))return 1/0;t+=arguments[s]*arguments[s]}return Math.sqrt(t)}function U(t,e,s){return t?e:s}function q(t,e){return"[object Array]"!==Object.prototype.toString.call(t)?[t,e]:(t=t.slice(),t.push(e),t)}function B(t,e,s,n){this.type=t,this.value=e,this.line=s,this.column=n}function _(t,e,s,n,r){this.pos=0,this.line=0,this.column=0,this.current=null,this.ops1=e,this.ops2=s,this.ops3=n,this.consts=r,this.expression=t}function G(t){var e=ut[t];return e||(e=ut[t]=new s(D,t)),e}function W(t){var e=at[t];return e||(e=at[t]=new s(H,t)),e}function J(t){var e=ct[t];return e||(e=ct[t]=new s(K,t)),e}function V(t,e){this.parser=t,this.tokens=e,this.current=null,this.nextToken=null,this.next()}function X(){this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:A,cosh:b,tanh:T,asinh:C,acosh:O,atanh:S,sqrt:Math.sqrt,log:Math.log,lg:I,log10:I,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:P,"-":N,"+":Number,exp:Math.exp,not:F},this.ops2={"+":a,"-":c,"*":f,"/":l,"%":v,"^":Math.pow,",":q,"||":x,"==":w,"!=":y,">":m,"<":M,">=":g,"<=":d,and:k,or:E},this.ops3={"?":U},this.functions={random:L,fac:j,min:Math.min,max:Math.max,hypot:R,pyt:R,pow:Math.pow,atan2:Math.atan2,if:U},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}var z="INUMBER",D="IOP1",H="IOP2",K="IOP3",Q="IVAR",Y="IFUNCALL",Z="IEXPR",$="IMEMBER";s.prototype.toString=function(){switch(this.type){case z:case D:case H:case K:case Q:return this.value;case Y:return"CALL "+this.value;case $:return"."+this.value;default:return"Invalid Instruction"}};var tt=/[\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,et={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};n.prototype.simplify=function(t){return t=t||{},new n(i(this.tokens,this.ops1,this.ops2,this.ops3,t),this.parser)},n.prototype.substitute=function(t,e){return e instanceof n||(e=this.parser.parse(String(e))),new n(o(this.tokens,t,e),this.parser)},n.prototype.evaluate=function(t){return t=t||{},h(this.tokens,this,t)},n.prototype.toString=function(t){return p(this.tokens,t)},n.prototype.symbols=function(){var t=[];return u(this.tokens,t),t},n.prototype.variables=function(){var t=[];u(this.tokens,t);var e=this.functions;return t.filter(function(t){return!(t in e)})},n.prototype.toJSFunction=function(t,e){var s=this,n=new Function(t,"with(this.functions) with (this.ops3) with (this.ops2) with (this.ops1) { return "+this.simplify(e).toString(!0)+"; }");return function(){return n.apply(s,arguments)}};var st="TEOF",nt="TOP",rt="TNUMBER",it="TSTRING",ot="TPAREN",ht="TCOMMA",pt="TNAME";B.prototype.toString=function(){return this.type+": "+this.value},_.prototype.newToken=function(t,e,s,n){return new B(t,e,null!=s?s:this.line,null!=n?n:this.column)},_.prototype.next=function(){return this.pos>=this.expression.length?this.newToken(st,"EOF"):this.isWhitespace()||this.isComment()?this.next():this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isComma()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},_.prototype.isString=function(){var t=!1,e="",s=this.line,n=this.column;if(this.pos<this.expression.length&&"'"===this.expression.charAt(this.pos))for(this.pos++,this.column++;this.pos<this.expression.length;){var r=this.expression.charAt(this.pos);if("'"===r&&"\\"!==e.slice(-1)){this.current=this.newToken(it,this.unescape(e),s,n),this.pos++,this.column++,t=!0;break}e+=r,this.pos++,this.column++,"\n"===r&&(this.line++,this.column=0)}return t},_.prototype.isParen=function(){var t=this.expression.charAt(this.pos);return("("===t||")"===t)&&(this.current=this.newToken(ot,t),this.pos++,this.column++,!0)},_.prototype.isComma=function(){var t=this.expression.charAt(this.pos);return","===t&&(this.current=this.newToken(ht,","),this.pos++,this.column++,!0)},_.prototype.isConst=function(){for(var t="",e=this.pos;e<this.expression.length;e++){var s=this.expression.charAt(e);if(s.toUpperCase()===s.toLowerCase()&&(e===this.pos||"_"!==s&&"."!==s&&(s<"0"||s>"9")))break;t+=s}return t.length>0&&t in this.consts&&(this.current=this.newToken(rt,this.consts[t]),this.pos+=t.length,this.column+=t.length,!0)},_.prototype.isNamedOp=function(){for(var t="",e=this.pos;e<this.expression.length;e++){var s=this.expression.charAt(e);if(s.toUpperCase()===s.toLowerCase()&&(e===this.pos||"_"!==s&&(s<"0"||s>"9")))break;t+=s}return t.length>0&&(t in this.ops2||t in this.ops1||t in this.ops3)&&(this.current=this.newToken(nt,t),this.pos+=t.length,this.column+=t.length,!0)},_.prototype.isName=function(){for(var t="",e=this.pos;e<this.expression.length;e++){var s=this.expression.charAt(e);if(s.toUpperCase()===s.toLowerCase()&&(e===this.pos||"_"!==s&&(s<"0"||s>"9")))break;t+=s}return t.length>0&&(this.current=this.newToken(pt,t),this.pos+=t.length,this.column+=t.length,!0)},_.prototype.isWhitespace=function(){for(var t=!1,e=this.expression.charAt(this.pos);" "===e||"\t"===e||"\n"===e||"\r"===e;)t=!0,this.pos++,this.column++,"\n"===e&&(this.line++,this.column=0),e=this.expression.charAt(this.pos);return t},_.prototype.unescape=function(t){for(var e=[],s=!1,n=0;n<t.length;n++){var r=t.charAt(n);if(s){switch(r){case"'":e.push("'");break;case"\\":e.push("\\");break;case"/":e.push("/");break;case"b":e.push("\b");break;case"f":e.push("\f");break;case"n":e.push("\n");break;case"r":e.push("\r");break;case"t":e.push("\t");break;case"u":var i=parseInt(t.substring(n+1,n+5),16);e.push(String.fromCharCode(i)),n+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+r+'"')}s=!1}else"\\"===r?s=!0:e.push(r)}return e.join("")},_.prototype.isComment=function(){var t=this.expression.charAt(this.pos);if("/"===t&&"*"===this.expression.charAt(this.pos+1)){var e=this.pos;this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length);for(var s=this.expression.substring(e,this.pos),n=s.indexOf("\n");n>=0;)this.line++,this.column=s.length-n,n=s.indexOf("\n",n+1);return!0}return!1},_.prototype.isNumber=function(){for(var t=!1,e="",s=this.pos,n=!1,r=!1;this.pos<this.expression.length;){var i=this.expression.charAt(this.pos);if(!(i>="0"&&i<="9"||!n&&"."===i))break;"."===i?n=!0:r=!0,e+=this.expression.charAt(this.pos),this.pos++,this.column++,t=r}return t?this.current=this.newToken(rt,parseFloat(e)):this.pos=s,t},_.prototype.isOperator=function(){var t=this.expression.charAt(this.pos);if("+"===t||"-"===t||"*"===t||"/"===t||"%"===t||"^"===t||"?"===t||":"===t||"."===t)this.current=this.newToken(nt,t);else if("∙"===t||"•"===t)this.current=this.newToken(nt,"*");else if(">"===t)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(nt,">="),this.pos++,this.column++):this.current=this.newToken(nt,">");else if("<"===t)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(nt,"<="),this.pos++,this.column++):this.current=this.newToken(nt,"<");else if("|"===t){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(nt,"||"),this.pos++,this.column++}else if("="===t){if("="!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(nt,"=="),this.pos++,this.column++}else if("!"===t){if("="!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(nt,"!="),this.pos++,this.column++}else if("a"===t){if("n"!==this.expression.charAt(this.pos+1)||"d"!==this.expression.charAt(this.pos+2))return!1;this.current=this.newToken(nt,"and"),this.pos+=2,this.column+=2}else{if("o"!==t)return!1;if("r"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(nt,"or"),this.pos++,this.column++}return this.pos++,this.column++,!0},_.prototype.parseError=function(t){throw new Error("parse error ["+(this.line+1)+":"+(this.column+1)+"]: "+t)};var ut={},at={},ct={};V.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},V.prototype.tokenMatches=function(e,s){return"undefined"==typeof s||("[object Array]"===Object.prototype.toString.call(s)?t(s,e.value)>=0:"function"==typeof s?s(e):e.value===s)},V.prototype.accept=function(t,e){return!(this.nextToken.type!==t||!this.tokenMatches(this.nextToken,e))&&(this.next(),!0)},V.prototype.expect=function(t,e){if(!this.accept(t,e))throw new Error("parse error ["+this.tokens.line+":"+this.tokens.column+"]: Expected "+(e||t))},V.prototype.parseAtom=function(t){if(this.accept(pt))t.push(new s(Q,this.current.value));else if(this.accept(rt))t.push(new s(z,this.current.value));else if(this.accept(it))t.push(new s(z,this.current.value));else{if(!this.accept(ot,"("))throw new Error("unexpected "+this.nextToken);this.parseExpression(t),this.expect(ot,")")}},V.prototype.parseExpression=function(t){this.parseConditionalExpression(t)},V.prototype.parseConditionalExpression=function(t){for(this.parseOrExpression(t);this.accept(nt,"?");){var e=[],n=[];this.parseConditionalExpression(e),this.expect(nt,":"),this.parseConditionalExpression(n),t.push(new s(Z,e)),t.push(new s(Z,n)),t.push(J("?"))}},V.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(nt,"or");)this.parseAndExpression(t),t.push(W("or"))},V.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(nt,"and");)this.parseComparison(t),t.push(W("and"))},V.prototype.parseComparison=function(t){for(this.parseAddSub(t);this.accept(nt,["==","!=","<","<=",">=",">"]);){var e=this.current;this.parseAddSub(t),t.push(W(e.value))}},V.prototype.parseAddSub=function(t){for(this.parseTerm(t);this.accept(nt,["+","-","||"]);){var e=this.current;this.parseTerm(t),t.push(W(e.value))}},V.prototype.parseTerm=function(t){for(this.parseFactor(t);this.accept(nt,["*","/","%"]);){var e=this.current;this.parseFactor(t),t.push(W(e.value))}},V.prototype.parseFactor=function(t){function e(t){return t.value in s}var s=this.tokens.ops1;if(this.accept(nt,e)){var n=this.current;this.parseFactor(t),t.push(G(n.value))}else this.parseExponential(t)},V.prototype.parseExponential=function(t){for(this.parseFunctionCall(t);this.accept(nt,"^");)this.parseFactor(t),t.push(W("^"))},V.prototype.parseFunctionCall=function(t){for(this.parseMemberExpression(t);this.accept(ot,"(");)if(this.accept(ot,")"))t.push(new s(Y,0));else{var e=this.parseArgumentList(t);t.push(new s(Y,e))}},V.prototype.parseArgumentList=function(t){for(var e=0;!this.accept(ot,")");)for(this.parseExpression(t),++e;this.accept(ht);)this.parseExpression(t),++e;return e},V.prototype.parseMemberExpression=function(t){for(this.parseAtom(t);this.accept(nt,".");)this.expect(pt),t.push(new s($,this.current.value))},X.parse=function(t){return(new X).parse(t)},X.evaluate=function(t,e){return X.parse(t).evaluate(e)},X.Expression=n,X.prototype={parse:function(t){var e=[],s=new V(this,new _(t,this.ops1,this.ops2,this.ops3,this.consts));return s.parseExpression(e),s.expect(st,"EOF"),new n(e,this)},evaluate:function(t,e){return this.parse(t).evaluate(e)}};var ft={Parser:X};return ft});
//# sourceMappingURL=bundle.min.js.map 
