<%include file="/pageheader.html"/>
<title>Kaithem for Devices</title>

<section>
<h2>Kaithem for Devices</h2>

<p>Kaithem for devices is a technology to create "programs" on the kaitherm server that run in a lightweight VM on ESP32 powered devices. The VM is based on Squirrel, and it and
    all the support code needed to use it is packaged in the Kaithem source repository as a set of Arduino libraries.  This allows you to embed the ability to interact with the Kaithem server in any Arduino sketch.

    K4D is beta software, and version compatibility is not guaranteed.
</p>

<p>K4D is based on the Acorns distribution, and as such provides a command shell vial the serial port, which allows you to set up the WiFi and the K4D key easily. To do so, simply type: setConfig(key, value)
</p>

<p>Relevant keys are wifi.psk, wifi.ssid, and pavillion.psk. The pavillion key used to connect must be a 32-byte value, expressed as 64 hex chars, and must be random to be secure.(This has never been cryptanalyzed, so don't trust it yet.)</p>


<p>Once you have configured the physical device, Add a device in kaithem by addind a new Pavillion device in the devices tab. The name can be anything that doesn't start with a special char, because it is only used locally on server
itself. This allows easy setup, because a module can be configured to interact with "Whatever device you have named 'foo'", meaning you don't have to change the code itself to setup a device.</p>

<p>The PSK must be a matching 64 hex char string, the client ID is not currently used as K4D accepts any client with the proper PSK, and the port must be 12345 unless you have configured it otherwise in your Arduino sketch.</p>


<p>After this, Create a "K4D Squirrel Program" as a new resource in a module, and type "print("foo")". Kaithem will upload the code to the remote device, it will execute there, and the results of the print
    statement will be shown on the Kaithem page.
</p>

<p>K4D has a few interesting features meant to increase reliability. One is that attempting to replace a program with an updated version does nothing if the two programs are the same. When Kaithem or the remote device boots, it
    will attempt to load all programs targeted to that device. If they are already running, it will not interrupt them.
</p>

<p>The programs will continue running until the remote device restarts, making K4D applicable to unreliable networks that require graceful fallback.</p>

</section>

<%include file="/pagefooter.html"/>