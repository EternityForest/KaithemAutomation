<style type="text/css">
h2 {
	background-color: rgba(200, 255, 220, 0.4);
}

h3 {
	margin-top: 1em !important;
	margin-bottom: 1em !important;
	background-color: rgba(255, 255, 255, 0.3);
}

h4 {
	margin-top: 0.5em !important;
	margin-bottom: 0.5em !important;
	background-color: rgba(220, 220, 220, 0.25);
}
</style>
<%include file="/pageheader.html"/>
<title>Kaithem Help</title>
<h1>Kaithem Help</h1>

<div class="sectionbox">
    <h2>
        <a id="intro" name="intro"></a>Introduction
    </h2>
    <p>Kaithem is an automation solution based on the concept of events,triggers, and actions. An event is a
        statement that when the trigger occurs, the action should be executed.</p>

    <p>Kaithem is written in pure Python and will run in either 2.6+ or 3.xx without modification, the difference
        being that unicode resource and user names are not allowed in Kaithem on 2.xx</p>

    <p>Kaithem includes all dependancies(except the optional mpg123 or SOX or mplayer for sound support)</p>

    <p>In addition, Kaithem provides TLS/SSL encryption, user management, and serves as a basic IDE to create web
        pages that can interact with your process data. Kaithem was not designed for mission-critical control purposes,
        but aims to be fully reliable enough for basic home and commercial automation tasks.</p>

    <p>
        An important idea in Kaithem is that resources, such as events, data, and web pages, all exist within <em>modules</em>.
        This allows for a very simple plugin based architecture wherein device plugins can be bundled with the web pages
        to manage them. Modules can be downloades or uploaded to and from the server as zip files, or can be created and
        modified straight from the web interface.
    </p>

    <P>
        One <b>very important note</b> about Kaithem is that it does not save anything to the disk except when told to
        or if autosave was explicilty configured. To do this, go to the Save State page and follow the instructions. In
        the event that the software crashes while saving, old data will not be corrupted and the old version will be
        used. Manual recovery of the new version will likely be possible for at least some files.
    </P>

    <p>The exception to this rule is log files. Logs are maintained in ram till they reach a certain size(default
        33,000 entries) then saved to disk. They are also saved when you explicitly save the entire state, or periodically if this is configured.</p>

    <h2>
        <a id="modules"></a>Modules:
    </h2>
    <p>
        Kaithem is based on the idea that <em>everything is a module</em>. This makes it very easy to write new device
        drivers, as they can simply be modules. Code and management pages are just resources within modules. A module is
        just a loose collection of resources all with a unique name. Note that two resources with different types still
        must have unique names. Resources can be anything from events and actions to user defined pages to custom
        permissions.
    </p>
    <p>You can name modules as you like, but anything beginning with a double-underscore("__") is reserved.
    Resource, user, and group names beginning with a double underscore are also reserved.</p>


    <h2>
        <a id="events">Events</a>
    </h2>
        <p>
            One of the main automation constructs is the <em>event</em>. Events are mappings between a <em>trigger</em>
            and an <em>action</em>.A trigger can be a python expression that when the return value goes from False to
            True(edge triggered), the <em>Action</em>, which is simply a python script, executes.
        </p>

        <p>
            A trigger can also be a<b>Special Trigger Expression</b>. Trigger expressions begin with an exclamation
            point and provide functionality that would be cumbersome with a python statement.
        </p>


        <p>Events have their own special scope similar to a local scope that is pre-populated when the event loads
            with several useful things, among these the kaithem object(see below).
            Internally they are implemented as modules that are generated on the fly.
            The setup code runs directly inside the module, whilst the trigger and action are used to generate two functions.</p>
        
        <a id="trigger"></a>    
        <h3>Availible Trigger Expressions</h3>
        <h4>!onmsg [topic]</h4>
        <p>This trigger expression causes the event to occur when a message is posted to the internal message bus
            matching [topic]. The actual topic and message are then availible as __topic and __message respectively. If
            another message occurs while the event is running, it will be handled after the first event is done.</p>

        <h4>!onchange [expression]</h4>
        <p>This trigger expression causes the event to occur when the value of expression changes. the most recent
            value of expression is availible as __value.</p>
            
            
        <h4>!time [expression]</h4>
        <p>This causes the event to occur at a specific time, such as "every Friday" or "every hour on Monday".
           This is powered by the recurrent library and supports any expression that library does.
           Events will occur near the start of a second.
           </p>
           
        <p>Some preprocessing occurs before the recurrent library parses it, 
        so that any expression of the form blah/blah will be interpreted as a timezone. Timezone names must be in the Olson TZ list("US/Central","Etc/UTC", etc)
        If the time expression does not contain a time zone, it will be assumed to be in the server's local time.</p>
        
        <p>If a time event is still running by the next occurrance, it will be skipped unless allow_overlap is present somewhere in the string.</p>
        
        

        <h2>
            <a id="pages" name="pages"></a>Pages:
        </h2>
        <p>Kaithem allows users with the appropriate permissions to create user-defined pages. User defined pages
            are written in HTML and may contain embedded mako template code. Every page is a resource of a module. Mako
            is a simple templating language allowing you to embed server-side python in HTML code. Python code in user
            defined pages has access to the kaithem object(see below) and and if desired the python code may have side
            effects, allowing a wide variety of web services, information displays, and control panels to be created
            using only kaithem's page system.</p>

        <p>Access to pages is controlled through kaithem's permission system, and any page may require one or more
            permissions to access. New Permissions can be defined as module resources.</p>

        <p>Every user-created page has an URL of the form /pages/MODULENAME/PAGENAME</p>

        <p>Unlike events, the page-local scope does not persist between calls</p>

        <p>
            User pages should follow the <a href="/docs#theming">Theming Guidelines</a>.
        </p>
        
        <p>If is possible to handle requests for nonexistant pages to some extent.
        If a user tries to access a page /pages/MODULENAME/[nonexistantpage] or
        /pages/MODULENAME/some/big/long/path/to/nowhere
        it will return /pages/MODULENAME/__default__ should such a page exist.
        It will not create an HTTP redirect, it will simply return the contents of __default__</p>

        <h2>
            <a id="scope" name="scope"></a>Scoping
        </h2>
        <p>Almost all programming languages have some concept of scope and Python is no different. Every event has
            its own global scope, similar to a module. If you set a variable in the event action and use the global keyword,
            it will be there next time the event runs, but will not be directly visible in other resources.
            If you assign a variable in an event action without the global keyword, it will simply disappear after the event runs like any function local variable.
            This does not apply to Mako code inside page html. Mako code will act like function local variables and only persist for the life of the call, and globals don't really apply here.</p>
            
        <p>Anything defined in the Setup function of an event becomes a part of the global namespace for that event, and can be accessed by code in Trigger and Action,
        and written to by use of the global keyword.</p>
        

        <p>Every resource scope(including setup,trigger,action, and Mako pages) however will contain an object called kaithem, which is a global object with some
            useful utilities, and an object called module, which is shared between all resources within one module. The
            module objects have no special properties beyond the ability to assign objects to them.</p>


        <h2>
            <a id="auth" name="auth"></a>Users and access control:
        </h2>
        <p>
            Access control is based on <em>users</em>, <em>groups</em>, and <em>permissions</em>.
        </p>
        <p>
            A user may belong to any number of groups.<span style="font-style: italic;"> </span>A user has access to all
            permissions of the groups he or she is a member of.
        </p>
        <p>
            To create new users or groups, change group memberships or permissions, or delete users, you must have the<span
                style="font-style: italic;"> /admin/users.edit </span>permission. Keep in mind a user with this
            permission can give himself any other permission and so has full access. Do not give this permission to an
            untrusted user.
        </p>
        <p>Permissions are generally of the form&nbsp; "/&lt;path&gt;/&lt;item&gt;.&lt;action&gt;" without quotes.
            The path describes the general catergory, the item specifies a resource, and the action specifies an action
            that may be performed on the resource. Modules may define their own permissions, and user-defined pages may
            be configured to require one or more permissions to access. For consistancy, You should always use the above
            permission format.</p>

        <p>Upon creating a new permission, you will immediately be able to assign it to groups by selecting the
            checkbox in the group page.</p>
        
        <h2>The Widget System</h2>
        <p>
        Kaithem integrates an AJAX library that allows you to create dynamic widgets within HTML pages that automatically interact with the corresponding object on the server.
        You do not need to write any javascript at all to use Kaithem Widgets. Most Widgets automatically handle multiple users, such as moving sliders on one device to match a change on another. 
        
        </p>
        <h3>widget.js</h3>
        <p> Somewhere in your page before the first widget, you must include this line:</p>
        <pre>&lt;script type="text/javascript" src="/static/widget.js">&lt;/script></pre>
        <p>
        This will include a small JS library that will automatically handle polling for you.
        </p>
        
        <h3>Widget Objects</h3>
        <p>A widget object represents one widget, and handles AJAX for you automatically. Each widget type is slightly different, but all widgets have a render() method.
        The render method produces HTML suitable for direct inclusion in a page, as in <%text><pre>${module.myWidget.render()}</pre></%text>
        The rendered HTML will contain a few functions, the ID of the widget object that created it, and a piece of code that registers it for polling.</p>
        
        <p>Widgets may take parameters in their render() function on a widget specific basis</p>
        
        <p>You must maintain a reference to all widget objects you create to prevent them from being garbage collected.</p>
        
        <p>Most widget objects will have  write(value) and read() functions. For example, a calling read()
          on a slider widget would return whatever slider position the user entered. If there are multiple users,
          all sliders rendered from the same object will move in synch</p>
          
        <h3>The Widget() Base Class</h3>
        <p>All Kaithem widgets inherit from Widget. Widget provides security, polling handling, and bookkeeping.
        Widget has the following properties, which may be overridden, extendd, or removed in derivd classes:
        
        </p>
        <h3>Widget.render(*args,**kwargs)</h3>
        <p>Returns an HTML representation of the widget, including all javascript needed,
        and suitable for direct inclusion in HTML code as you would a div or img.
        Widgets are usually inline-block elements. Many numeric widgets will take an optional kewyword argument label and unit.
        </p>
        
        <h3>Widget.uuid (Always available)</h3>
        <p>This is a string representation of the Widget's ID. It is automatically created when initializing Widget.</p>
         
        <h3>Widget.require(permission) (Always Available)</h3>
        <p>Causes the object to reject AJAX read or write requests from any device that does not have the permissions.
        You can apply as many permissions as you want.</p>
        
        <h3>Widget.requireToWrite(permission) (Always Available)</h3>
        <p>Causes the object to reject AJAX write requests from any device that does not have the permissions.
        You can apply as many permissions as you want.</p>
        
        <h3>Widget.onRequest(user) (Always Available)</h3>
        <p>
        This function is automatically called when an authorized client requests the latest value.
        It must return None for unknown/no change or else a JSON serializable value specific to the widget type.
        You only need to know about this function when creating custom widgets.
        </p>
        
        <h3>Widget.onUpdate(user,value) (Always Available)</h3>
        <p>
        This function is automatically called when an authorized client requests to set a new value.
        value will be specific to the widget.
        You only need to know about this function when creating custom widgets.
        </p>
        
        <h3>Widget.read() (Usually Available)</h3>
        <p>
        returns the current "value" of the widget, an is available for all readable widgets where the idea of "value" makes sense.
        </p>
        
        <h3>Widget.write(value) (Usually Available)</h3>
        <p>
        sets the current "value" of the widget, an is available for all writable widgets where the idea of "value" makes sense.
        </p>
        
        <h3><a name="widgetattach"></a>Widget.attach(f)</h3>
        <p>Set a callback that fires when new data comes in from the widget. The function must take two values, user, and data.
        User is the username of the user that changed the widget, and data is it's new value</p> 
        
        
        <h2>
            <a id="kaithemobject" name="kaithemobject"></a>The Kaithem Object:
        </h2>
        <p>The Kaithem object is one object available in almost all user defined code. It has the following
            properties:</p>

        <h3>General Utilities</h3>


        <h4>kaithem.globals</h4>
        <p>An instance of object() who's only purpose is so that the user can asign it attributes. Be careful, as the
            kaithem namespace is truly global.</p>


        <h3>kaithem.misc</h3>

        <h4>kaithem.misc.lorem()</h4>
        <p>Returns about a sentence to a paragraph of placeholder text that may change between calls and may not
            actually be classic Lorem Ipsum text.</p>

        <h4>kaithem.misc.do(function):</h4>

        <p>Executes a function of no arguments in the background using kaithem's thread pool.
        Any errors are posted to the message bus at system/errors/workers.
        There is no protection against infinite loops.</p>

            
        <h4>Kaithem.misc.uptime()</h4>
        <p>Returns uptime in seconds of the kaithem server(not of the machine itself)</p>
        
        <h4>Kaithem.misc.errors(f)</h4>
        <p>Returns any exception object raised during calling f, or else none if no errors.</p>      
  
        <h3>kaithem.time</h3>
        <h4>kaithem.time.strftime(timestamp)</h4>
        <p>Format a time in seconds since the epoch according to the user's preference. When called outside
        of a page, format according to the default</p>
        
        <h4>kaithem.time.year()</h4>
        <p>Return current year in server's time zone as an integer .</p>
        
        <h4>kaithem.time.month()</h4>
        <p>Return current month in the server's time zone. s month object, which can be printed like a string,
        but can be intelligently compared(January="Jan"=="January"==0)
        Month objects do not support comparisions besides equality, however they can be cast to integers.
        Jan=0
        </p>

        <h4>kaithem.time.dayofweek()</h4>
        <p>Returns a day-of-week object in the server's time zone.that inherits from string and prints as an uppercase full name(like
            'Tuesday'), but can be intelligently compared(DoW=='tue','Tue,'Tuesday','tu',1,'1',etc). When usig numbers,
            monday is 0. Again, only equality comparisions, but you can cast to int.</p>

        <h4>kaithem.time.[minute|second|hour]()</h4>
        <p>All of these functions perform as expected(e.g. minute() returns a number between 0 and 59). hour() uses
            24 hour server local time</p>
            
        <h4>kaithem.time.isdst()</h4>
        <p>Return true is daylight savings time is in effect where the server is.</p>
        
        <h4>kaithem.time.day()</h4>
        <p>Returns the day of the month in the server's time zone.</p>

        <h4>kaithem.time.moonPhase()</h4>
        <p>Returns the current moon phase as a number:
<pre>0  = New moon
7  = First quarter
14 = Full moon
21 = Last quarter</pre>
        
        <b>NOTE: isDay,isNight,isDark, and isLight may raise an exception 
        if there is no sunrise or sunset in the current day(as in some regions in the arctic circle during some seasons).</b>
        <h4>kaithem.time.isDay(lat,lon)</h4>
        <p>Return true if it is before sunset in the given lat-lon location.
        If no coordinates are supplied, the server location configured in the settings page is used.
        If no location is configured, an error is raised.
        </p>
        
        <h4>kaithem.time.isNight(lat=None,lon=None)</h4>
        <p>Return true if it is after sunset in the given lat-lon location.
        Kaithem handles coordinates as floating point values.
        If no coordinates are supplied, the server location configured in the settings page is used.
        If no location is configured, an error is raised.
     
        </p>
        
        <h4>kaithem.time.isDark(lat=None,lon=None)</h4>
        <p>Return true if it is currently past civil twilight in the given lat-lon location.
        Civil twilight is defined when the sun is 6 degrees below the horizon.
        In some countries, drivers must turn on headlights past civil twilight.
        Civil twilight is commonly used as the time to start using artificial light sources.
        If no coordinates are supplied, the server location configured in the settings page is used.
        If no location is configured, an error is raised.
        </p>
        
        <h4>kaithem.time.isLight(lat=None,lon=None)</h4>
        <p>Return true if it is not past civil twilight given lat-lon location.
        If no coordinates are supplied, the server location configured in the settings page is used.
        If no location is configured, an error is raised.
        </p>
        
        <h4>kaithem.time.isRahu(llat=None,lon=None)</h4>
        <p>Return true if it is currently Rahukalaam
        (A period during each day that is considered inauspicious for new ventures in Indian astrology)
        in the given lat-lon location. For more info see the <a href= "http://en.wikipedia.org/wiki/Rahukaalam">wiki article.</a>
        If no coordinates are supplied, the server location configured in the settings page is used.
        If no location is configured, an error is raised.
        
        <h4>kaithem.time.accuracy()</h4>
        <p>Get a conservative estimate(offset plus root delay plus root dispersion) of the maximum error of the system clock in seconds using pool.ntp.org
        Only polls NTP at most every 600 seconds. If the server is unreachable, uses the cached value,
        plus 100ppm of the time since the server was checked. If the server was never reachable, use the value of 30 years.</p>
       
        <h3>kaithem.sys</h3>
        <h4>kaithem.sys.shellex(cmd)</h4>
        <p>Run a command in the system's native shell and return the output.</p>

        <h4>kaithem.sys.shellexbg(cmd)</h4>
        <p>Run a command in the system's native shell in the background and ignore the output and return codes.</p>

        <h4>kaithem.sys.lsfiles(path)</h4>
        <p>List all files under path on the server.</p>

        <h4>kaithem.sys.lsdirs(path)</h4>
        <p>List all directories under path on the server.</p>

        <h4>kaithem.sys.which(exe)</h4>
        <p>Similar to the unix which command. Returns the path to the program that will be called for a given
            command in the command line, or None if there is no such program</p>
            
        <h3>kaithem.registry</h3>
        <p>The kaithem registry is a persistance store for small amounts of configuration data.
        It does not get saved to disk until the server state is saved, or a configured autosave occurs.
        The registry is heirarchial and slash separated, keys are strings,
        values are anything json serializable, and keys should begin with the relevant module name, and should condier double underscores reserved.</p>
        
        <h4>kaithem.registry.get(key,default=None)</h4>
        <p>Gets the registry key. Returns default if the key does not exist.</p>
        
        <h4>kaithem.registry.set(key,value)</h4>
        <p>Sets the registry key.</p>
        

        <h3>kaithem.sound</h3>
        
        <p>The kaithem.sound API is slightly different depending on which backend has been configured.
        By default mplayer will be used if available and is the recommended backed.<p>
        
        <h4>kaithem.play(filename,handle="PRIMARY",volume=1,start=0,end=-0.0001, eq=None, output=None,fs=False)</h4>
        <p>If you have mpg123 or SOX installed, play the file, otherwise do nothing. The handle
            parameter lets you name the new sound instance to stop it later. If you try to play a sound under the same
            handle as a stil-playing sound, the old one will be stopped. Defaults to PRIMARY.
            </p><p>
            With the mplayer backend, if you give it a video file, it will likely open a window and play it.
            Passing fs=True may allow you to play fullscreen, but any use of this "hidden feature" is very experimental.
            results may be undefined if you attempt to play a video in an environment that does not support it.
            
            All the features that work with audio should also work with video.
            </p>
            <p>
            Volume is a dimensionless multiplier that only works if using SOX or mplayer. Otherwise it is ignored.
            Start and end times are in seconds, negative means relative to sound end. Start and end times
            are also SOX/mplayer specific and are ignored(full sound will always play) with other players.
            </p>
            
            <p>
            output and eq are mplayer specific and do nothing with other backends. eq if present can take the value 'party' 
            causing the EQ to be set to allow easier conversation. output must be a string that selects an output device.
            A typical value on linx would be pulse::n where n is the pulse sink index, see mplayer's -ao option for more details.
            </p>

        <h4>kaithem.sound.stop(handle="PRIMARY"")</h4>
        <p>Stop a sound by handle.</p>

        <h4>kaithem.sound.stopAll()</h4>
        <p>Stop all currently playing sounds.</p>

        <h4>kaithem.sound.isPlaying(handle="PRIMARY")</h4>
        <p>Return true if a sound with handle handle is playing. Note that the sound might finish before you
            actually get around to doing anything with the value. If using the dummy backend because a backend is not
            installed, result is undefined, but will not be an error, and will be a boolean value. If a sound is paused, will return True anyway.</p>
            
        <h4>kaithem.sound.setvol(vol,handle="PRIMARY")</h4>
        <p>Set the volume of a sound. Volume goes from 0 to 1.
        Only works with the mplayer backend. If you are using any other sound backend, this does nothing.</p>
        
        <h4>kaithem.sound.pause(handle="PRIMARY")</h4>
        <p>Pause a sound. Does nothing if already paused Only works with the mplayer backend. If you are using any other sound backend, this does nothing.</p>
        
        <h4>kaithem.sound.resume(handle="PRIMARY")</h4>
        <p>Resume a paused a sound. Does nothing if not paused. Only works with the mplayer backend. If you are using any other sound backend, this does nothing.</p>

        <h3>kaithem.message</h3>
        <h4>kaithem.message.post(topic,message)</h4>
        <p>
            Post a message to the internal system-wide message bus. Message MUST be a JSON serializable object. i.e
            True/false, numbers, strings, lists, and dictionaries only. Message topics are hierarchial, delimited by
            forward slashes, and the root directory is /. However /foo is equivalent to foo.<br>
        </p>

        <h4>kaithem.message.subscribe(topic,callback)</h4>
        <p>
            Request that function <i>callback</i> which must take two arguments(topic,message) be called whenever a
            message matching the topic is posted. Should the topic end with a slash, it will also match all
            subtopics(e.g. "/foo/" will match "/foo", "/foo/bar" and "/foo/anything"). Uncaaught errors in the callback are
            ignored. <br> You must always maintain a reference to the callback, otherwise, the callback will be
            garbage collected and auto-unsubscribed. This is also how you unsubscribe.
        </p>
        <h3>kaithem.widget</h3>
        <p><b>See Widgets for info on how to use these. Unless otherwise mentioned, their API is defined by the Widget base class.</b></p>
        
        <h4>kaithem.widget.DynamicSpan()</h4>
        <p>Creates a dynamic span widget. When rendered, A dynamic span widget looks like a normal HTML span.
        however, you can change it's contents by write()ing strings to it. This widget does not return any data.
        </p>
        
        <h4>kaithem.widgets.TimeWidget()</h4>
        <p>All this does is display the current time in his or her prefered format. use like an HTML span or an image. Render takes a parameter type which defaults to widget.
        If type is 'inline', will render as simple text without special styling.
        </p>
        
        <p>Unlike other widgets, the TimeWidget is purely client side and uses the system clock of the client, and as such will even work if /static/widget.js is not included.</p>
        
        
        <h4>kaithem.widgets.Button()</h4>
        <p>This is a button. Data points from it are in the form of lists of states. Normally the value will be ['pushed'], or
        ['released'], but if the user quickly taps the button(a common use for buttons), the value will be ['pressed','released'] or some such.
        Basically, the value records what happened during the most recent pollng period in which there was activity.</p>
        
        <p>The sugessted pattern for dealing with these is to use <a href="#widgetattach">attach()</a> to set a callback, then use a line like "if 'pushed' in value:" to detect button presses.
           Directly reading the value is not reccomended.
        </p>
        
        <p>Mobile devices may not be able to register press-and-hold, but should handle normall presses correctly.</p>
        
        <p>render() takes a <b>required</b> first argument content which is is usually a short string such as "submit" which will appear as the contents of the HTML button.
        render() also takes the optional keyword element type. If type is "trigger", it will render as a larger button that is disabled by default, with a smaller arm/disarm button above it,
        that one must use in order to enable the button. However, as far as the server knows, it acts as a normal button. Good for things you don't want to press accidentally.
        </p>
        
        <h4>kaithem.widgets.Meter(**kwargs)</h4>
        <p>Used for display a changing numeric value. By default, renders to a simple HTML span that changes color on extreme values if limits are defined.
        </p>
        
        <p>The constructor for meter can take a upper critical value called high, a lower crtitcal value called low, an upper warning threshold called high_warn, and a lower warning threshold called low_warn.
        These are all passes as keyword arguments.</p>
        
        <p>Render takes the optional parameter called unit, that specifies a unit to associate, like "Volts" or "Hz" or such, and the optional parameter label,
        which specifies a label such as "CH1 Voltage"</p>
        
        <h4>kaithem.widgets.Slider(**kwargs)</h4>
        <p>A slider widget, that currently may only be vertical. Optional parameters: min, max, and step, must be numbers and control the range and step size of the slider.</p>
        
        <p>Slider.render() takes an optional parameter <i>unit</i> which specifies a unit of measurement to associate. optional parameter label,
        which specifies a label such as "CH1 Voltage, It also takes a parameter type,  which by default is 'realtime',
        which causes the value to be sent to the server whenever the slider is moved. If this value is "onrelease", data will only be sent to the server when you release your mouse or take your finger off the touchscreen.</p>
        
        <h4>kaithem.widgets.Switch(**kwargs)</h4>
        <p>An on-off toggle widget.</p>
        
        <p>Switch.render() takes an optional parameter label, which provides a clickable label.</p>
        
        <p>Switch.read() and Switch.write() return and accept boolean values.</p>
        
        
        <h4>kaithem.widgets.TextBox</h4>
        <p>A text box control. render() takes an optional parameter that provides a label for the box.</p>
        <p>On the server, you can call read() to get it's contents or write(s) to set it's contents</p> 
        
        <p>TextBox.render() takes an optional parameter label to provide a label for the box.</p>
        
        <h4>kaithem.widgets.APIWidget</h4>
        <p>This widget exists to allow you to create custom widgets easily. When you render() it, you pass a parameter htmlid.
        The render function returns a script that places an object into a global javascript variable of that name.
        You can use obj.set(x) to set the widget's value to x, and retrieve the widget's value with obj.value.
        You may use any value that can be represented as JSON.</p>
        
        <p>If you would rather recieve a callback after every pollingcycle with the current value,
        just redefine the objects upd(val) method.</p>
        
        <p>On the python side, <a href="#widgetattach">attach()</a>, read(), and write() all work as expected.</p>
        
        
        <h3>kaithem.web</h3>
        
        <h4>kaithem.web.url(url)</h4>
        <p>URL enode a string.</p>

        <h4>kaithem.web.unurl(url)</h4>
        <p>Decode an URL enoded string.</p>

        <h4>kaithem.web.goBack()</h4>
        <p>When called from code embedded in an HTML page, raises an interrupt causing an HTTP redirect to the
            previous page to be sent. Useful for when you have a page that is only used for it's side effects.</p>
            
        <h4>kaithem.web.user()</h4>
        <p>When called from within a page, returns the usernae of the accessing user or else an empty string if not logged in.</p>
        <h4>
            <a id="servefile" name="servefile"></a>kaithem.web.serveFile(path,contenttype,name = path)
        </h4>
        
        <p>When called from code embedded in an HTML page,raises an interrupt causing the server to skip rendering
            the current page and instead serve a static file. Useful when you need to serve a static file and also need
            to restrict acess to it with permissions.</p>
        
        <h4>kaithem.web.hasPermission(permission)<h4>
        <p>When clled from within a mako template, returns true if the acessing user has the given permission.</p>
        <h3><a id="kdotmail"></a>kaithem.mail</h3>
        <p>These functions allow sending email messages through the <a href="#email">SMTP Server</a> configured in the
        settings page</p>
        
        <h4>kaithem.mail.send(recipient,subject,message)</h4>
        <p>Send a message to an email address, where recipient is an address or list therof, and subject and message are strings.</p>
        
        <h4>kaithem.mail.listSend(list,subject,message)</h4>
        <p>Send a message to an email address, where list is the UUID of a mailing list, and subject and message are strings.
           The message will be sent to all subscribed users.
        </p>
        
        <h3>kaithem.events</h3>
        <p>The kaithem.events namespace provides facilities for programmatically creating events.
        Temporary events created in this manner are handled by the same code as other events.</p>
        
        <h4>kaithem.events.when(trigger,action,priority="interactive")</h4>
        <p>This lets you create an event that will fire exactly once and then dissapear.
        Trigger must be a function that returns true when you want it to fire, and action must be a function</p>
        
        <h4>kaithem.events.after(delay,action,priority)</h4>
        <p>Same as when(), but creates an event that will fire after <i>delay</i> seconds.
        Usful for things like turning lights on for set lengths of time.
        This will only be accurate to within a tenth of a second normally, or within one frame if you set priority to 'realtime'</p>
        
        <p>Note that as both these functions create real(through temporary) events, 
        they have the capability to outlast the creating code. If one set up a event that creates temporary events, then
        deletes the event, the temporary events will remain until triggered or until the server is restarted.</p>
        
        <h3>kaithem.persist</h3>
        <p>Provides easy-to-use functionality for traditional file based persistance.</p>
        
         <h4>kaithem.persist.load(filename)</h4>
        <p>
        Load data from a file named filname in a format dictated by the file extension. 
        Data will be converted to a python appropriate representation and returned.
        </p>
        
        <h4>Supported File Types</h4>
        <dl>
        <dt>.json</dt>
        <dd>Values may be list, dict, string, int, bool, or None</dd>
        <dt>.yaml</dt>
        <dd>Values may be list, dict, string, int, bool, or None</dd>
        <dt>.txt</dt>
        <dd>Values may be anything. str() will be used on it prior to saving.</dd>
        <dt>.bin</dt>
        <dd>Bytes and bytearrays.</dl>
        <dt>*.gz</dt>
        <dd>Any other type may be compressed with gzip compresssion(e.g. "foo.txt.gz")</dd>
        <dt>*.bz2</dt>
        <dd>Any other type may be compressed with bz2 compression(e.g. "bar.json.bz2")</dd>
        </dl>
        
        
        <h4>kaithem.persist.save(data,filename,mode=default)</h4>
        <p>
        Saves data to a file named fn in a format dictated by the file extension. 
        If the file does it exist, it will be created. If it does, it will be overwritten.
        If mode=='backup', a tilde will be apended to the existig file's name,
        the new file written, and then the backup will be deleted. Compressed filetypes are also supported.
        </p>
        
        <h4>Supported File Types</h4>
        <dl>
        <dt>.json</dt>
        <dd>Values may be list, dict, string, int, bool, or None</dd>
        <dt>.yaml</dt>
        <dd>Values may be list, dict, string, int, bool, or None</dd>
        <dt>.txt</dt>
        <dd>Directly reads TXT file and returns as string. May be ASCII or UTF-8.</dd>
        <dt>.bin</dt>
        <dd>Bytes and bytearrays.</dl>
        <dt>*.gz</dt>
        <dd>Any other type may be compressed with gzip compresssion(e.g. "foo.txt.gz")</dd>
        <dt>*.bz2</dt>
        <dd>Any other type may be compressed with bz2 compression(e.g. "bar.json.bz2")</dd>
        </dl>
        
        <h3>kaithem.string</h3>
        <h4>kaithem.string.usrstrftime([time])</h4>
        <p>When called from within a page, formats the time(in seconds since the epoch),
        according to the user's time settings. If no time is given, defaults to right now.</p>
        
        <h3>kaithem.string.siFormat(n,d=2)</h3>
        <p>Takes a number and formats it with suffixes. 1000 becomes 1K, 1,000,000 becomes 1M.
        d is the number of digits of precision to use.</p>
        
        <h3>kaithem.string.formatTimeInterval(n,places=2)</h3>
        <p>Takes a length of time in secons and formats it. Places is the mx units to use.
        formatTimeInterval(5,1) becomes ""5 seconds", formatTimeInterval(65,2) returns "1 minute 5 seconds"</p>
        
        <h2>
            <a id="theming" name="theming"></a>Theming
        </h2>
        <p>The following conventions are used for consistancy in kaithem CSS. If you want your custom pages to be
            consistant with the rest of Kaithem's theming, you can use the following CSS classes in your user-created
            pages.</p>

        <h3>Section Boxes</h3>
        <p>Almost everything that is not a large heading should be in a div with class="sectionbox" or a child
            therof. Kaithem backgrounds may not have enough contrast with text to be easily readable outside of
            sectionboxes.</p>

        <h3>Scrolling Boxes</h3>
        <p>a div with class="scrollbox" will look like a secionbox but scroll on overflow. May be nested in
            sectionboxes.</p>

        <h3>Action Links</h3>
        <p>Any link having the primary purpose of performing an action as opposed to navigation should have the
            class "button". If the action is delete, it should also have the class "deletebutton", likewise for
            "createbutton" and "savebutton"</p>

        <h3>Short help strings</h3>
        <p>Short help texts in the gui should be wrapped in a p element with class ="help"</p>

        <h3>Menu Bars</h3>
        <p>Oftentimes you want to have something like the menu bars at the top of windows in desktop apps. An easy
            way to do this is to put your controls in a p element of class = "menubar"</p>
            
            
        <h2>The Internal Message Bus</h2>
        <p>Kaithem includes a custom internal messaging system that is accessable from user code through
            kaithem.message The following topics are of note: However, the system also makes use of the bus in the
            following ways:
         <h3>/system/startup</h3>
         <p>A message is posted here after the system has fully initialized</p>
         
         <h3>/system/shutdown</h3>
         <p>A message will be posted here just before the system shuts down or restarts unless it shuts down
         due to SIGKILL or a bad error or some other non-graceful cause</p>
         
        <h3>/system/errors/events/*module*/*event*</h3>
        <p>Mhen an error occurs in a module, A message will be broadcast on this topic,where module and event are
            the relevant module and event.</p>
        
        <h3>system/errors/workers</h3>
        <p>When an error occurs in Kaithem's background worker pool, it will be logged here.
        There could possibly be a lot of traffic here if a realtime event decides to spew a bunch.</p>
        
        <h3>system/errors/scheduler/second</h3>
        <p>When an event occurs in kaithem's internal time scheduler it will be posted here.
        Nothing currently uses this except a few system tasks.</p>

        <h3>system/errors/scheduler/minute</h3>
        <p>When an event occurs in kaithem's internal time scheduler it will be posted here.
        Nothing currently uses this except a few system tasks.</p>
        
        <h3>/system/notifications</h3>
        <p>All messages broadcasted to this topic will appear on the front page. They should be normal text strings,
            and should not contain any time information as they will be listed by time on the front page anyway. Care
            must be taken not to flood the front page and thereby hide important messages. Only system-wide or major
            events should be logged here.</p>
            
        <h3>/system/notifications/errors</h3>
        <p>Messages here are like normal system/notifications/ messages, but are semantically errors, and
           can show in red in the logs, or trigger sounds, or similar. Again, only fairly important things should
           go here, as they will be listed on the front page.
        </p>
        
        <h3>/system/modules/loaded</h3>
        <p>When a module has fully initialized, it's name is posted here.</p>
        
        <h3>/system/modules/unloaded</h3>
        <p>When a module has been deleted, it's name is posted here.</p>
        
        <h3>/system/modules/events/loaded</h3>
        <p>The module and resource of any event that loads or reloads gets posted here.</p>
        
        <h3>/sytem/perf/FPS</h3>
        <p>Every ten minutes, a message will be posted to this topic containing only the current frame rate that
         the event polling runs at. Messages are posted every minute if the frame rate is below 95% of full.</p>
        
        <h3>/sytem/perf/memuse</h3>
        <p>Every ten minutes, a message will be posted to this topic containing the current total memory usage of the system (0= none, 1=all available memory).
        Messages are posted every minute if the ram use is greater than 0.8</p>
        
        <h3>/sytem/perf/requestsperminute</h3>
        <p>Every minute, a message will be posted to this topic containing the number of HTTP requests made to
        the server in the last minute.</p>
        
        <h3>system/events/ran</h3>
        <p>When any event runs, a message will be posted here, the message being a list with two items, the first being the module name and the second being the event name</p>
        <p>NOTE: the message logging system means that anyone with the /users/logs.view permission
        can see all traffic on the message bus, because even topics not set up to be logged are kept in ram and shown on
        the logs page for a short time. Be careful to either not send any private data on the message bus,
        or be very careful who you give permission to see the logs.
        </p>
        
        <h3>system/auth/login</h3>
        <p>When a user logs in, his username and IP are posted here as a two element list.</p>
        
        <h3>system/auth/logout</h3>
        <p>When a user logs out, his username and IP are posted here as a two element list.</p>
        
        <h3>system/auth/loginfail</h3>
        <p>When a user fails to logs in, his username and IP are posted here as a two element list.</p>
        
     

        <h2>
            <a id="logging" name="logging"></a>Logging
        </h2>
        <p>Kaithem's native logging support is based on the message bus. Anytime a message is posted to the message
            bus, it gets stored in a "staging area". If a topic is not configured to be logged, than by default only the 50
            most recent messages on that topic will be kept before discarding the oldest</p>
            
            
            </p> Once the total  number of messages in the staging area exceeds a
            threshold, The messages in the staging area will be filtered by topic then dumped to a file.
            </p>
            
            
            <p>
             What specific get logged is configurable from the logs page, which also allows you to see the
            messages in the staging area. Log dumps are in JSON format as one big dict of lists of messages indexed by
            topic, where each message is an array of (timestamp,message)</p>
            


        <p>Log dumps will be found in kaithem/var/logs/dumps while the list of topics to save will be in
            kaithem/var/logs</p>
            
<h2><a id="email"></a>Email Alerts</h2>
<p>
Kaithem can be configured to <a href="#kdotmail">send email</a> through an SMTP server. Go to the settings page to configure this.
You can also create mailing lists, to make mail alerting easier to manage. You create these on the settings page.
Mailing lists are uniquely identified by a base64 string called a UUID that ends in two equals signs.

For every list you create, a corresponding permission will be created containing the UUID. 
You must have that permission to subscribe to a list.

Every user can enter an email address and recieve alerts from any list he has the correct permissions to subscribe to.
</p>




        <h2>FAQ</h2>

        <h3>Where does Kaithem store data?</h3>
        <p>By default, kaithem stores all variable data in kaithem/var(inside it's directory) It does not use the
            windows registry, APPDATA, a database, or any other central means of storage. However, keeping your data in
            kaithems "unzip and run" folder has a few problems. First and most important, it makes it hard to update,
            since if you download a new version it will not have your data.</p>
        <p>To avoid this, we recommend that you copy kaithem/var someplace else, and use the site-data-dir config
            option to point to the new location. If you copy var to /home/juan/ then site-data-dir should equal
            /home/juan/var</p>

        <h3>How do I use custom configuration files?</h3>
        <p>Create your file, then, when you start Kaithem, use the -c command line argument to point to it. Example:
        
        <pre>python3 kaithem.py -c myconfigfile</pre> Kaithem uses the YAML format for configuration files, which is a
        very simple and easy to read format. YAML example: <pre>
#this is a comment
option-name: this is the option value

another-option: 42

a-long-string-as-an-option: |
    That pipe symbol after the colon lets us start
    a big multiline string on the next line


an-option-with-a-list-as-a-value:
    -uno
    -dos
    -tres</pre>


        </p>
        <p>
            NOTE: Kaithem will <b>only</b> load the configuration file on startup and you must reload kaithem for the
            changes to take effect.
        </p>
        <h3>My data is not being saved to the log files! Help!</h3>
        <p>Kaithem only saves topics to the hard drive if they are in the list of things to save. Go to the logging
            page and select the channels you are interested in.</p>

        <h3>What is with these security certificate errors?</h3>
        <p>
            Kaithem comes with a default security certificate in the kaithem/var/ssl directory. Becuase it is publicly
            known, it provides <b>ABSOLUTELY NO SECURITY</b>. The intent is to let you test out Kaithem easily, but if
            you want to actually deploy an instance, you <b>MUST</b> replace thesecurity key with a real one and keep it
            secret. There are plenty of TLS/SSL Certificate tutorials,
            and equally important is that you ensure that the permissions on the private key file are truly set to private.
        </p>

        <h3>How do I make an event that triggers at a certain time?</h3>
        <p>To make an event that goes off at Noon, simply create a normal event and set the trigger to
            "kaithem.time.hour() == 12"</p>


        <h3>
            <a id="static" name="static"></a>How do I tell Kaithem to serve a static file?
        </h3>
        <p>Add something like this to your configuration file
        <pre>
serve-static:
    images: /home/piper/My Pictures
    images2: /home/piper/My Other Pictures
</pre> Now the url /usr/static/images/page.jpg will point to the file /home/piper/My Pictures/page.jpg<br> All
        user-created static directories are mounted under /usr/static. Be VERY careful what you choose to serve
        statically, because anyone will be able to access them. If you need a secure way to serve a file, you are better
        off creating a page with the appropriate permissions, and using <a href="#servefile">kaithem.web.serveFile()</a>
        </p>

        <h3>I am getting "permission denied" errors on the web interface</h3>
        <p>You don't have permission to access that page. If you are admin, go to the authorization page and give
            yourself that permission.</p>

        <h3>I am not using flash memory, and would like to set up autosave</h3>
        <p>By default, Kaithem tries to avoid automatic disk writes. This is to avoid wearing out low-cost flash
            storage on devices such as the RasPi. However, if you would like to configure the server to save the state
            on an interval, you can set the
        <pre>autosave-state</pre> option in the configuration to an interval specified like "1 hour" or "1 day" or 1 day 3 minutes.
        </p>

        <p>Valid units are second,minute,hour,day,week,month,year. Autosaving will not happen more than onceper minute no
            matter the setting and if data is unchanged disk will be untouched. A "month" when used as a length of time, is a year/12.</p>

        <p><b>autosave-state does not touch log files. Use autosave-log for that. It's semantics are the same.</b></p>

        <p>In addition to periodic saves, you might want to consider setting
        <pre>save-before-shutdown</pre> to <pre>yes</pre>This will tell the server to save everything including log
        dumps before shutting down.
        </p>

        <h3>I would like to back up the code that I wrote in Kaithem</h3>
        <p>At the moment, the easiest way to do this is just to make a copy of the folder where your variable data
            is kept.</p>

        <h3>How exactly does logging work?</h3>
        <p>the
        <pre>keep-log-files</pre> configuration option deterimines how much space log files will consume before the
        oldest are deleted. The default is <pre>256m</pre> or 256 Megabytes. You can use the suffixes k,m,and g, and if
        you don't supply a suffix, the number will be interpreted as bytes(!)
        </p>

        <p>Log files are kept in ram until the total number of log entries across all topics (even if the topics are
            not set up to be flushed to file) exceeds
        <pre>log-dump-size</pre>
        </p>

        <p>Logs are stored in JSON files, and the level of formatting is determined by
        <pre>log-format</pre> Log format can be any of:
        <ul>
            <li>normal</li>
            <li>tiny</li>
            <li>pretty</li>
        </ul> Normal is the defaut, tiny is the smallest JSON possible, and pretty indents with 4 spaces among other things.
        All are equivalent valid JSON.
        </p>

        <p>To save space, logs can also be compressed with the option
        <pre>log-compress</pre> This option can take any of:
        <ul>
            <li>none</li>
            <li>gzip</li>
            <li>bz2</li>
        </ul> Compressed files will have the extension <pre>.json.gz or .json.bz2</pre>
        </p>

        <h3>Can I customize Kaithem's appearance for my specific deployment?</h3>
        <p>Certainly! Kaithem was designed with theming and customization in mind from the start. You will probably
            want to do some or all of the following.
        <h4>Change the Top Banner</h4>
        <p>Changing the top banner is pretty simple. All you need to do is add a line in your configuration file
            like:
        <pre>
top-banner-html: |
    &ltdiv id="topbanner"&gt&lth1 align="center"&gtYOUR TEXT HERE&lt/h1&gt&lt/div&gt    
</pre> Of course, you can add whatever HTML you like, this is just an example. You can even add images(see "<a href="#static">How
            do I tell Kaithem to serve a static file?</a>")
        </p>

        <h4>Changing the front page text</h4>
        <p>This is equally easy. The top box on the front page is fully customizable. the front-page-banner
            attribute in your config file can contain any HTML. The default is:
        <pre>
front-page-banner: |
    &ltb&gtKaithem is free software licensed under the GPLv3.&ltbr&gt
    Kaithem was not designed for mission critical or safety of life systems and no warranty is expressed
    or implied.&ltbr&gt Use entirely at your own risk.&lt/b&gt
</pre>
        </p>

        <h4>Change the actual CSS theme</h4>
        <p>This is a bit harder. The default CSS file is called scrapbook.css, found in /kaithem/data/static. What
            you will need to do is to create a new theme file, serve it as a static file, and then use the "theme-url"
            option in your config file to point to the new theme. You will likely just want to modify the existing
            scrapbook.css because it is a 100+ line file and there are some things that don't quite look right with the
            browser defaults.</p>
            
        <h4>Rewrite the HTML</h4>
        <p>The HTML is pretty simple, and most pages include the header src/html/pageheader.html.
        The only trouble with modifying things is updatability, and the easiest way to fix that is probably using a version control tool like Git.
        Modifying the HTML might be the best option for more extensive customizations.</p>

        <h3>What can I do to make Kaithem more reliable?</h3>
        <p>Watch out for things that have to be turned on,left on for a while, and then turned off. Don't depend on
            high frame rates. Keep in mind that the server may need to restart at some time for updates. Everything
            should start with sane defaults immediately on loading. Keep in mind that the order in which events and
            modules load is not currently defined(this should be adressed soon), however an event will never run before
            it's setup section, and almost all dependancy issues should be handled by the automatic retry.</p>
            
         <p>An error in a setup section will cause that event to be skipped,
         the rest of the events to be loaded, then the failed ones will be retried up to the max attempts(default 25)
         </p>
         
         <p>On a related note, watch out for dependancies between events and modules.
         The order in which modules or events load is currently not defined.
         Dependancies are handled automatically in most cases.</p> 
         
         <p>Also, keep in mind what happens when Kaithem shuts down or restarts:
         any events currently executing finish up, but no new events are run.
         (except events triggered by the /system/shutdown message)</p>
         
         <p>Put an emphasis on automatic management, detection, and recovery, and keep in mind external services may undergo downtime.
         Example: If you need a serial port, don't just set it up when kaithem loads. Create a manager event that periodically checks to make
         sure all is well and if not tries to reopen the port. Remember you may want to run Kaithem for months without a reboot.</p> 
         
         <h3>Can I run multiple instances of Kaithem?</h3>
         <p>Quite possibly. It has not been tested though.
         If you do, they should probably have different directories for variable data</p>
         
         <h3>What happens if two people edit something at the same time?</h3>
         <p>Kaithem was not designed as a large-scale collaboration system.
         At the moment,If two people edit something at the same time, the last person to click save "wins".
         </p>
         
         <h3>How do unencrypted pages work?</h3>
         <p>
         Kaithem will allow unencrypted acess to any page that does not require any permissions.
         Kaithem will also allow unencrypted acess to any page that the special user "__guest__" could access, if such a user exists.
         All other pages may only be acessed over HTTPS.
         use the 'http-port' and 'http-thread-pool' options to change the number of threads assigned and the port used
         for unsecure access.
         </p>
         
         <h3>How can I change the port in which kaithem serves?</h3>
         <p>
         Kaithem normally serves on two different ports, one for HTTP(plaintext) and one for HTTPS(Secure) connections.
         use the http-port and https-port configuration options to set each respectively. Use an integer value.</p>
         </p>
         
         <h3>How should I deploy Kaithem in a real application?</h3>
         
         <p>First, keep in mind that while Kaithem is fairly reliable, it was not designed for 
         anything like medical equipment or nuclear plants. With that in mind, deploying Kaithem is pretty easy.
        You will most likely want an always-on server, probably running linux(The Raspberry Pi is a great server),
        and you will probably want to set up a static IP.
         </p>
         
         <p>Since, at the moment, Kaithem lacks an installer,
         the recommended installation procedure is to install git, create a new linux user just for the server,
         and clone into the new user's home directory. Give the user any permisions needed to acess your automation hardware.
         </p>
                  
         <p>Be sure to use real SSL keys, and to change the default passwords.</p>
         
         <p>You will almost certainly want to automatically start on boot, and the easiest way to do this is to 
         make an entry in the Kaithem user's crontab.</p>
         
         <p>To update Kaithem, simply go into the Kaithem install folder in the user's home dir, and do a git pull.</p>
         
         <p>Be careful updating, 100% backwards compatibility is not guaranteed at this stage of the project,
          and some config options might gte deprecated and your settings may be ignored.</p>
          
         <p>You should make a copy of kaithem/var,  put it somewhere else, and change the
         <pre>site-data-dir</pre>
         
         In your config file to point to it. Also change ssl-dir to point to whereever you put the certificate.cert and certificate.key files of your private key.
         If you don't do this, it will write your data(modules,pages,events,settings) directly into the cloned repo, which may cause an error when you try to update via git.
         </p>
         <h3>Audio is not working on the RasPi</h3>
         
         <p>At least on the version of Raspbian used for testing, SoX will not work unless you set the following environment variables
<pre>
AUDIODEV=hw:0
AUDIODRIVER=alsa
</pre>
         </p>
         <p>
         Also,the user that kaithem is running under must be in the audio group, use
         <pre>sudo usermod -a -G audio USERS_NAME</pre>
         to fix that. The default user had this enables already but if you made a new user you may need to use the command.
         <p>
         
         <h3></h3>
         
         
        <h3>How does the polling mechanism manage CPU time and prevent "hogging"?</h3>
        
        <p>The short answer is that Kaithem attempts to distribute CPU time fairly, and make sure all
        events continue to run even when some are vastly slower than others. In general, the
        programmer should be able to imagine that each event has its on thread even though the thread pool model is used.
         The long answer in more technical.</p>
        
        <p>The current poll management system is based on the kaithem thread pool. The thread pool
        is a set of threads fed by a threadsafe queue. Function objects are placed in the queue and
        threads take them out and execute them.
        </p>
        
        <p> In kaithem, a polling cycle is called a frame. Every frame,
        kaithem puts the poll function of every event that needs to be polled into the queue. Should a thread get a
        poll function and find out that another thread is already polling it, that event is simply skipped to prevent a slow event clogging
        the pool by causing many threads to wait on the last thread to be done ith it so they can poll it.</p>
        
        <p>After the manager thread has inserted all the poll functions into the queue, it inserts a special sentinel.
        The manager thread will not start the next frame until this sentinel has run. The sentinel running lets us know that
        everything we put in the queue has been taken out. If a slow event is still running at this point, it will continue to run,
        and another copy of it should never be queued up in any way until the current one finished.</p>
        
        <p>The one known case in which slow tasks can bog down the system is if there are more slow tasks than there are threads in the pool.
        In this case the system may be unresponsive for a time until the tasks finish. This is unlikely as the odds of having dozens of tasks at the same time
        that are very slow is low in most systems.
        
        </p>
        
        <a id="dependancies" name="dependancies"></a><h3>How does Kaithem handle dependancies between resources?</h3>
        <p>With pages, it's not much of an issue.
        Pages are compiled the first time they get accessed, and if that fails due to a dependancy,
        the compiling will be retried next time someone tries to access it.
        It is hard to imagine pages depending on each other in any major way anyway, because pages are usually not the place to write libraries.
        </p>
        
        <p>Events are another story. Since kaithem implements "running some code at startup", including user created
        functions, as an event, events may have any amount of dependancy on each other.</p>
        
        <p>The way that kaithem handles this, is that when an exception occurs in an event's setup code(while loading the event),
        kaithem simply stops, moves on with the rest of the list of events that need loading, and then comes back to the event that failed, up to
        a number of times set in the config.</p>
        
        <p>This means that you should almost never need to deal with dependancy resolution issues yourself,
        they are handled as a consequence of kaithem's auto-retry mechanism. However, to imporove load time, you may want
        to make dependancies more explicit by adding something like this:
<pre>
depends = kaithem.globals.ThingThisEventExpectsToBePresent
depends = FunctionCallThatWillFailIfDependacyNotMet()
</pre>

        to the beginning of the setup function. These lines will raise errors if there are unmet dependancies.
        causeing kaithem to exit immediatly, instead of after having wasted more time. It's also valuable documentation.
        
        But in general, don't worry about dependancies. Just keep in mind that your setup functions might get retried.
        
        </p>
        
<h3>Help! My setup code executes twice!</h3>
        <p>Internally, the setup code is run once during the 'test compile', then once when actually creating the event.
        The objet created in the test compile is deteted, so all deleters are honored.
        Your setup setions should be retry tolerant anyway, but this issue may be fixed later</p>
</div>

<%include file="/pagefooter.html"/>
