
<%include file="/pageheader.html"/>

<h2>Module ${name|h}</h2>
<title>Module: ${name|h}</title>
<section class="flex undecorated">
<section class="card">
    <details class="help"><summary><i class="icofont-question-circle"></i></summary>Note: Your changes are saved temporarily to RAM until either a configured autosave(Off by default), or a manual save of the server state.</details>

MD5 Sum: ${getModuleHash(name)}</br>
WordHash: ${getModuleWordHash(name)}</br>
<a href="/modules/yamldownload/${url(name)}.zip">Download this module as a zip file</a><br>
<form action="/modules/module/${url(name)}/obj/module" method="post"><button>The module namespace object(requires edit permission, beware shoulder surfers)</button></form>
</section>

<section class="card w-50">
    <form action="/modules/module/${url(name)}/update" method="POST" name="user">

<h4>Name:</h4>
<input required="required" class="modulename" name="name" type="text" value="${name|h}">
<h4>Info:</h4>
<textarea name="description" class="description" rows=5>${getDesc(module)|h}</textarea>
<h4>Save Location(blank=default):</h4>
<input name="location" title="Enter a directory name on the server's local filesystem" value="${external_module_locations.get(name,"")|h}"></input>
<hr>
%if pages.canUserDoThis("/admin/modules.edit"):
<input type="submit" value="Save Changes"></input>
%else:
<p class="warning">You must have the "/admin/modules.edit" permission to make changes. Are you logged in?</p>
%endif
</form>
</section>
</section>



<br>

<div class="sectionbox">



<p class="pathnav tool-bar">
<%
temp_p = ""
%>
<a class="button" href="/modules/module/${url(name)}#resources">${name|h}</a>
%if path:
%for i in util.split_escape(path[0],"/","\\"):
<%
temp_p+= i+'/'
%>\
<a class="button" href="/modules/module/${url(name)}/resource/${url(temp_p[:-1])}#resources">${i|h}</a>
%endfor
%endif
</p>


<div class="tool-bar">
    <p><i class="icofont-ui-add"></i>Add:</p>
    <a class="button" href="/modules/module/${url(name)}/addresource/event/${url('/'.join(path))}">Event</a>
    <a class="button" href="/modules/module/${url(name)}/addresource/permission/${url('/'.join(path))}">Permission</a>
    <a class="button" href="/modules/module/${url(name)}/addresource/page/${url('/'.join(path))}">Page</a>
    <a class="button" href="/modules/module/${url(name)}/addresource/directory/${url('/'.join(path))}">Folder</a>
    <a class="button" href="/modules/module/${url(name)}/addfileresource/${url('/'.join(path))}">File</a>
    <a class="button" href="/modules/module/${url(name)}/addresource/device/${url('/'.join(path))}">Device</a>
    
    
    %for i in modules.additionalTypes:
    %if hasattr(modules.additionalTypes[i],'createButton') and modules.additionalTypes[i].createButton:
    <a class="button createbutton" href="/modules/module/${url(name)}/addresource/${i|u}/${url('/'.join(path))}">${modules.additionalTypes[i].createButton|h}</a>
    %endif
    %endfor


    <form style="display:inline-flex;" action="/modules/search/${url(name)}"><p><i class="icofont-ui-search"></p></i><input size=8 name="search" placeholder="Search this module"/><input  type=submit value="search"/></form>
</div>
    
<dl>
%if path and len(util.split_escape(path[0],"/","\\"))>1:
<dt class="specialentry"><a href="urlForPath(module, path)#resources">..</a></dt>
%endif
%for i in sorted_module_path_list(name, path):
%if in_folder(i,fullpath,name):

%if not 'resource-type' in module[i]:
<p class=error>OBJECT ${i|h} MISSING resource-type</p>
<%
continue
%>
%endif

%if module[i]['resource-type'] == 'event':
	  <dt>
        <div class="tool-bar style="display:inline-flex">
<a href="/modules/module/${url(name)}/resource/${url(i)}#setupheading">
    <i class="icofont-flag-alt-1"></i><b>\


${util.split_escape(i,'/','\\')[-1]|h}</a></b>\
	       %if not module[i].get('enable',"True"):
	       (disabled)
	       %endif
           <span class=error title="This event has loaded normally, but has been stopped, likely by calling stop() on it's interface.">${"(stopped)" if (newevt.EventReferences[name,i].disable) else ""}</span>

       

<a class="button" href="/modules/module/${url(name)}/deleteresource/${url(i)}"><i class="icofont-ui-delete"></i>Delete</a>
<a class="button" href="/modules/module/${url(name)}/runeventdialog/${url(i)}"><i class="icofont-ui-play"></i>Run Now</a>
	       %if newevt.fastGetEventErrors(name,i):
	       <span class="danger">[${len(newevt.fastGetEventErrors(name,i))} Errors]</span>
	       %endif
        </div>
	  </dt>
	  <dd>

          <p class="resource-docstring">${newevt.getEventInfo((name,i))|h}</p>
	       Trigger:  <code>${module[i]['trigger']|h}</code><br>

    		    Last Ran:
    		    %if newevt.getEventLastRan(name,i):
    		    <code>${unitsofmeasure.strftime(newevt.getEventLastRan(name,i))|h}
    		    (${unitsofmeasure.formatTimeInterval(time.time()-newevt.getEventLastRan(name,i),2)} ago)</code>

                %if newevt.getEventCompleted(name, i): 
                <code>Completed in ${round(newevt.EventReferences[name,i].lastcompleted-newevt.EventReferences[name,i].lastexecuted,3)|h}s</code>
                %else:
                <span class="highlight">Still Running</span>
                %endif
    

    		    %else:
    		    This event has not ran since it loaded.
    		    %endif


		    %if module[i]['trigger'].startswith("!time") and module[i].get('enable',"True"):
		    <br><b>Next Run:</b>
            <%
            xyz= get_time((name,i))
            unitsofmeasure.strftime()
            if xyz ==0:
                xyz= "<b>Not Scheduled to Run</b>"
            elif xyz == -1:
                xyz="Error getting next run time, try refreshing page again."
            else:
                xyz =unitsofmeasure.strftime(xyz)
            %>
		    <code>${xyz}</code></p>
		    %endif
	  </dd>
	%endif

	%if module[i]['resource-type'] == 'page':
	  <dt>
        <div class="tool-bar style="display:inline-flex">


          <a aria-role="header" href="/modules/module/${url(name)}/resource/${url(i)}#pagebody">
            <i class="icofont-page"></i><b\
	       %if i.startswith('__'):
	       class="specialentry page"\
	       %endif
	       >${util.split_escape(i,'/','\\')[-1]|h}</b>
</a>
		%if usrpages.getPageErrors(name,i):
		<span class="danger">[${len(usrpages.getPageErrors(name,i))} Errors]</span>
		%endif
          
		<a class="button" href="${usrpages.url_for_resource(name,i)}"><i class="icofont-ui-play"></i>Go to page</a><a class="button" href="/modules/module/${url(name)}/deleteresource/${url(i)}"><i class="icofont-ui-delete"></i>Delete</a>
        </div>
    </dt>
	  <dd>

          <p class="resource-docstring">${usrpages.getPageInfo(name,i)|h}</p>
      %if 'require-permissions' in module[i] and module[i]['require-permissions']:
	  Permissions:

	  %for x in module[i]['require-permissions']:
	  <i class="icofont-key"></i>${x|h}
	  %endfor
      %endif

      %if 'require-method' in module[i]:
      <i class="icofont-unlocked"></i>Access: ${','.join(module[i]['require-method'])}
      %endif
	  </dd>
	%endif

       %if module[i]['resource-type'] == 'permission':

      <dt>
        <div class="tool-bar style="display:inline-flex">
  <h3>
    
<a href="/modules/module/${url(name)}/resource/${url(i)}">    <i class="icofont-key"></i>\
  ${util.split_escape(i,'/','\\')[-1]|h}</a>
  </h3>
  
<a class="button" href="/modules/module/${url(name)}/deleteresource/${url(i)}"><i class="icofont-ui-delete"></i>Delete</a>
        </div>
<dt>

	%endif
    %if module[i]['resource-type'] == 'internal-fileref':

       <dt>\
        <div class="tool-bar style="display:inline-flex">

    <h3>
    <a href="/modules/module/${url(name)}/getfileresource/${url(i)}">${util.split_escape(i,'/','\\')[-1]|h}</a>
    </h3>
    <a class="settingsbuttton" href="/modules/module/${url(name)}/resource/${url(i)}">Properties</a>

    <a class="button" href="/modules/module/${url(name)}/deleteresource/${url(i)}"><i class="icofont-ui-delete"></i>Delete</a>
    <p>
    <span>Size: ${get_f_size(name,i)}</span>
    </p>
    </div>

    <dt>

     %endif

%if module[i]['resource-type'] == 'device':

     <dt>\

  <div class="tool-bar">
      <h3>
  <a class="deviceslink" href="/modules/module/${url(name)}/resource/${url(i)}">${util.split_escape(i,'/','\\')[-1]|h}</a>
  </h3>
  
  <a class="button" href="/modules/module/${url(name)}/deleteresource/${url(i)}"><i class="icofont-ui-delete"></i>Delete</a><br>
  </div>
  <dt>

%endif


    %if module[i]['resource-type'] not in ['event','permission','page','directory','internal-fileref','device'] and not i.startswith("__"):

           <dt><span></span>\
        <a class="button" href="/modules/module/${url(name)}/deleteresource/${url(i)}"><i class="icofont-ui-delete"></i>Delete</a>
        <dt>

     %endif

%if module[i]['resource-type'] == 'directory':

      <dt>
<div class="tool-bar">
<h3>
    <a href="/modules/module/${url(name)}/resource/${url(i)}#resources"><i class="icofont-document-folder"></i><b></b>${util.split_escape(i,'/')[-1]|h}</b></a>
</h3>
<a class="button" href="/modules/module/${url(name)}/deleteresource/${url(i)}">Delete</a>
</div>
<dt>

%endif
%endif
%endfor
</div>


<%include file="/pagefooter.html"/>
