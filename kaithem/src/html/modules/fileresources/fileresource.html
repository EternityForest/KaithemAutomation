<%!
    from kaithem.src.util import url
    from kaithem.src import unitsofmeasure,pages,auth,usrpages
    from kaithem.src.modules import fileResourceAbsPaths
    import os
%>

<%include file="/pageheader.html"/>
<h2>File Resource ${resource|h}</h2>
<title${resource|h}</title>
<section class="window paper">
    <h2>Info</h2>
    <table border=1>
    <tr>
    <th>
    Path on server
    </th>
    <th>
    Size
    </th>
    </tr>
    
    <tr>
        <td>
            ${fileResourceAbsPaths[module,resource]|h}
    </td>
    <td>
    %try:
    ${unitsofmeasure.siFormatNumber(os.path.getsize(fileResourceAbsPaths[module,resource]))}
    %except:
    File not acessible or does not exist
    %endtry
   

    </tr>
    </table>


    <form action="/modules/module/${url(module)}/updateresource/${url(resource)}" method="POST">
    
        <label>New name(blank to keep)<input name="name" disabled title="Name change not yet supported"></label></input></label>

        <h2>Serve to end-users</h2>
    <label><input type="checkbox"  name="serve"

       %if 'serve' in resourceobj:
           %if resourceobj['serve'] == True:
           checked
           %endif
       %else:
        %endif
      ></input>Serve file with the same URL pattern as you would expect for a page(Needed for features in this section) at <a href="${usrpages.url_for_resource(module,resource)}">${usrpages.url_for_resource(module,resource)|h}</a>
    </label>
    
    <br>

    <a href="/utils/video_signage?src=${usrpages.url_for_resource(module,resource)|u}">Looping video signage link</a>
<h2>Permissions</h2>

<details class="help"><summary><i class="icofont-question-circle"></i></summary><span class="permission-icon"></span>Require the following permissions to access this resource</details>
<div class="max-h-12rem scroll border">
<ul>
%for i in sorted(auth.Permissions.keys()):
    <li> <input type="checkbox"  name="Permission${i}" value="true"
        %if i in requiredpermissions:
            checked="yes"
        %endif
        %if not pages.canUserDoThis("/admin/modules.edit"):
                    disabled=1\
        %endif
        ></input>${i|h}</li>
%endfor
</ul>
</div>


MIME type:<input step=0.1 name="mimetype" size=6em
        %if 'mimetype' in resourceobj:
                value= ${resourceobj['mimetype']|h}
        %else:
                value= ""
        %endif
        %if not pages.canUserDoThis("/admin/modules.edit"):
                    disabled=1\
        %endif
       ></input><br>


<input type="checkbox" name="allow-xss"
        %if 'allow-xss' in resourceobj:
            %if resourceobj['allow-xss']:
                checked="yes"
            %endif
        %endif
        %if not pages.canUserDoThis("/admin/modules.edit"):
                    disabled=1\
        %endif
       ></input>Allow cross-origin requests from(comma separated, * means any)<
<%
origins = ""
if 'allow-origins' in resourceobj:
    for i in resourceobj['allow-origins']:
        origins = origins+i+", "
    origins = origins[:-2]
else:
    origins = "*"
%>
<input type="text"  name="allow-origins"
        value= "${origins|h}"
        %if not pages.canUserDoThis("/admin/modules.edit"):
                    disabled=1\
        %endif
        ></input>
</div>
%if pages.canUserDoThis("/admin/modules.edit"):
<br>
<input type="submit" value="Save Changes" onclick="wasChanged=false">
</input>
%else:
<p class="warning">You will not be able to save any change made as you are either not logged in or do not have permissions.</p>
%endif
</form>


</section>
<%include file="/pagefooter.html"/>
