<%!
from kaithem.src.util import url
from kaithem.src import modules, modules_state

def getDesc(m):
    try:
        d =  modules_state.ActiveModules[m]['__description']['text']
        if d=='Module info here':
            return ''
        return d
    except:
        return ""

%>
<%include file="/pageheader.html"/>
<script src="/static/showdown.min.js"></script>

<h1>Modules</h1>
<title>Modules</title>
<section>

    </div>
    <div class="tool-bar menubar">
    <a class="button" href="/modules/newmodule"><i class="icofont-ui-add"></i>Add</a>
    <a class="button" href="/modules/deletemodule"><i class="icofont-ui-delete"></i>Delete</a>
    <a class="button" href="/modules/upload"><i class="icofont-upload"></i>Upload</a>
    <a href="/modules/library"><i class="icofont-library"></i>Library</a>
    <p style="font-size: smaller;">${modules_state.moduleshash}</p>
    <form style="display:inline-flex;" action="/modules/search/__all__"><input name="search" size="4" placeholder="Search all modules"/><input type=submit value="search"/></form>
    </div>

<hr>
%for i in sorted(ActiveModules.keys()):
<details>
<summary>
%try:
<a href="/modules/module/${url(i)}#resources" title="MD5: ${modules_state.getModuleHash(i)}">${i}</a>\
%if i in modules.external_module_locations:
[From ${modules.external_module_locations[i]|h}]\
%endif
</dt>\
%except Exception as e:
<%
print(e)
%>
</dt>
<dt>
${e|h}
</dt>
%endtry
</summary>
<div id="${i.replace('"','')}">${getDesc(i)|h}</div>
</details>
<script>
    showdown.setFlavor('github');
    var c= document.getElementById("${i.replace('"','')}").innerHTML;
    var converter = new showdown.Converter();
    document.getElementById("${i.replace('"','')}").innerHTML=converter.makeHtml(c);
</script>

%endfor
</section>
<%include file="/pagefooter.html"/>
